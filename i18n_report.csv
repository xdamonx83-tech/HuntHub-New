file,line,type,attr,key,text
partials/tournament/matches.php,3,text,,matches_gewinner_fa01681e,Gewinner
partials/tournament/matches.php,11,text,,matches_event_noch_nicht_beendet_c5af5c3b,"Event noch nicht beendet"
partials/tournament/participants.php,3,text,,participants_leaderboard_fd1d3714,Leaderboard
partials/tournament/participants.php,57,text,,participants_target_blank_rel_noopener_shot_86ee3a4a,""" target=""_blank"" rel=""noopener"">Shot"
partials/tournament/participants.php,61,text,,participants_slots_539ab3bf,Slots)
partials/header.php,14,text,,header_assets_images_icons_favicon_ico_type_image_x_icon_995accf3,"/assets/images/icons/favicon.ico"" type=""image/x-icon"">"
partials/header.php,15,text,,header_assets_styles_app_css_i18n_mask_script_0_8823ca35,"/assets/styles/app.css"">
  %%I18N_MASK_SCRIPT_0%%"
partials/header.php,26,text,,header_assets_images_icons_logo_png_alt_brand_85b35ac7,"/assets/images/icons/logo.png"" alt=""brand"" />"
partials/header.php,50,text,,header_news_for_you_5aecdedb,"News For You"
partials/header.php,82,text,,header_assets_images_users_user1_png_alt_profile_bd8831da,"/assets/images/users/user1.png"" alt=""profile"" />"
partials/header.php,84,text,,header_david_malan_96220cb9,"David Malan"
partials/header.php,87,text,,header_270_followars_9d81e173,"270 Followars"
partials/header.php,104,text,,header_profile_6b141b73,Profile
partials/header.php,105,text,,header_settings_fd38ef03,Settings
partials/header.php,106,text,,header_logout_eabeb605,Logout
partials/header.php,107,text,,header_help_61504d21,Help
partials/header.php,127,text,,header_assets_images_icons_logo_png_alt_gameco_24a8c909,"/assets/images/icons/logo.png"" alt=""GameCo"" />"
partials/header.php,140,text,,header_home_cedc6acf,Home
partials/header.php,147,text,,header_home_one_9bed8a5a,"- Home One"
partials/header.php,152,text,,header_home_two_12ed7bb3,"- Home Two"
partials/header.php,158,text,,header_home_three_3423f5d9,"- Home Three"
partials/header.php,164,text,,header_home_four_9a422f06,"- Home Four"
partials/header.php,171,text,,header_trending_5030f51d,Trending
partials/header.php,174,text,,header_community_ea4b4959,Community
partials/header.php,177,text,,header_saved_48c7cc52,Saved
partials/header.php,180,text,,header_live_stream_1d09318a,"Live Stream"
partials/header.php,184,text,,header_library_8d2b86ee,Library
partials/header.php,191,text,,header_library_bc704fe5,"- Library"
partials/header.php,197,text,,header_library_details_938db616,"- Library Details"
partials/header.php,205,text,,header_games_ce0bcdea,Games
partials/header.php,212,text,,header_games_f23859e1,"- Games"
partials/header.php,218,text,,header_game_details_one_0284d362,"- Game Details One"
partials/header.php,224,text,,header_game_details_two_91885738,"- Game Details Two"
partials/header.php,232,text,,header_groups_0e27cf25,Groups
partials/header.php,240,text,,header_groups_one_a143b053,"- Groups One"
partials/header.php,246,text,,header_group_two_f50999de,"- Group Two"
partials/header.php,252,text,,header_group_home_3a41d910,"- Group Home"
partials/header.php,258,text,,header_related_groups_a512cd4f,"- Related Groups"
partials/header.php,264,text,,header_group_forum_d54eb32f,"- Group Forum"
partials/header.php,270,text,,header_group_members_c2e04842,"- Group Members"
partials/header.php,276,text,,header_group_media_14d01d25,"- Group Media"
partials/header.php,284,text,,header_teams_6f958364,Teams
partials/header.php,291,text,,header_teams_b8d58165,"- Teams"
partials/header.php,297,text,,header_team_members_307781e1,"- Team Members"
partials/header.php,303,text,,header_team_games_15e91a2f,"- Team Games"
partials/header.php,309,text,,header_team_ranks_eeb7ae36,"- Team Ranks"
partials/header.php,315,text,,header_team_tournament_e7c50090,"- Team Tournament"
partials/header.php,323,text,,header_tournaments_765bbce2,Tournaments
partials/header.php,331,text,,header_tournaments_53547b81,"- Tournaments"
partials/header.php,337,text,,header_tournament_overview_4b8cbe35,"- Tournament Overview"
partials/header.php,343,text,,header_tournament_prizes_6b6f2119,"- Tournament Prizes"
partials/header.php,349,text,,header_tournament_participants_57eaf94d,"- Tournament Participants"
partials/header.php,355,text,,header_tournament_matches_7b0edd4e,"- Tournament Matches"
partials/header.php,361,text,,header_tournament_brackets_ca01299a,"- Tournament Brackets"
partials/header.php,368,text,,header_leaderboard_b9d5cd1c,Leaderboard
partials/header.php,372,text,,header_marketplace_b89ff9af,Marketplace
partials/header.php,380,text,,header_marketplace_one_0ee14c83,"- Marketplace One"
partials/header.php,386,text,,header_marketplace_two_f978eb05,"- Marketplace Two"
partials/header.php,392,text,,header_marketplace_details_b23ea515,"- Marketplace Details"
partials/header.php,400,text,,header_profile_6b141b73,Profile
partials/header.php,407,text,,header_post_item_e3d193e2,"- Post Item"
partials/header.php,413,text,,header_game_stats_4bbc75d7,"- Game Stats"
partials/header.php,419,text,,header_about_9cf5a919,"- About"
partials/header.php,425,text,,header_my_team_5f0fd4ce,"- My Team"
partials/header.php,431,text,,header_my_group_9b006f2a,"- My Group"
partials/header.php,437,text,,header_forums_4b87681e,"- Forums"
partials/header.php,443,text,,header_videos_8f3e39e2,"- Videos"
partials/header.php,449,text,,header_achievements_0547429a,"- Achievements"
partials/header.php,454,text,,header_chat_bb84797e,"- Chat"
partials/header.php,460,text,,header_settings_e9667e58,"- Settings"
partials/header.php,468,text,,header_shop_34d7d32f,Shop
partials/header.php,475,text,,header_shop_564c932f,"- Shop"
partials/header.php,481,text,,header_shop_details_434a828e,"- Shop Details"
partials/header.php,487,text,,header_shopping_cart_e6afe66f,"- Shopping Cart"
partials/header.php,492,text,,header_shipping_493b738e,"- Shipping"
partials/header.php,497,text,,header_checkout_83d035e0,"- checkout"
partials/header.php,505,text,,header_blogs_d8e38fde,Blogs
partials/header.php,512,text,,header_blogs_8a1b0840,"- Blogs"
partials/header.php,518,text,,header_blog_details_6dce1ecd,"- Blog Details"
partials/header.php,526,text,,header_pages_7384800c,Pages
partials/header.php,534,text,,header_pricing_plan_175ab901,"- Pricing Plan"
partials/header.php,540,text,,header_terms_conditions_3a13df28,"- Terms Conditions"
partials/header.php,545,text,,header_faq_s_9fe07976,"- Faq's"
partials/header.php,551,text,,header_not_found_232b5f1c,"- Not Found"
partials/header.php,556,text,,header_login_6a3958c5,"- Login"
partials/header.php,561,text,,header_sign_up_fc87ea67,"- Sign Up"
partials/header.php,568,text,,header_contact_us_218a8c40,"Contact Us"
partials/header.php,584,text,,header_assets_images_icons_logo_png_alt_logo_7a6ad448,"/assets/images/icons/logo.png"" alt=""logo"" />"
partials/header.php,585,text,,header_become_visionary_behind_a_sprawling_metropolis_in_metropolis_812bdd3f,"Become visionary behind a sprawling metropolis in Metropolis Tycoon Plan
                        empire
                        progress."
partials/header.php,720,text,,header_assets_images_users_avatar1_png_alt_avatar_308f0a7e,"/assets/images/users/avatar1.png"" alt=""avatar"">"
partials/header.php,725,text,,header_assets_images_users_avatar2_png_alt_avatar_8499356a,"/assets/images/users/avatar2.png"" alt=""avatar"">"
partials/header.php,730,text,,header_assets_images_users_avatar3_png_alt_avatar_3c722753,"/assets/images/users/avatar3.png"" alt=""avatar"">"
partials/header.php,735,text,,header_assets_images_users_avatar4_png_alt_avatar_75078578,"/assets/images/users/avatar4.png"" alt=""avatar"">"
partials/header.php,740,text,,header_assets_images_users_avatar1_png_alt_avatar_308f0a7e,"/assets/images/users/avatar1.png"" alt=""avatar"">"
partials/header.php,745,text,,header_assets_images_users_avatar2_png_alt_avatar_8499356a,"/assets/images/users/avatar2.png"" alt=""avatar"">"
partials/header.php,750,text,,header_assets_images_users_avatar3_png_alt_avatar_3c722753,"/assets/images/users/avatar3.png"" alt=""avatar"">"
partials/header.php,755,text,,header_assets_images_users_avatar4_png_alt_avatar_75078578,"/assets/images/users/avatar4.png"" alt=""avatar"">"
partials/header.php,777,text,,header_assets_images_users_avatar5_png_alt_avatar_be5046f4,"/assets/images/users/avatar5.png"" alt=""avatar"">"
partials/header.php,782,text,,header_assets_images_users_avatar6_png_alt_avatar_67b3f435,"/assets/images/users/avatar6.png"" alt=""avatar"">"
partials/header.php,787,text,,header_assets_images_users_avatar3_png_alt_avatar_3c722753,"/assets/images/users/avatar3.png"" alt=""avatar"">"
partials/header.php,792,text,,header_assets_images_users_avatar4_png_alt_avatar_75078578,"/assets/images/users/avatar4.png"" alt=""avatar"">"
partials/header.php,797,text,,header_assets_images_users_avatar1_png_alt_avatar_308f0a7e,"/assets/images/users/avatar1.png"" alt=""avatar"">"
partials/header.php,802,text,,header_assets_images_users_avatar2_png_alt_avatar_8499356a,"/assets/images/users/avatar2.png"" alt=""avatar"">"
partials/header.php,807,text,,header_assets_images_users_avatar3_png_alt_avatar_3c722753,"/assets/images/users/avatar3.png"" alt=""avatar"">"
partials/header.php,812,text,,header_assets_images_users_avatar4_png_alt_avatar_75078578,"/assets/images/users/avatar4.png"" alt=""avatar"">"
partials/header.php,34,attr,placeholder,header_placeholder_search_5ebdd180,Search...
partials/header.php,578,attr,placeholder,header_placeholder_search_media_1bc9f522,"Search Media"
partials/header.php,26,attr,alt,header_alt_brand_bde139b0,brand
partials/header.php,82,attr,alt,header_alt_profile_8ebe59db,profile
partials/header.php,127,attr,alt,header_alt_gameco_f350f9d3,GameCo
partials/header.php,584,attr,alt,header_alt_logo_48b44995,logo
partials/header.php,720,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,725,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,730,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,735,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,740,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,745,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,750,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,755,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,777,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,782,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,787,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,792,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,797,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,802,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,807,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,812,attr,alt,header_alt_avatar_ca518c6e,avatar
partials/header.php,147,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,152,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,157,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,163,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,191,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,196,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,212,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,217,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,223,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,239,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,245,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,251,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,257,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,263,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,269,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,275,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,291,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,296,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,302,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,308,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,314,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,330,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,336,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,342,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,348,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,354,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,360,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,379,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,385,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,391,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,407,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,412,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,418,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,424,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,430,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,436,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,442,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,448,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,454,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,459,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,475,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,480,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,486,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,492,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,497,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,512,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,517,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,533,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,539,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,545,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,550,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,556,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/header.php,561,attr,aria-label,header_aria-label_item_9d4a7f2e,item
partials/profile.bewertungen.php,28,text,,profile.bewertungen_profile_f4682128,profile=
partials/footer.php,7,text,,footer_subscribe_to_our_acf3333c,"Subscribe to our"
partials/footer.php,8,text,,footer_newsletter_2b7d0a23,Newsletter
partials/footer.php,15,text,,footer_subscribe_9fefed6b,Subscribe
partials/footer.php,24,text,,footer_become_visionary_behind_a_sprawling_metropolis_in_metropolis_2ac0027f,"Become visionary behind a sprawling metropolis in Metropolis Tycoon Plan empire progress."
partials/footer.php,47,text,,footer_main_pages_447aa9f6,"Main pages"
partials/footer.php,57,text,,footer_my_library_672b775d,"My Library"
partials/footer.php,65,text,,footer_trending_0d806a7c,Trending
partials/footer.php,73,text,,footer_leaderboard_83b21b68,Leaderboard
partials/footer.php,81,text,,footer_chat_a0ecf99b,Chat
partials/footer.php,89,text,,footer_marketplace_eadd6a55,Marketplace
partials/footer.php,97,text,,footer_shop_3e5c5a33,Shop
partials/footer.php,105,text,,footer_support_2eaae88f,Support
partials/footer.php,113,text,,footer_blogs_e0d588ff,Blogs
partials/footer.php,121,text,,footer_utility_pages_08c68bce,"Utility pages"
partials/footer.php,131,text,,footer_tournaments_de483a24,Tournaments
partials/footer.php,139,text,,footer_games_b5631d09,Games
partials/footer.php,147,text,,footer_community_b25308d9,Community
partials/footer.php,155,text,,footer_pricing_91f9ab36,Pricing
partials/footer.php,163,text,,footer_notifications_ea3ec6fe,Notifications
partials/footer.php,171,text,,footer_not_found_74fd195e,"Not found"
partials/footer.php,179,text,,footer_contact_570ec682,Contact
partials/footer.php,186,text,,footer_email_us_290ae06e,"Email Us"
partials/footer.php,189,text,,footer_debra_holt_example_com_ac8a8dd9,debra.holt@example.com
partials/footer.php,192,text,,footer_contact_us_d7ee253d,"Contact Us"
partials/footer.php,195,text,,footer_207_555_0119_9e0fa417,"(207) 555-0119"
partials/footer.php,202,text,,footer_copyright_f46ade37,"Copyright ¬©"
partials/footer.php,207,text,,footer_designed_by_a8c9f07d,"Designed By"
partials/footer.php,209,text,,footer_uiaxis_db96519d,UIAXIS
partials/footer.php,213,text,,footer_privacy_5ef5094b,Privacy
partials/footer.php,216,text,,footer_terms_conditions_e2b707e5,"Terms & Conditions"
partials/footer.php,13,attr,placeholder,footer_placeholder_enter_your_email_address_4a41bc42,"Enter your email address"
partials/footer.php,23,attr,alt,footer_alt_logo_795abd8e,logo
partials/footer.php,224,attr,alt,footer_alt_footer_36a15a48,footer
partials/profile.posts.php,17,text,,profile.posts_alt_user_f38b3780,""" alt=""user"" />"
partials/profile.posts.php,19,text,,profile.posts_user_php_id_7db28aaf,/user.php?id=
partials/profile.posts.php,19,text,,profile.posts_slug_4684fbf5,&slug=
partials/profile.posts.php,19,text,,profile.posts_class_text_xl_medium_text_w_neutra_88e299a2,"""
                       class=""text-xl-medium text-w-neutral-1 link-1 line-clamp-1 mb-1"">"
partials/profile.posts.php,34,text,,profile.posts_forum_thread_php_t_fb2e517d,/forum/thread.php?t=
partials/profile.posts.php,34,text,,profile.posts_slug_4684fbf5,&slug=
partials/profile.posts.php,34,text,,profile.posts_class_dropdown_item_7f27ea0a,""" class=""dropdown-item"">"
partials/profile.posts.php,45,text,,profile.posts_forum_thread_php_t_fb2e517d,/forum/thread.php?t=
partials/profile.posts.php,45,text,,profile.posts_slug_4684fbf5,&slug=
partials/profile.posts.php,64,text,,profile.posts_forum_thread_php_t_fb2e517d,/forum/thread.php?t=
partials/profile.posts.php,64,text,,profile.posts_slug_4684fbf5,&slug=
partials/profile.posts.php,64,text,,profile.posts_class_flex_items_center_gap_2_text_bas_73f31bea,"""
                   class=""flex items-center gap-2 text-base text-w-neutral-1"">"
partials/profile.posts.php,17,attr,alt,profile.posts_alt_user_9eb11fb4,user
legal/rechtlich.php,28,text,,rechtlich_privacy_de_md_datenschutzerklarung_terms_8216befc,"['privacy.de.md',    'Datenschutzerkl√§rung'],
  'terms'      => ['terms.de.md',      'Nutzungsbedingungen'],
  'netiquette' => ['netiquette.de.md', 'Netiquette'],
  'impressum'  => ['impressum.de.md',  'Impressum'],
];

$doc = $_GET['doc'] ?? 'privacy';
$partial = isset($_GET['partial']) && $_GET['partial'] === '1';

if (!isset($docs[$doc])) {
  http_response_code(404);
  if ($partial) {
    header('Content-Type: application/json; charset=utf-8');
    echo json_encode(['ok'=>false,'error'=>'Dokument nicht gefunden.']);
    exit;
  }
  $title = '404';
  $body  = '"
legal/rechtlich.php,45,text,,rechtlich_404_2c93ca2f,404
legal/rechtlich.php,45,text,,rechtlich_dokument_nicht_gefunden_132b91ce,"Dokument nicht gefunden."
legal/rechtlich.php,45,text,,rechtlich_if_havelayout_function_exists_layout_e_9a142895,"';
  if ($haveLayout && function_exists('layout')) {
    echo layout($title, fn()=>print('"
legal/rechtlich.php,47,text,,rechtlich_body_9be51693,'.$body.'
legal/rechtlich.php,47,text,,rechtlich_else_echo_5448d781,"'));
  } else {
    echo """
legal/rechtlich.php,49,text,,rechtlich_title_c9dc48a9,{$title}
legal/rechtlich.php,49,text,,rechtlich_body_72f729d0,{$body}
legal/rechtlich.php,49,text,,rechtlich_exit_file_title_docs_doc_mdpa_9e71f45e,""";
  }
  exit;
}

[$file, $title] = $docs[$doc];
$mdPath = $LEGAL . '/' . $file;
$md     = is_file($mdPath) ? (string)file_get_contents($mdPath) : """";

// Markdown -> HTML (optional Parsedown)
$haveParsedown = safe_require($LEGAL . '/Parsedown.php');
if ($haveParsedown) {
  $pd = new Parsedown();
  if (method_exists($pd, 'setSafeMode')) $pd->setSafeMode(true);
  $html = $pd->text($md);
} else {
  $html = '"
legal/rechtlich.php,65,text,,rechtlich_htmlspecialchars_md_datei_fehlt_n_n_file_nicht_ge_23c31800,"'.htmlspecialchars($md ?: ""# Datei fehlt\n\n{$file} nicht gefunden."", ENT_QUOTES, 'UTF-8').'"
legal/rechtlich.php,65,text,,rechtlich_partial_nur_json_fur_modals_if_partial_fbb3d87a,"';
}

// PARTIAL: nur JSON f√ºr Modals
if ($partial) {
  header('Content-Type: application/json; charset=utf-8');
  echo json_encode(['ok'=>true,'title'=>$title,'html'=>$html], JSON_UNESCAPED_UNICODE);
  exit;
}

// Vollseite
$wrap = '"
legal/rechtlich.php,76,text,,rechtlich_html_7dffb83a,'.$html.'
legal/rechtlich.php,76,text,,rechtlich_if_havelayout_function_exists_layout_echo_5e7defe0,"';
if ($haveLayout && function_exists('layout')) {
  echo layout($title, fn()=>print($wrap));
} else {
  echo """
legal/rechtlich.php,80,text,,rechtlich_title_c9dc48a9,{$title}
lfg/inbox.php,34,text,,inbox_spielersuche_ea7159bb,Spielersuche
lfg/inbox.php,39,text,,inbox_home_fc8351a4,Home
lfg/inbox.php,49,text,,inbox_spielersuche_ea7159bb,Spielersuche
lfg/inbox.php,64,text,,inbox_spielersuche_postfach_c14204bd,"Spielersuche Postfach"
lfg/inbox.php,69,text,,inbox_lfg_create_php_class_btn_btn_md_btn_primary_rounded_12_mb_62e5e14d,"/lfg/create.php"" class=""btn btn-md btn-primary rounded-12 mb-16p"">
                                        Eigenen Eintrag erstellen"
lfg/inbox.php,74,text,,inbox_lfg_index_php_class_btn_btn_md_btn_primary_rounded_12_mb_86da8207,"/lfg/index.php"" class=""btn btn-md btn-primary rounded-12 mb-16p"">
                                        √úbersicht"
lfg/inbox.php,105,text,,inbox_eingang_offen_27c095fc,"Eingang (offen)"
lfg/inbox.php,106,text,,inbox_angenommen_deeb42fc,Angenommen
lfg/inbox.php,107,text,,inbox_abgelehnt_bace0bd6,Abgelehnt
lfg/inbox.php,108,text,,inbox_alle_a27e593d,Alle
lfg/inbox.php,109,text,,inbox_gesendet_a22e5093,Gesendet
lfg/inbox.php,128,text,,inbox_i18n_mask_script_0_e6859002,%%I18N_MASK_SCRIPT_0%%
lfg/create.php,24,text,,create_assets_images_searchbanner_webp_18da8ccc,"/assets/images/searchBanner.webp');"">"
lfg/create.php,28,text,,create_spielersuche_erstellen_a125540f,"Spielersuche erstellen"
lfg/create.php,33,text,,create_home_7c0be0c3,Home
lfg/create.php,43,text,,create_spielersuche_erstellen_a125540f,"Spielersuche erstellen"
lfg/create.php,58,text,,create_eintrag_ausfullen_a8dca98e,"Eintrag ausf√ºllen"
lfg/create.php,59,text,,create_mmr_kd_modus_spielstil_sprache_und_zeiten_damit_andere_9398120e,"MMR, KD, Modus, Spielstil, Sprache und Zeiten ‚Äì damit andere dich finden k√∂nnen."
lfg/create.php,64,text,,create_lfg_index_php_class_btn_btn_md_btn_primary_rounded_12_mb_d1c39a4e,"/lfg/index.php"" class=""btn btn-md btn-primary rounded-12 mb-16p"">√úbersicht"
lfg/create.php,65,text,,create_lfg_inbox_php_class_btn_btn_md_btn_secondary_rounded_12_m_bca0cd91,"/lfg/inbox.php"" class=""btn btn-md btn-secondary rounded-12 mb-16p"">Postfach"
lfg/create.php,86,text,,create_plattform_e6256ac2,Plattform
lfg/create.php,88,text,,create_pc_3fe667e6,PC
lfg/create.php,89,text,,create_xbox_310c833b,XBOX
lfg/create.php,90,text,,create_ps_7e18a81f,PS
lfg/create.php,95,text,,create_region_6744012f,Region
lfg/create.php,97,text,,create_eu_2854b7fa,EU
lfg/create.php,98,text,,create_na_f2b32f94,NA
lfg/create.php,99,text,,create_sa_67033c1c,SA
lfg/create.php,100,text,,create_asia_838c6eed,ASIA
lfg/create.php,101,text,,create_oce_6ab0d6da,OCE
lfg/create.php,106,text,,create_mmr_514ced9e,MMR
lfg/create.php,111,text,,create_kd_c622ad5c,KD
lfg/create.php,116,text,,create_primare_waffe_ac911f18,"Prim√§re Waffe"
lfg/create.php,121,text,,create_modus_52cf8ea7,Modus
lfg/create.php,123,text,,create_bounty_7181834a,bounty
lfg/create.php,124,text,,create_clash_120785ba,clash
lfg/create.php,125,text,,create_both_a0e43609,both
lfg/create.php,130,text,,create_spielstil_9fddb134,Spielstil
lfg/create.php,132,text,,create_balanced_871c3d86,balanced
lfg/create.php,133,text,,create_offensive_b337657f,offensive
lfg/create.php,134,text,,create_defensive_34514a46,defensive
lfg/create.php,139,text,,create_headset_c53c8aa0,Headset
lfg/create.php,141,text,,create_ja_f2ab5655,ja
lfg/create.php,142,text,,create_nein_011dc4d1,nein
lfg/create.php,147,text,,create_sprachen_csv_63e597fc,"Sprachen (CSV)"
lfg/create.php,152,text,,create_suche_bbb55b1e,Suche
lfg/create.php,154,text,,create_any_71595f56,any
lfg/create.php,156,text,,create_duo_9934dc61,duo
lfg/create.php,157,text,,create_trio_eeba6f29,trio
lfg/create.php,162,text,,create_zeiten_json_2d97c0ce,"Zeiten (JSON)"
lfg/create.php,167,text,,create_ablaufdatum_65162e15,Ablaufdatum
lfg/create.php,174,text,,create_notiz_d966f009,Notiz
lfg/create.php,174,text,,create_i18n_mask_textarea_1_2b07b9cc,%%I18N_MASK_TEXTAREA_1%%
lfg/create.php,179,text,,create_speichern_e5662783,Speichern
lfg/create.php,180,text,,create_lfg_index_php_class_btn_rounded_12_zuruck_929b03f1,"/lfg/index.php"" class=""btn rounded-12"">Zur√ºck"
lfg/create.php,189,text,,create_i18n_mask_script_0_50a73cbb,%%I18N_MASK_SCRIPT_0%%
lfg/create.php,107,attr,placeholder,create_placeholder_z_b_3000_470319df,"z. B. 3000"
lfg/create.php,112,attr,placeholder,create_placeholder_z_b_1_20_4dd65f70,"z. B. 1.20"
lfg/create.php,117,attr,placeholder,create_placeholder_z_b_sparks_59a5851d,"z. B. Sparks"
lfg/create.php,148,attr,placeholder,create_placeholder_de_en_1154e0f7,"de,en"
lfg/create.php,88,attr,value,create_value_pc_3dd402b9,pc
lfg/create.php,89,attr,value,create_value_xbox_5c1ca138,xbox
lfg/create.php,90,attr,value,create_value_ps_a493d5bb,ps
lfg/create.php,97,attr,value,create_value_eu_50b54d63,eu
lfg/create.php,98,attr,value,create_value_na_f726066b,na
lfg/create.php,99,attr,value,create_value_sa_8dfa31ff,sa
lfg/create.php,100,attr,value,create_value_asia_20c92481,asia
lfg/create.php,101,attr,value,create_value_oce_085425aa,oce
lfg/create.php,123,attr,value,create_value_bounty_6b0c397f,bounty
lfg/create.php,124,attr,value,create_value_clash_9e0c66e7,clash
lfg/create.php,125,attr,value,create_value_both_7ea069e9,both
lfg/create.php,132,attr,value,create_value_balanced_1edc541e,balanced
lfg/create.php,133,attr,value,create_value_offensive_2405976a,offensive
lfg/create.php,134,attr,value,create_value_defensive_334b899d,defensive
lfg/create.php,141,attr,value,create_value_1_728242b7,1
lfg/create.php,142,attr,value,create_value_0_2a370f93,0
lfg/create.php,154,attr,value,create_value_any_2f32b18a,any
lfg/create.php,156,attr,value,create_value_duo_37b191a6,duo
lfg/create.php,157,attr,value,create_value_trio_6a5c5f7c,trio
lfg/index.php,18,text,,index_i18n_mask_style_1_ca17aa6e,%%I18N_MASK_STYLE_1%%
lfg/index.php,37,text,,index_spielersuche_45f96d87,Spielersuche
lfg/index.php,42,text,,index_home_cf041eb3,Home
lfg/index.php,52,text,,index_spielersuche_45f96d87,Spielersuche
lfg/index.php,67,text,,index_spielersuche_45f96d87,Spielersuche
lfg/index.php,72,text,,index_lfg_create_php_class_btn_btn_md_btn_primary_rounded_12_mb_1dabc043,"/lfg/create.php"" class=""btn btn-md btn-primary rounded-12 mb-16p"">
                                        Eigenen Eintrag erstellen"
lfg/index.php,77,text,,index_lfg_inbox_php_class_btn_btn_md_btn_primary_rounded_12_mb_ae6795de,"/lfg/inbox.php"" class=""btn btn-md btn-primary rounded-12 mb-16p"">
                                        Postfach"
lfg/index.php,105,text,,index_plattform_c7af65ef,Plattform
lfg/index.php,105,text,,index_pc_e3e90d6d,pc
lfg/index.php,105,text,,index_xbox_4783a689,xbox
lfg/index.php,105,text,,index_ps_b9a5f7c2,ps
lfg/index.php,106,text,,index_region_68106515,Region
lfg/index.php,106,text,,index_eu_2b052acd,eu
lfg/index.php,106,text,,index_na_bef00f7d,na
lfg/index.php,106,text,,index_sa_fb63ff02,sa
lfg/index.php,106,text,,index_asia_ec1e118e,asia
lfg/index.php,106,text,,index_oce_ee67dcf5,oce
lfg/index.php,107,text,,index_modus_fb6d7001,Modus
lfg/index.php,107,text,,index_bounty_2e9ecc0a,bounty
lfg/index.php,107,text,,index_clash_af3fac5e,clash
lfg/index.php,107,text,,index_both_0e1a9218,both
lfg/index.php,108,text,,index_spielstil_1c1653a4,Spielstil
lfg/index.php,108,text,,index_offensive_da7722b3,offensive
lfg/index.php,108,text,,index_defensive_d3a711a8,defensive
lfg/index.php,108,text,,index_balanced_97800693,balanced
lfg/index.php,109,text,,index_sucht_f737cd75,Sucht
lfg/index.php,109,text,,index_solo_cad6be5e,solo
lfg/index.php,109,text,,index_duo_4198d029,duo
lfg/index.php,109,text,,index_trio_44189992,trio
lfg/index.php,109,text,,index_any_1785f4ee,any
lfg/index.php,110,text,,index_headset_2f958297,Headset
lfg/index.php,110,text,,index_ja_3523ac22,ja
lfg/index.php,110,text,,index_nein_5102e9fb,nein
lfg/index.php,129,text,,index_username_29386648,Username
lfg/index.php,130,text,,index_plattform_c7af65ef,Plattform
lfg/index.php,131,text,,index_region_68106515,Region
lfg/index.php,132,text,,index_details_32c85066,Details
lfg/index.php,174,text,,index_spielanfrage_senden_5f97325f,"Spielanfrage senden"
lfg/index.php,179,text,,index_nachricht_optional_943b3008,"Nachricht (optional)"
lfg/index.php,179,text,,index_i18n_mask_textarea_2_9c93b2e5,%%I18N_MASK_TEXTAREA_2%%
lfg/index.php,185,text,,index_abbrechen_7ad90699,Abbrechen
lfg/index.php,186,text,,index_senden_ceb3339f,Senden
lfg/index.php,191,text,,index_i18n_mask_script_0_bc1ec40b,%%I18N_MASK_SCRIPT_0%%
lfg/index.php,172,attr,title,index_title_schliessen_4f2f4bfd,Schlie√üen
lfg/index.php,112,attr,placeholder,index_placeholder_suche_notiz_waffe_f9dadfdb,"Suche (Notiz/Waffe)"
lfg/index.php,113,attr,placeholder,index_placeholder_sprache_de_en_bc23c495,"Sprache (de,en)"
lfg/index.php,114,attr,placeholder,index_placeholder_min_mmr_c0b0f743,"min MMR"
lfg/index.php,115,attr,placeholder,index_placeholder_max_mmr_327edf3c,"max MMR"
lfg/index.php,116,attr,placeholder,index_placeholder_min_kd_cd0f5661,"min KD"
lfg/index.php,117,attr,placeholder,index_placeholder_max_kd_887ffda0,"max KD"
lfg/index.php,171,attr,aria-label,index_aria-label_spielanfrage_12a4fe84,Spielanfrage
lfg/index.php,107,attr,value,index_value_bounty_347277f6,bounty
lfg/index.php,107,attr,value,index_value_clash_2d6fbc7b,clash
lfg/index.php,107,attr,value,index_value_both_df77f667,both
lfg/index.php,110,attr,value,index_value_1_b3afcecf,1
lfg/index.php,110,attr,value,index_value_0_54e2e9b1,0
user.php,29,text,,user_null_aliasen_damit_key_existiert_select_col_d3ea1c67,"NULL aliasen, damit Key existiert)
$select .=
  "", "" . ($colExists('users','social_twitch')    ? ""social_twitch""    : ""NULL AS social_twitch"") .
  "", "" . ($colExists('users','social_tiktok')    ? ""social_tiktok""    : ""NULL AS social_tiktok"") .
  "", "" . ($colExists('users','social_youtube')   ? ""social_youtube""   : ""NULL AS social_youtube"") .
  "", "" . ($colExists('users','social_instagram') ? ""social_instagram"" : ""NULL AS social_instagram"") .
  "", "" . ($colExists('users','social_twitter')   ? ""social_twitter""   : ""NULL AS social_twitter"") .
  "", "" . ($colExists('users','social_facebook')  ? ""social_facebook""  : ""NULL AS social_facebook"") .
  "", "" . ($colExists('users','is_twitch_streamer') ? ""is_twitch_streamer"" : ""0 AS is_twitch_streamer"");

$sql = ""
    SELECT $select
    FROM users
    WHERE "" . ($slug !== '' ? ""slug = ?"" : ""id = ?"") . ""
    LIMIT 1
"";
$st = $pdo->prepare($sql);
$st->execute([$slug !== '' ? $slug : $id]);
$user = $st->fetch(PDO::FETCH_ASSOC);

if (!$user) {
    http_response_code(404);
    echo 'Profil nicht gefunden.';
    exit;
}

/* Assets (Root-kompatibel) */
$avatar = $user['avatar_path'] ?: ($APP_BASE . '/assets/images/avatars/placeholder.png');
$cover  = $user['cover_path']  ?: ($APP_BASE . '/assets/images/cover-placeholder.jpg');

/* Cover-Parameter (f√ºr dein JS) */
$coverU   = isset($user['cover_x']) ? (float)$user['cover_x'] : null;
$coverV   = isset($user['cover_y']) ? (float)$user['cover_y'] : null;
$coverRel = isset($user['cover_scale']) ? (float)$user['cover_scale'] : null;

$memberSince = date('d.m.Y', strtotime((string)$user['created_at']));

/* Threads des Users */
$th = $pdo->prepare(""
    SELECT
        t.id,
        t.title,
        t.slug,
        t.created_at,
        t.posts_count,
        t.likes_count,
        (
            SELECT p.content
            FROM posts p
            WHERE p.thread_id = t.id
            ORDER BY p.id ASC
            LIMIT 1
        ) AS first_content
    FROM threads t
    WHERE t.author_id = ?
    ORDER BY t.created_at DESC
    LIMIT 20
"");
$th->execute([(int)$user['id']]);
$userThreads = $th->fetchAll(PDO::FETCH_ASSOC) ?: [];

/* Helper */
function twitch_handle(?string $val): ?string {
  $v = trim((string)$val);
  if ($v === '') return null;
  if (($v[0] ?? '') === '@') $v = substr($v, 1);
  return trim($v, ""/ \t\r\n"") ?: null;
}
$TW_HANDLE = twitch_handle($user['social_twitch'] ?? null);
$TW_PARENT = htmlspecialchars($_SERVER['HTTP_HOST'] ?? 'hunthub.online', ENT_QUOTES);
function thread_preview_from_html(?string $html, int $max = 280): string {
    $txt = trim(preg_replace('/\s+/u', ' ', strip_tags((string)$html)));
    return (mb_strlen($txt, 'UTF-8') > $max)
        ? (mb_substr($txt, 0, $max - 1, 'UTF-8') . '‚Ä¶')
        : $txt;
}
/* === Freunde des Profil-Inhabers laden === */
$friendsLimit = 9; // Sidebar: 3 x 3

// Versuche die Helper-Funktion aus lib/friends.php zu nutzen ‚Ä¶
$friendRows = [];
try {
    require_once __DIR__ . '/lib/friends.php'; // enth√§lt list_friends()
    if (function_exists('list_friends')) {
        $friendRows = list_friends($pdo, (int)$user['id'], $friendsLimit, 0);
    }
} catch (Throwable $e) {
    // ignoriere ‚Äì wir nutzen den SQL-Fallback unten
}

// Fallback (falls lib/friends.php nicht vorhanden ist)
if (!$friendRows) {
    $sql = t('user_select_u_id_u_display_name_u_slug_u_avatar_path_f_update_20f7553e');
    $stFr = $pdo->prepare($sql);
    $stFr->execute([(int)$user['id'], (int)$user['id'], (int)$user['id'], $friendsLimit]);
    $friendRows = $stFr->fetchAll(PDO::FETCH_ASSOC) ?: [];
}

$requestedId = (int)$user['id'];                   // ‚Üê immer die echte Profil-ID verwenden
$tab = $_GET['tab'] ?? 'posts';
$validTabs = ['posts','bewertungen','achv'];
if (!in_array($tab, $validTabs, true)) $tab = t('user_posts_813025d8');

$pdo = db();

/* --- Helpers --------------------------------------------------------- */
function table_cols(PDO $pdo, string $table): array {
  try { return $pdo->query(""SHOW COLUMNS FROM `{$table}`"")->fetchAll(PDO::FETCH_COLUMN, 0) ?: []; }
  catch (\Throwable $e) { return []; }
}
function has_table(PDO $pdo, string $table): bool {
  try { $list = $pdo->query(""SHOW TABLES"")->fetchAll(PDO::FETCH_COLUMN, 0); return in_array($table,$list,true); }
  catch (\Throwable $e) { return false; }
}

/* --- Profil laden (dynamisch nur vorhandene Spalten) ----------------- */
$uCols = table_cols($pdo, 'users');
$select = ['id'];
if (in_array('display_name',$uCols,true)) $select[] = t('user_display_name_6cce27a8');
if (in_array('username',    $uCols,true)) $select[] = t('user_username_a206c42f');
if (in_array('avatar_url',  $uCols,true)) $select[] = t('user_avatar_url_8ab0a4b6');
elseif (in_array('avatar',  $uCols,true)) $select[] = t('user_avatar_as_avatar_url_eb9a4721');
if (in_array('created_at',  $uCols,true)) $select[] = t('user_created_at_30adf532');
else $select[] = t('user_now_as_created_at_dde29c16');

$st = $pdo->prepare(""SELECT "".implode(',', $select)."" FROM `users` WHERE id=? LIMIT 1"");
$st->execute([$requestedId]);
$profile = $st->fetch();
if (!$profile) { http_response_code(404); exit('User not found'); }

/* --- Daten f√ºr Posts (robust, schema-agnostisch) --------------------- */
$errPosts = null; $posts = [];
if ($tab === 'posts') {
  try {
    // Kandidatentabellen f√ºr Threads/Beitr√§ge
    $table = null;
    foreach (['threads','posts','user_posts'] as $try) {
      if (has_table($pdo, $try)) { $table = $try; break; }
    }
    if ($table) {
      $tcols = table_cols($pdo, $table);
      $id   = in_array('id',$tcols,true) ? 'id' : (in_array('post_id',$tcols,true)?'post_id':'id');
      $uid  = in_array('user_id',$tcols,true) ? 'user_id' : (in_array('author_id',$tcols,true)?'author_id':'user_id');
      $tit  = in_array('title',$tcols,true) ? 'title' : (in_array('subject',$tcols,true)?'subject':null);
      $body = in_array('body',$tcols,true) ? 'body'  : (in_array('content',$tcols,true)?'content':(in_array('text',$tcols,true)?'text':null));
      $dt   = in_array('created_at',$tcols,true)?'created_at':(in_array('created',$tcols,true)?'created':(in_array('posted_at',$tcols,true)?'posted_at':null));

      $sel = [""t.`$id` AS id""];
      $sel[] = $tit  ? ""t.`$tit`  AS title""      : ""NULL AS title"";
      $sel[] = $body ? ""t.`$body` AS body""       : ""NULL AS body"";
      $sel[] = $dt   ? ""t.`$dt`   AS created_at"" : ""NOW() AS created_at"";
      // Replies/Likes optional (Tabellen evtl. nicht vorhanden)
      $sel[] = has_table($pdo,'comments') ? ""(SELECT COUNT(*) FROM comments c WHERE c.thread_id = t.`$id`) AS replies"" : ""0 AS replies"";
      $sel[] = has_table($pdo,'likes')    ? ""(SELECT COUNT(*) FROM likes    l WHERE l.thread_id    = t.`$id`) AS likes""   : ""0 AS likes"";

      $order = $dt ? ""t.`$dt` DESC"" : ""t.`$id` DESC"";
      $sql = t('user_select_d200ebf3').implode(',', $sel)."" FROM `$table` t WHERE t.`$uid`=? ORDER BY $order LIMIT 50"";
      $st = $pdo->prepare($sql);
      $st->execute([$requestedId]);
      $posts = $st->fetchAll() ?: [];
    } else {
      $errPosts = t('user_keine_tabelle_threads_posts_user_posts_gefunden_5e3dd43e');
    }
  } catch (\Throwable $e) {
    $errPosts = t('user_beitrage_konnten_nicht_geladen_werden_2fefd77a').$e->getMessage();
  }
}

/* --- Partial rendern ------------------------------------------------- */
$partialsDir = __DIR__ . '/partials';
$map = [
  'posts'   => $partialsDir.'/profile.posts.php',
  'bewertungen' => $partialsDir.'/profile.bewertungen.php', // (optional)
  'achv'    => $partialsDir.'/profile.achv.php',    // (optional)
];
$partial = is_file($map[$tab] ?? '') ? $map[$tab] : $map['posts'];

ob_start();
$__tab     = $tab;
$__user    = $profile;
$__posts   = $posts;
$__errTab  = $tab === 'posts' ? $errPosts : null;
include $partial;
$partialHtml = ob_get_clean();

/* --- Partial-Modus ausliefern? -------------------------------------- */
$isPartial = (isset($_GET['partial']) && $_GET['partial'] === '1')
          || (isset($_SERVER['HTTP_X_PARTIAL']) && $_SERVER['HTTP_X_PARTIAL'] === '1');

if ($isPartial) {
  header('Content-Type: text/html; charset=utf-8');
  echo $partialHtml; exit;
}
// Anzahl Freunde (f√ºr die √úberschrift/Badge)
$stCnt = $pdo->prepare(""
    SELECT COUNT(*) FROM friendships f
    WHERE (f.requester_id = ? OR f.addressee_id = ?) AND f.status = 'accepted'
"");
$stCnt->execute([(int)$user['id'], (int)$user['id']]);
$friendCount = (int)$stCnt->fetchColumn();
$socials = [
  'twitch'    => $user['social_twitch']    ?? null,
  'tiktok'    => $user['social_tiktok']    ?? null,
  'youtube'   => $user['social_youtube']   ?? null,
  'instagram' => $user['social_instagram'] ?? null,
  'twitter'   => $user['social_twitter']   ?? null,
  'facebook'  => $user['social_facebook']  ?? null,
  
];

$icons = [
  'twitch'    => '"
user.php,240,text,,user_tiktok_83de0c73,"',
  'tiktok'    => '"
user.php,241,text,,user_youtube_148bc85e,"',
  'youtube'   => '"
user.php,242,text,,user_instagram_d7ba964e,"',
  'instagram' => '"
user.php,243,text,,user_twitter_93ca1631,"',
  'twitter'   => '"
user.php,244,text,,user_facebook_955d56e4,"',
  'facebook'  => '"
user.php,315,attr,title,user_title_t_user_title_twitch_streamer_d23ada49_38055a90,"<?= t('user_title_twitch_streamer_d23ada49') ?>"
user.php,333,attr,title,user_title_t_user_title_was_ist_das_hhr_c8eb16a0_810d6a6e,"<?= t('user_title_was_ist_das_hhr_c8eb16a0') ?>"
reset.php,53,text,,reset_i18n_mask_script_0_e69703d7,%%I18N_MASK_SCRIPT_0%%
reset.php,38,attr,value,reset_value_htmlspecialchars_token_ent_quotes_utf_8_4beec06a,"<?= htmlspecialchars($token, ENT_QUOTES, 'UTF-8') ?>"
lib/partials/user_menu.php,42,text,,user_menu_i18n_mask_style_1_b3edfc59,%%I18N_MASK_STYLE_1%%
lib/partials/user_menu.php,48,text,,user_menu_alt_09cd79e0,""" alt="""">"
lib/partials/user_menu.php,54,text,,user_menu_nicht_angemeldet_e555c77c,"Nicht angemeldet"
lib/partials/user_menu.php,63,text,,user_menu_role_menuitem_profil_dfc928d0,""" role=""menuitem"">Profil"
lib/partials/user_menu.php,66,text,,user_menu_role_menuitem_einstellungen_5fe797f3,""" role=""menuitem"">Einstellungen"
lib/partials/user_menu.php,69,text,,user_menu_role_menuitem_admin_34ed8dc8,""" role=""menuitem"">Admin"
lib/partials/user_menu.php,72,text,,user_menu_role_menuitem_logout_c9b038d6,""" role=""menuitem"">Logout"
lib/partials/user_menu.php,74,text,,user_menu_role_menuitem_hilfe_fe1fb045,""" role=""menuitem"">Hilfe"
lib/partials/user_menu.php,77,text,,user_menu_method_post_7a5c5d3d,""" method=""post"">"
lib/partials/user_menu.php,83,text,,user_menu_einloggen_ea460f37,Einloggen
lib/partials/user_menu.php,85,text,,user_menu_registrieren_e0f09dad,""">Registrieren"
lib/partials/user_menu.php,80,attr,placeholder,user_menu_placeholder_e_mail_f6d9732e,E-Mail
lib/partials/user_menu.php,81,attr,placeholder,user_menu_placeholder_passwort_bbe299db,Passwort
lib/partials/user_menu.php,78,attr,value,user_menu_value_htmlspecialchars_csrf_ent_quotes_utf_8_8c5fdb7a,"<?= htmlspecialchars($csrf, ENT_QUOTES, 'UTF-8') ?>"
lib/partials/user_menu.php,79,attr,value,user_menu_value_htmlspecialchars_redirectback_ent_quotes_utf_8_52735916,"<?= htmlspecialchars($redirectBack, ENT_QUOTES, 'UTF-8') ?>"
lib/layout.php,15,text,,layout_sessionname_cfg_cookies_session_name_c_3a6cd3b1,"''
$sessionName  = $cfg['cookies']['session_name'] ?? '';
$csrf         = issue_csrf($pdo, $_COOKIE[$sessionName] ?? ''); // stellt Meta-Token etc. bereit
require_once __DIR__ . '/../lib/i18n_runtime.php';

$lang = $_GET['lang']
     ?? ($_COOKIE['lang'] ?? '')
     ?: (function_exists('detect_lang') ? detect_lang() : 'de');

$lang = in_array($lang, ['de','en'], true) ? $lang : 'de';
$GLOBALS['L'] = load_lang($lang);   //"
lib/layout.php,45,text,,layout_server_request_uri_adc434ae,"$_SERVER['REQUEST_URI'] ?? '']);


// -------------------------------------------------------------
// i18n ‚Äì erlaubte Sprachen & Defaults
// -------------------------------------------------------------
const LANGS_ALLOWED = ['de','en'];
const LANG_DEFAULT  = 'de';

/**
 * Ermittelt aktuelle Sprache aus ?lang=‚Ä¶, Cookie oder Default.
 * Setzt bei ?lang=‚Ä¶ zus√§tzlich ein Cookie (1 Jahr).
 */
function detect_lang(): string {
    $get    = isset($_GET['lang'])    ? strtolower(trim((string)$_GET['lang']))    : null;
    $cookie = isset($_COOKIE['lang']) ? strtolower(trim((string)$_COOKIE['lang'])) : null;

    $lang = $get ?: $cookie ?: LANG_DEFAULT;
    if (!in_array($lang, LANGS_ALLOWED, true)) {
        $lang = LANG_DEFAULT;
    }

    if ($get) {
        $secure   = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off');
        $sameSite = 'Lax';
        setcookie('lang', $lang, [
            'expires'  => time() + 60*60*24*365,
            'path'     => '/',
            'secure'   => $secure,
            'httponly' => true,
            'samesite' => $sameSite,
        ]);
        // f√ºr diesen Request direkt verf√ºgbar machen
        $_COOKIE['lang'] = $lang;
    }

    return $lang;
}

/**
 * L√§dt Sprachdatei als Array $L. Fallback auf Default, falls Datei fehlt.
 */
function load_lang(string $lang): array {
    $path = __DIR__ . ""/../lang/{$lang}.php"";
    if (is_file($path)) {
        /** @var array $L */
        $L = require $path;
        if (is_array($L)) {
            return $L;
        }
    }
    $fallback = __DIR__ . ""/../lang/"" . LANG_DEFAULT . "".php"";
    return is_file($fallback) ? (require $fallback) : [];
}

/**
 * √úbersetzer: t('key', ...$args) ‚Üí vsprintf-Unterst√ºtzung: ""Hi %s""
 */
if (!function_exists('t')) {
    function t(string $key, mixed ...$args): string {
        /** @var array $L */
        $L = $GLOBALS['L'] ?? [];
        $val = $L[$key] ?? $key;
        if ($args) {
            try { $val = @vsprintf($val, $args) ?: $val; } catch (\Throwable) {}
        }
        return $val;
    }
}

/**
 * Baut die aktuelle URL mit ge√§nderter Sprache (?lang=en/de) und
 * beh√§lt andere Query-Parameter bei.
 */
function build_lang_url(string $toLang): string {
    $uri  = $_SERVER['REQUEST_URI'] ?? '/';
    $u    = parse_url($uri);
    $path = $u['path'] ?? '/';
    parse_str($u['query'] ?? '', $qs);

    unset($qs['lang']);
    $qs['lang'] = $toLang;

    $query = http_build_query($qs);
    return $path . ($query ? ('?' . $query) : '');
}

/**
 * Generiert HTML-Buttons f√ºr den Sprachwechsel.
 * Nutze im Template:"
lib/layout.php,134,text,,layout_function_render_lang_switch_html_string_current_string_b9464c36,"*/
function render_lang_switch_html(string $current): string {
    $urlDe = build_lang_url('de');
    $urlEn = build_lang_url('en');

    $currDe = ($current === 'de') ? ' aria-current=""true""' : '';
    $currEn = ($current === 'en') ? ' aria-current=""true""' : '';

    // Tailwind/Utility-Klassen nur beispielhaft ‚Äì gerne anpassen
    return
      '"
lib/layout.php,146,text,,layout_deutsch_0cdeb29b,"üá©üá™ Deutsch"
lib/layout.php,147,text,,layout_english_91e3fdb3,"üá¨üáß English"
lib/layout.php,148,text,,layout_optional_hreflang_tags_fur_seo_in_defd8e92,"';
}

/**
 * Optional: hreflang-Tags f√ºr SEO in"
lib/layout.php,152,text,,layout_injizieren_nutze_im_template_b705903f,"injizieren.
 * Nutze im Template:"
lib/layout.php,153,text,,layout_function_build_hreflang_links_string_uri_s_bb57bc14,"*/
function build_hreflang_links(): string {
    $uri  = $_SERVER['REQUEST_URI'] ?? '/';
    $u    = parse_url($uri);
    $path = $u['path'] ?? '/';
    parse_str($u['query'] ?? '', $qs);
    unset($qs['lang']);

    $proto = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? 'https' : 'http';
    $host  = $_SERVER['HTTP_HOST'] ?? 'localhost';

    $links = [];
    foreach (LANGS_ALLOWED as $code) {
        $qs2 = $qs;
        $qs2['lang'] = $code;
        $url = $proto . '://' . $host . $path . (count($qs2) ? ('?' . http_build_query($qs2)) : '');
        $links[] = '"
lib/layout.php,170,text,,layout_x_default_qsdefault_qs_qsdefau_6ca713b0,"';
    }
    // x-default
    $qsDefault = $qs;
    $qsDefault['lang'] = LANG_DEFAULT;
    $urlDefault = $proto . '://' . $host . $path . (count($qsDefault) ? ('?' . http_build_query($qsDefault)) : '');
    $links[] = '"
lib/layout.php,176,text,,layout_return_implode_n_links_74678b67,"';

    return implode(""\n"", $links);
}

// -------------------------------------------------------------
// Theme-Rendering ‚Äì neuer Helfer f√ºr ""einfachen"" Seiten-Output
// -------------------------------------------------------------

/**
 * Rendert eine Seite im Theme mit i18n-Unterst√ºtzung.
 *
 * @param string $contentHtml HTML-Inhalt f√ºr den Content-Slot.
 * @param string $title"
lib/layout.php,189,text,,layout_text_rendert_eine_seite_im_theme_mit_i18n_und_1d0ef43a,"-Text.
 */
/**
 * Rendert eine Seite im Theme mit i18n- und SEO-Unterst√ºtzung.
 *
 * @param string $contentHtml HTML-Inhalt f√ºr den Content-Slot
 * @param string $title"
lib/layout.php,195,text,,layout_text_param_string_desc_meta_description_par_94764c28,"-Text
 * @param string $desc        Meta-Description
 * @param string $image       URL zu einem OG/Twitter-Bild (optional)
 */
function render_theme_page(
    string $contentHtml,
    string $title = 'Hunthub',
    string $desc = 'Hunthub ‚Äì Community Forum f√ºr Hunt: Showdown mit Events, Chat und Gamification.',
    string $image = '',
    ?string $schemaJson = null
): void {
    $templatePath = __DIR__ . '/../theme/page-template.php';
    if (!is_file($templatePath)) {
        http_response_code(500);
        header('Content-Type: text/plain; charset=utf-8');
        echo ""Template fehlt: $templatePath"";
        return;
    }

    // i18n vorbereiten
    $LANG               = detect_lang();                 
    $GLOBALS['L']       = load_lang($LANG);              
    $L                  = $GLOBALS['L'];                 
    $LANG_SWITCH_HTML   = render_lang_switch_html($LANG);
    $HREFLANG_LINKS     = build_hreflang_links();

    // Variablen f√ºrs Template
    $TITLE        = $title;
    $DESC         = $desc;
    $IMAGE        = $image ?: ($GLOBALS['APP_BASE'] . '/assets/images/og-default.jpg');
    $CONTENT      = $contentHtml;
    $SCHEMA_JSON  = $schemaJson; //"
lib/layout.php,239,text,,layout_i_html_html_preg_replace_dc482565,"#i', $html)) {
        $html = preg_replace(
            '#"
lib/layout.php,241,text,,layout_i_774c0151,"#i',
            '"
lib/layout.php,242,text,,layout_htmlspecialchars_title_ent_quotes_utf_8_384f92be,"' . htmlspecialchars($title, ENT_QUOTES, 'UTF-8') . '"
lib/layout.php,242,text,,layout_html_1_else_366b42fd,"',
            $html,
            1
        );
    } else {
        $html = str_replace('{{TITLE}}', htmlspecialchars($title, ENT_QUOTES, 'UTF-8'), $html);
    }

    header('Content-Type: text/html; charset=utf-8');
    echo $html;
}


if (!function_exists('first_post_image')) {
    /**
     * Findet das erste"
lib/layout.php,257,text,,layout_im_content_und_gibt_den_absoluten_url_zuruck_fe6df216,"im Content und gibt den absoluten URL zur√ºck.
     *
     * @param string $html  Post-Inhalt (HTML)
     * @param string $fallback Fallback-URL (z. B. Default-OG-Bild)
     * @return string
     */
    function first_post_image(string $html, string $fallback = ''): string {
        if (preg_match('/"
lib/layout.php,264,text,,layout_src_i_html_m_src_e6d9248a,"]+src=[""\']([^""\']+)[""\']/i', $html, $m)) {
            $src = $m[1];
            // Falls relativer Pfad ‚Üí absolut machen
            if (!preg_match('#^https?://#i', $src)) {
                $base = (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off' ? 'https' : 'http')
                      . '://' . ($_SERVER['HTTP_HOST'] ?? 'localhost');
                if ($src[0] !== '/') $src = '/' . $src;
                $src = $base . $src;
            }
            return $src;
        }
        return $fallback;
    }
}
if (!function_exists('h')) {
    function h(?string $s): string {
        return htmlspecialchars($s ?? '', ENT_QUOTES, 'UTF-8');
    }
}
if (!function_exists('hh_schema_event')) {
    /**
     * Turnier-Event (Schema.org Event)
     * @param array $t  Turnier-Row: id,name,description,starts_at,ends_at,platform,titelbild
     * @param string $base Absolute Basis-URL (APP_BASE, z.B. https://hunthub.online)
     */
    function hh_schema_event(array $t, string $base): string {
        $url = rtrim($base, '/') . '/tournaments/view.php?id=' . (int)($t['id'] ?? 0);
        $img = '';
        if (!empty($t['titelbild'])) {
            $img = (preg_match('#^https?://#i', $t['titelbild'])) ? $t['titelbild'] : rtrim($base, '/') . $t['titelbild'];
        }
        $data = [
            '@context' => 'https://schema.org',
            '@type' => 'Event',
            'name' => (string)($t['name'] ?? 'Tournament'),
            'startDate' => (string)($t['starts_at'] ?? ''),
            'endDate' => (string)($t['ends_at'] ?? ''),
            'eventStatus' => 'https://schema.org/EventScheduled',
            'eventAttendanceMode' => 'https://schema.org/OnlineEventAttendanceMode',
            'location' => [
                '@type' => 'VirtualLocation',
                'url' => $url,
            ],
            'organizer' => [
                '@type' => 'Organization',
                'name' => 'Hunthub Online',
                'url'  => rtrim($base, '/'),
            ],
            'description' => strip_tags((string)($t['description'] ?? '')),
            'url' => $url,
        ];
        if ($img) { $data['image'] = [$img]; }
        if (!empty($t['platform'])) {
            $data['about'] = ['@type' => 'Thing', 'name' => (string)$t['platform']];
        }
        return json_encode($data, JSON_UNESCAPED_UNICODE|JSON_UNESCAPED_SLASHES);
    }
}

if (!function_exists('hh_schema_forum_thread')) {
    /**
     * Forum-Thread (Schema.org DiscussionForumPosting)
     * @param array $thread  z.B. ['id','title','slug','created_at','updated_at']
     * @param array $op      erster Post: ['author_name','content','image'] optional
     * @param string $base   APP_BASE, z.B. https://hunthub.online
     */
    function hh_schema_forum_thread(array $thread, array $op, string $base): string {
        $url = rtrim($base, '/') . '/forum/thread.php?t=' . (int)($thread['id'] ?? 0);
        if (!empty($thread['slug'])) {
            $url .= '&slug=' . rawurlencode((string)$thread['slug']);
        }
        $img = '';
        if (!empty($op['image'])) {
            $img = (preg_match('#^https?://#i', $op['image'])) ? $op['image'] : rtrim($base, '/') . $op['image'];
        }
        $data = [
            '@context' => 'https://schema.org',
            '@type' => 'DiscussionForumPosting',
            'headline' => (string)($thread['title'] ?? 'Thread'),
            'articleBody' => trim(strip_tags((string)($op['content'] ?? ''))),
            'datePublished' => (string)($thread['created_at'] ?? ''),
            'dateModified'  => (string)($thread['updated_at'] ?? ''),
            'author' => [
                '@type' => 'Person',
                'name'  => (string)($op['author_name'] ?? 'User')
            ],
            'publisher' => [
                '@type' => 'Organization',
                'name'  => 'Hunthub Online',
                'url'   => rtrim($base, '/'),
            ],
            'url' => $url,
            'mainEntityOfPage' => $url,
        ];
        if ($img) { $data['image'] = [$img]; }
        return json_encode($data, JSON_UNESCAPED_UNICODE|JSON_UNESCAPED_SLASHES);
    }
}

if (!function_exists('hh_schema_collection')) {
    /**
     * Board-√úbersicht (Schema.org CollectionPage)
     * @param string $name   Boardname
     * @param string $base   APP_BASE
     * @param string $path   z.B. '/forum/board.php?b=123'
     * @param string $desc   Kurzbeschreibung
     */
    function hh_schema_collection(string $name, string $base, string $path, string $desc=''): string {
        $url = rtrim($base, '/') . $path;
        $data = [
            '@context' => 'https://schema.org',
            '@type' => 'CollectionPage',
            'name' => $name,
            'description' => (string)$desc,
            'url' => $url,
            'isPartOf' => [
                '@type' => 'WebSite',
                'name'  => 'Hunthub Online',
                'url'   => rtrim($base, '/'),
            ],
        ];
        return json_encode($data, JSON_UNESCAPED_UNICODE|JSON_UNESCAPED_SLASHES);
    }
}

// -------------------------------------------------------------
// Abw√§rtskompatible Wrapper: start_layout()/end_layout()
// -------------------------------------------------------------

/**
 * Viele deiner bestehenden Seiten rufen start_layout($title) ‚Ä¶ end_layout().
 * Diese Wrapper binden weiterhin header/footer ein und initialisieren i18n.
 */
function start_layout(string $title = 'Hunthub'): void {
    // i18n global bereitstellen
    $LANG         = detect_lang();
    $GLOBALS['L'] = load_lang($LANG);

    $APP_BASE = $GLOBALS['APP_BASE'] ?? '';
    $csrf     = $GLOBALS['csrf']     ?? '';
    $L        = $GLOBALS['L']        ?? [];

    // Optional f√ºr Templates:
    $LANG_SWITCH_HTML = render_lang_switch_html($LANG);
    $HREFLANG_LINKS   = build_hreflang_links();

    // Header einbinden (falls vorhanden)
    $header = __DIR__ . '/../theme/header.php';
    if (is_file($header)) {
        // Variablen f√ºr header.php verf√ºgbar machen:
        $TITLE = $title;
        include $header;
    } else {
        // Minimaler Fallback, falls header.php fehlt
        echo """
lib/layout.php,418,text,,layout_n_b839d0f5,"\n"
lib/layout.php,418,text,,layout_n_b839d0f5,"\n"
lib/layout.php,418,text,,layout_n_echo_5c5e55c6,"\n"";
        echo """
lib/layout.php,419,text,,layout_n_echo_5c5e55c6,"\n"";
        echo """
lib/layout.php,420,text,,layout_n_echo_5c5e55c6,"\n"";
        echo """
lib/layout.php,421,text,,layout_htmlspecialchars_title_534c3770,""".htmlspecialchars($title)."""
lib/layout.php,421,text,,layout_n_echo_hreflang_links_n_echo_65a5d9bf,"\n"";
        echo $HREFLANG_LINKS . ""\n"";
        echo """
lib/layout.php,423,text,,layout_n_b839d0f5,"\n"
lib/layout.php,423,text,,layout_n_markiere_als_gestartet_fur_end_layout_eee435df,"\n"";
    }

    // Markiere als gestartet (f√ºr end_layout)
    $GLOBALS['__layout_started'] = true;
}

/**
 * Schlie√üt die Layout-Ausgabe mit theme/footer.php (oder Fallback) ab.
 */
function end_layout(): void {
    $footer = __DIR__ . '/../theme/footer.php';
    if (is_file($footer)) {
        include $footer;
    } else {
        echo ""\n"
lib/layout.php,438,text,,layout_n_b839d0f5,"\n"
lib/layout.php,438,text,,layout_unset_globals_layout_started_a604a1a2,""";
    }
    unset($GLOBALS['__layout_started']);
}

// -------------------------------------------------------------
// Kleine Helfer (optional)
// -------------------------------------------------------------

if (!function_exists('e')) {
    /** HTML-escape */
    function e(?string $s): string {
        return htmlspecialchars((string)($s ?? ''), ENT_QUOTES, 'UTF-8');
    }
}
// -------------------------------------------------------------
// SEO Helper
// -------------------------------------------------------------
if (!function_exists('seo_meta')) {
    /**
     * Erzeugt Title-, Description-, OG- und Twitter-Meta-Tags.
     *
     * @param string $title   Seitentitel
     * @param string $desc    Seitenbeschreibung
     * @param string $image   Absolute URL zu einem Bild (optional)
     * @return string HTML f√ºr"
lib/layout.php,463,text,,layout_function_seo_meta_string_title_string_desc_string_9c1cc9c1,"*/
    function seo_meta(string $title, string $desc, string $image = ''): string {
        $base = (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off' ? 'https' : 'http')
              . '://' . ($_SERVER['HTTP_HOST'] ?? 'localhost');
        $url  = $base . ($_SERVER['REQUEST_URI'] ?? '/');

        $html = [];
        $html[] = '"
lib/layout.php,471,text,,layout_htmlspecialchars_title_ent_quotes_utf_8_384f92be,"' . htmlspecialchars($title, ENT_QUOTES, 'UTF-8') . '"
lib/layout.php,471,text,,layout_html_6825d9d1,"';
        $html[] = '"
lib/layout.php,472,text,,layout_html_6825d9d1,"';
        $html[] = '"
lib/layout.php,473,text,,layout_opengraph_html_c917f2ef,"';

        // OpenGraph
        $html[] = '"
lib/layout.php,476,text,,layout_html_6825d9d1,"';
        $html[] = '"
lib/layout.php,477,text,,layout_html_6825d9d1,"';
        $html[] = '"
lib/layout.php,478,text,,layout_if_image_html_683f8bf1,"';
        if ($image) {
            $html[] = '"
lib/layout.php,480,text,,layout_twitter_html_c02c3f28,"';
        }

        // Twitter
        $html[] = '"
lib/layout.php,484,text,,layout_html_6825d9d1,"';
        $html[] = '"
lib/layout.php,485,text,,layout_html_6825d9d1,"';
        $html[] = '"
lib/layout.php,486,text,,layout_if_image_html_683f8bf1,"';
        if ($image) {
            $html[] = '"
lib/ratings.php,14,text,,ratings_prepare_sql_st_execute_userid_row_st_fetch_e10b8a8e,"prepare($sql);
$st->execute([$userId]);
$row = $st->fetch(PDO::FETCH_ASSOC) ?: [];


$cnt = (int)($row['cnt'] ?? 0);
$avg_play = $cnt ? (float)$row['avg_play'] : 0.0;
$avg_friendly = $cnt ? (float)$row['avg_friendly'] : 0.0;
$avg_helpful = $cnt ? (float)$row['avg_helpful'] : 0.0;
$avg_overall = $cnt ? (float)$row['avg_overall'] : 0.0;
$stars = $cnt ? hhr_round_stars($avg_overall) : 0;


// Verteilung 1..6 nach GERUNDETEM Einzelergebnis
$dist = [1=>0,2=>0,3=>0,4=>0,5=>0,6=>0];
if ($cnt) {
$sql2 = ""
SELECT ROUND((play + friendly + helpful)/3.0) AS r, COUNT(*) AS c
FROM user_ratings
WHERE ratee_id = ?
GROUP BY r
"";
$st2 = $pdo->prepare($sql2);
$st2->execute([$userId]);
while ($d = $st2->fetch(PDO::FETCH_ASSOC)) {
$r = (int)$d['r'];
if ($r"
lib/gamification.php,11,text,,gamification_0_val_abs_value_sql_insert_i_ead1d7f7,"0) ? '+' : '-';
    $val = abs($value);
    $sql = ""INSERT INTO user_stats (user_id, `$stat`) VALUES (?, ?)
            ON DUPLICATE KEY UPDATE `$stat` = GREATEST(0, `$stat` {$op} ?)"";
    $pdo->prepare($sql)->execute([$userId, $val, $val]);
}

/**
 * Pr√ºft, ob ein Nutzer durch eine Aktion neue Erfolge freigeschaltet hat.
 */
function gamify_check(PDO $pdo, int $userId, string $event): array {
    $st = $pdo->prepare(""SELECT `key`, title, description, icon, points, threshold, rule_stat FROM achievements 
                         WHERE rule_event = ? AND is_active = 1"");
    $st->execute([$event]);
    $rules = $st->fetchAll(PDO::FETCH_ASSOC);
    if (!$rules) return [];

    $st = $pdo->prepare(""SELECT * FROM user_stats WHERE user_id = ?"");
    $st->execute([$userId]);
    $stats = $st->fetch(PDO::FETCH_ASSOC);
    if (!$stats) return [];

    $unlocked = [];
    foreach ($rules as $rule) {
        $statName = $rule['rule_stat'];
        if (isset($stats[$statName]) && $stats[$statName] >= $rule['threshold']) {
            $ins = $pdo->prepare(""INSERT IGNORE INTO user_achievements (user_id, achievement_id) 
                                 SELECT ?, id FROM achievements WHERE `key` = ?"");
            $ins->execute([$userId, $rule['key']]);
            if ($ins->rowCount() > 0) {
                $pdo->prepare(""UPDATE users SET xp = xp + ? WHERE id = ?"")->execute([$rule['points'], $userId]);
                $unlocked[] = $rule;
            }
        }
    }
    return $unlocked;
}

/**
 * Aktualisiert den w√∂chentlichen Quest-Fortschritt f√ºr einen Benutzer.
 */
function update_quest_progress(PDO $pdo, int $userId, string $eventType, int $xpPerQuest = 25): void
{
    error_log(""[Gamify] update_quest_progress called for user: $userId, event: $eventType"");

    $stmt = $pdo->prepare(
        ""SELECT id, title, threshold FROM quests WHERE is_active = 1 AND rule_event = ?""
    );
    $stmt->execute([$eventType]);
    $quests = $stmt->fetchAll(PDO::FETCH_ASSOC);

    if (!$quests) {
        error_log(""[Gamify] No active quests found for event: $eventType"");
        return;
    }

    error_log(""[Gamify] Found "" . count($quests) . "" quests for event: $eventType"");

    foreach ($quests as $quest) {
        $questId = (int)$quest['id'];
        $threshold = (int)$quest['threshold'];

        $sql = ""INSERT INTO user_quest_progress (user_id, quest_id, progress) VALUES (?, ?, 1)
                ON DUPLICATE KEY UPDATE progress = progress + 1"";
        $pdo->prepare($sql)->execute([$userId, $questId]);
        error_log(""[Gamify] Progress updated for user: $userId, quest: $questId"");

        $progressStmt = $pdo->prepare(
            ""SELECT progress FROM user_quest_progress WHERE user_id = ? AND quest_id = ? AND completed_at IS NULL""
        );
        $progressStmt->execute([$userId, $questId]);
        $currentProgress = (int)$progressStmt->fetchColumn();

        if ($threshold > 0 && $currentProgress >= $threshold) {
            error_log(""[Gamify] Quest COMPLETED for user: $userId, quest: $questId"");
            $pdo->prepare(""UPDATE user_quest_progress SET completed_at = NOW() WHERE user_id = ? AND quest_id = ?"")
                ->execute([$userId, $questId]);

            $pdo->prepare(""UPDATE users SET xp = xp + ? WHERE id = ?"")
                ->execute([$xpPerQuest, $userId]);
        }
    }
}

/**
 * Pr√ºft und aktualisiert die t√§gliche Login-Serie eines Nutzers.
 */
function process_daily_login(PDO $pdo, int $userId): void
{
    $st = $pdo->prepare(""SELECT last_login_at, login_streak FROM user_stats WHERE user_id = ?"");
    $st->execute([$userId]);
    $stats = $st->fetch(PDO::FETCH_ASSOC);

    if (!$stats) {
        // ##### KORREKTUR: Erstellt einen neuen Eintrag, falls keiner existiert #####
        $sql = ""INSERT INTO user_stats (user_id, last_login_at, login_streak) VALUES (?, NOW(), 1)
                ON DUPLICATE KEY UPDATE last_login_at = NOW(), login_streak = 1"";
        $pdo->prepare($sql)->execute([$userId]);
        check_stat_based_quests($pdo, $userId, 'login_streak');
        return;
    }

    $lastLogin = $stats['last_login_at'] ? new DateTime($stats['last_login_at']) : null;
    $today = new DateTime('today');
    $yesterday = new DateTime('yesterday');

    if ($lastLogin === null || $lastLogin"
lib/gamification.php,119,text,,gamification_yesterday_lastlogin_80be3477,"= $yesterday && $lastLogin"
lib/mailer.php,39,text,,mailer_verify_peer_true_verify_peer_name_true_a_9eb32675,"[
    'verify_peer' => true, 'verify_peer_name' => true, 'allow_self_signed' => false,
  ]]);
  $fp = @stream_socket_client($transport, $errno, $errstr, $timeout, STREAM_CLIENT_CONNECT, $context);
  if (!$fp) { $log(""CONNECT FAIL: $errstr ($errno)""); return false; }
  stream_set_timeout($fp, $timeout);

  $read = function() use ($fp, $log) {
    $resp = '';
    while (!feof($fp)) {
      $line = fgets($fp, 2048);
      if ($line === false) break;
      $resp .= $line;
      if (preg_match('/^\d{3}\s/', $line)) break; // letzte Zeile
      if (!preg_match('/^\d{3}-/', $line)) break; // nicht multi-line
    }
    $log('S: '.trim($resp));
    return $resp;
  };
  $write = function(string $cmd) use ($fp, $log) { $log('C: '.rtrim($cmd)); fwrite($fp, $cmd); };
  $expect = function(string $resp, array $ok=[220,250,235,334,354]) {
    return (bool)preg_match('/^('.implode('|',$ok).')\b/m', $resp);
  };

  $banner = $read(); if (!$expect($banner,[220])) { fclose($fp); return false; }
  $ehloHost = preg_replace('~[^a-z0-9\.-]~i','', $_SERVER['SERVER_NAME'] ?? 'hunthub.online');
  $write(""EHLO {$ehloHost}\r\n""); $resp = $read(); if (!$expect($resp,[250])) { fclose($fp); return false; }

  if ($secure === 'tls') {
    $write(""STARTTLS\r\n""); $resp = $read(); if (!$expect($resp,[220])) { fclose($fp); return false; }
    if (!@stream_socket_enable_crypto($fp, true, STREAM_CRYPTO_METHOD_TLS_CLIENT)) { $log('TLS handshake fail'); fclose($fp); return false; }
    $write(""EHLO {$ehloHost}\r\n""); $resp = $read(); if (!$expect($resp,[250])) { fclose($fp); return false; }
  }

  if ($user !== '' && $pass !== '') {
    $write(""AUTH LOGIN\r\n""); $resp = $read(); if (!$expect($resp,[334])) { fclose($fp); return false; }
    $write(base64_encode($user).""\r\n""); $resp = $read(); if (!$expect($resp,[334])) { fclose($fp); return false; }
    $write(base64_encode($pass).""\r\n""); $resp = $read(); if (!$expect($resp,[235])) { fclose($fp); return false; }
  }

  $write(""MAIL FROM:"
lib/mailer.php,79,text,,mailer_r_n_resp_read_if_expect_resp_250_fclose_bad0dfff,"\r\n""); $resp = $read(); if (!$expect($resp,[250])) { fclose($fp); return false; }
  $write(""RCPT TO:"
lib/mailer.php,80,text,,mailer_r_n_resp_read_if_expect_resp_250_251_fc_e832b93f,"\r\n""); $resp = $read(); if (!$expect($resp,[250,251])) { fclose($fp); return false; }
  $write(""DATA\r\n""); $resp = $read(); if (!$expect($resp,[354])) { fclose($fp); return false; }

  $crlf = ""\r\n"";
  $subjEnc = '=?UTF-8?B?'.base64_encode($subject).'?=';
  $fromHdr = $fromName ? sprintf('""%s"""
lib/mailer.php,85,text,,mailer_addslashes_fromname_from_from_tohdr_ton_bc78dbdb,"', addslashes($fromName), $from) : $from;
  $toHdr   = $toName ? sprintf('""%s"""
lib/moderation.php,9,text,,moderation_prepare_select_expires_at_reason_from_user_mutes_7a095bf3,"prepare(""
        SELECT expires_at, reason FROM user_mutes
        WHERE user_id = ? AND is_active = 1 AND (expires_at IS NULL OR expires_at > NOW())
        LIMIT 1
    "");
    $st->execute([$userId]);
    $mute = $st->fetch(PDO::FETCH_ASSOC);

    if ($mute === false) {
        return null;
    }
    
    return [
        'expires_at' => $mute['expires_at'],
        'reason' => $mute['reason']
    ];
}

/**
 * Erteilt einem Nutzer eine Verwarnung.
 * Muted den Nutzer automatisch bei 3 Verwarnungen f√ºr 7 Tage.
 * Gibt bei Erfolg true zur√ºck, bei Fehler false.
 */
function issue_warning(PDO $pdo, int $userId, int $moderatorId, string $reason): bool {
    // Regel: Mindestens 10 Zeichen f√ºr eine Begr√ºndung
    if (mb_strlen($reason)"
og/fallback.php,81,text,,fallback_34_lines_wrap_text_title_fontbold_size_max_9423e764,"34) {
    $lines = wrap_text($title, $fontBold, $size, $maxW);
    if (count($lines)"
api/notifications/list.php,19,text,,list_prepare_select_count_from_notifications_where_user_id_8d3faad0,"prepare(""SELECT COUNT(*) FROM notifications WHERE user_id = ? AND read_at IS NULL"");
$cnt->execute([(int)$me['id']]);
$unreadTotal = (int)$cnt->fetchColumn();

// Haupt-Query
$sql = ""
  SELECT
    n.id, n.type, n.thread_id, n.post_id, n.created_at, n.read_at,
    u.id   AS actor_id,
    u.display_name AS actor_name,
    u.avatar_path  AS actor_avatar,
    t.title AS thread_title,
    t.slug  AS thread_slug
  FROM notifications n
  JOIN users   u ON u.id = n.actor_id
  LEFT JOIN threads t ON t.id = n.thread_id
  WHERE n.user_id = :uid
"";
$params = [':uid' => (int)$me['id']];

if ($onlyUnread) {
  $sql .= "" AND n.read_at IS NULL"";
}
if ($beforeId > 0) {
  $sql .= "" AND n.id"
api/search/quick.php,14,text,,quick_quote_table_res_pdo_query_sql_return_res_ed7faa40,"quote($table);
  $res = $pdo->query($sql);
  return $res && $res->fetchColumn() !== false;
}
function colExists(PDO $pdo, string $table, string $col): bool {
  $sql = ""SHOW COLUMNS FROM `{$table}` LIKE "" . $pdo->quote($col);
  $res = $pdo->query($sql);
  return $res && $res->fetchColumn() !== false;
}

$diag = [];

try {
  // Bootstrap/DB
  $boot = __DIR__ . '/../../auth/bootstrap.php';
  if (is_file($boot)) { require_once $boot; $diag[]='bootstrap'; }
  else {
    $cfg = require __DIR__ . '/../../auth/config.php';
    require_once __DIR__ . '/../../auth/db.php';
    require_once __DIR__ . '/../../auth/guards.php';
    $diag[]='config+db+guards';
  }
  $pdo = function_exists('hh_db') ? hh_db() : db();
  $diag[] = function_exists('hh_db') ? 'hh_db()' : 'db()';

  // Inputs
  $q       = trim((string)($_GET['q'] ?? ''));
  $limitM  = max(1, min(10, (int)($_GET['limit_members'] ?? 6)));
  $limitT  = max(1, min(10, (int)($_GET['limit_threads'] ?? 6)));
  $len     = function_exists('mb_strlen') ? mb_strlen($q) : strlen($q);
  if ($q === '' || $len"
api/search/quick.php,44,text,,quick_true_items_members_threads_diag_diag_d99889fe,"true,'items'=>['members'=>[],'threads'=>[]],'diag'=>$diag]);

  // LIKE escapen
  $esc  = str_replace(['\\','%','_'], ['\\\\','\\%','\\_'], $q);
  $like = '%'.$esc.'%';

  $APP_BASE = isset($APP_BASE) ? (string)$APP_BASE : '';
  $ph = $APP_BASE . '/assets/images/avatars/placeholder.png';

  // ---- Members ----
  $sqlM = ""
    SELECT id, display_name, slug, avatar_path
    FROM users
    WHERE display_name LIKE :m1 ESCAPE '\\\\' OR slug LIKE :m2 ESCAPE '\\\\'
    ORDER BY display_name ASC
    LIMIT $limitM
  "";
  $stM = $pdo->prepare($sqlM);
  $stM->bindValue(':m1', $like, PDO::PARAM_STR);
  $stM->bindValue(':m2', $like, PDO::PARAM_STR);
  $stM->execute();
  $members = [];
  foreach ($stM->fetchAll(PDO::FETCH_ASSOC) ?: [] as $r) {
    $id = (int)($r['id'] ?? 0); if ($id"
api/search/quick.php,69,text,,quick_id_name_string_r_display_name_53cd2b3f,"$id,
      'name'=>(string)($r['display_name'] ?? ''),
      'avatar'=>(string)($r['avatar_path'] ?? '') ?: $ph,
      'url'=>$APP_BASE . '/user.php?id=' . $id,
      'type'=>'member'
    ];
  }

  // ---- Threads ----
  $threadTable = 'threads';
  if (!tableExists($pdo, $threadTable)) {
    foreach (['topics','forum_threads'] as $cand) { if (tableExists($pdo,$cand)) { $threadTable=$cand; break; } }
  }
  $titleCol = null;
  foreach (['title','subject','name'] as $cand) { if (colExists($pdo,$threadTable,$cand)) { $titleCol=$cand; break; } }
  if (!$titleCol) { out(200, ['ok'=>true,'items'=>['members'=>$members,'threads'=>[]],'diag'=>$diag]); }

  $orderCol = 'id';
  foreach (['updated_at','last_post_at','created_at'] as $cand) { if (colExists($pdo,$threadTable,$cand)) { $orderCol=$cand; break; } }

  $sqlT = ""
    SELECT id, `$titleCol` AS title
    FROM `$threadTable`
    WHERE `$titleCol` LIKE :t1 ESCAPE '\\\\'
    ORDER BY `$orderCol` DESC
    LIMIT $limitT
  "";
  $stT = $pdo->prepare($sqlT);
  $stT->bindValue(':t1', $like, PDO::PARAM_STR);
  $stT->execute();
  $threads = [];
  foreach ($stT->fetchAll(PDO::FETCH_ASSOC) ?: [] as $r) {
    $id = (int)($r['id'] ?? 0); if ($id"
api/search/users.php,35,text,,users_true_items_diag_diag_like_safe_fdab3d12,"true,'items'=>[],'diag'=>$diag]);
  }

  // LIKE-Safe
  $esc  = str_replace(['\\','%','_'], ['\\\\','\\%','\\_'], $q);
  $like = '%'.$esc.'%';

  // Wichtig: zwei Platzhalter + LIMIT inline (kein :lim!)
  $sql = ""
    SELECT id, display_name, slug, avatar_path
    FROM users
    WHERE display_name LIKE :q1 ESCAPE '\\\\'
       OR slug         LIKE :q2 ESCAPE '\\\\'
    ORDER BY display_name ASC
    LIMIT $limit
  "";
  $stmt = $pdo->prepare($sql);
  $stmt->bindValue(':q1', $like, PDO::PARAM_STR);
  $stmt->bindValue(':q2', $like, PDO::PARAM_STR);
  $stmt->execute();

  $rows = $stmt->fetchAll(PDO::FETCH_ASSOC) ?: [];

  // URLs
  $APP_BASE = isset($APP_BASE) ? (string)$APP_BASE : '';
  $ph = $APP_BASE . '/assets/images/avatars/placeholder.png';

  $items = [];
  foreach ($rows as $r) {
    $id = (int)($r['id'] ?? 0);
    if ($id"
api/lfg/request_update.php,8,text,,request_update_false_error_server_error_message_e_getmessage_ab085aa3,"false, 'error'=>'server_error', 'message'=>$e->getMessage()], JSON_UNESCAPED_UNICODE);
    exit;
});
set_error_handler(function($sev,$msg,$file,$line){
    throw new ErrorException($msg, 0, $sev, $file, $line);
});

require_once __DIR__ . '/../../auth/db.php';
$pdo = db();

/* Auth */
$me = null;
if (is_file(__DIR__ . '/../../auth/guards.php')) {
    require_once __DIR__ . '/../../auth/guards.php';
    if (function_exists('optional_auth')) $me = optional_auth();
}
if (session_status() !== PHP_SESSION_ACTIVE) { @session_start(); }
if (!$me && isset($_SESSION['user']['id'])) $me = ['id'=>(int)$_SESSION['user']['id']];
$user_id = (int)($me['id'] ?? 0);
if ($user_id"
api/lfg/request_update.php,27,text,,request_update_false_error_unauthorized_exit_tabellen_71a710ad,"false, 'error'=>'unauthorized']); exit; }

/* Tabellen? */
foreach (['lfg_requests'] as $tbl) {
    $st = $pdo->query(""SHOW TABLES LIKE "" . $pdo->quote($tbl));
    if (!$st || !$st->fetchColumn()) { echo json_encode(['ok'=>false, 'error'=>'missing_tables','missing'=>$tbl]); exit; }
}

/* Input */
$id = (int)($_POST['id'] ?? $_GET['id'] ?? 0);
$action = (string)($_POST['action'] ?? $_GET['action'] ?? '');
$allowed = ['accept','decline','block','cancel'];
if (!in_array($action, $allowed, true) || $id"
api/lfg/request_outbox.php,14,text,,request_outbox_false_error_server_error_message_e_getmessage_e8fd3936,"false, 'error'=>'server_error', 'message'=>$e->getMessage()], JSON_UNESCAPED_UNICODE);
    exit;
});
set_error_handler(function($sev,$msg,$file,$line){
    throw new ErrorException($msg, 0, $sev, $file, $line);
});

require_once __DIR__ . '/../../auth/db.php';
$pdo = db();

/* ---- Auth ohne Redirect ---- */
$me = null;
if (is_file(__DIR__ . '/../../auth/guards.php')) {
    require_once __DIR__ . '/../../auth/guards.php';
    if (function_exists('optional_auth')) {
        $me = optional_auth();
    } elseif (function_exists('current_user')) {
        $me = current_user();
    }
}
if (session_status() !== PHP_SESSION_ACTIVE) { @session_start(); }
if (!$me && isset($_SESSION['user']['id'])) {
    $me = ['id' => (int)$_SESSION['user']['id']];
}
$user_id = (int)($me['id'] ?? 0);
if ($user_id"
api/lfg/request_inbox.php,15,text,,request_inbox_false_error_server_error_message_e_getmessage_12b0bb54,"false, 'error'=>'server_error', 'message'=>$e->getMessage()], JSON_UNESCAPED_UNICODE);
    exit;
});
set_error_handler(function($sev,$msg,$file,$line){
    throw new ErrorException($msg, 0, $sev, $file, $line);
});

require_once __DIR__ . '/../../auth/db.php';
$pdo = db();

/* ---- Auth ohne Redirect ---- */
$me = null;
if (is_file(__DIR__ . '/../../auth/guards.php')) {
    require_once __DIR__ . '/../../auth/guards.php';
    if (function_exists('optional_auth')) {
        $me = optional_auth();
    } elseif (function_exists('current_user')) {
        $me = current_user();
    }
}
if (session_status() !== PHP_SESSION_ACTIVE) { @session_start(); }
if (!$me && isset($_SESSION['user']['id'])) {
    $me = ['id' => (int)$_SESSION['user']['id']];
}
$user_id = (int)($me['id'] ?? 0);
if ($user_id"
api/lfg/request_create.php,7,text,,request_create_ok_false_error_unauthorized_pruft_tabellen_val_f1c68d5f,"{ ok:false, error:""unauthorized"" }
 * - Pr√ºft Tabellen, validiert Input, vermeidet Duplikate
 * - Immer JSON (auch bei Fehlern)
 */

header('Content-Type: application/json; charset=utf-8');

set_exception_handler(function(Throwable $e){
    http_response_code(500);
    echo json_encode(['ok'=>false, 'error'=>'server_error', 'message'=>$e->getMessage()], JSON_UNESCAPED_UNICODE);
    exit;
});
set_error_handler(function($severity,$message,$file,$line){
    throw new ErrorException($message, 0, $severity, $file, $line);
});

require_once __DIR__ . '/../../auth/db.php';
$pdo = db();

/** ---- Auth ohne Redirect ---- */
$me = null;
if (is_file(__DIR__ . '/../../auth/guards.php')) {
    require_once __DIR__ . '/../../auth/guards.php';
    if (function_exists('optional_auth')) {
        $me = optional_auth();
    } elseif (function_exists('current_user')) {
        $me = current_user();
    }
}
if (session_status() !== PHP_SESSION_ACTIVE) { @session_start(); }
if (!$me && isset($_SESSION['user']['id'])) {
    $me = ['id' => (int)$_SESSION['user']['id']];
}
$user_id = (int)($me['id'] ?? 0);
if ($user_id"
api/lfg/request_create.php,42,text,,request_create_false_error_unauthorized_json_unescaped_unicode_01301e68,"false, 'error'=>'unauthorized'], JSON_UNESCAPED_UNICODE);
    exit;
}

/** ---- Ping ---- */
if (isset($_GET['__ping'])) {
    echo json_encode(['ok'=>true, 'pong'=>true, 'route'=>'/api/lfg/request_create.php']);
    exit;
}

/** ---- Tabellen da? ---- */
foreach (['lfg_posts','lfg_requests','users'] as $tbl) {
    $st = $pdo->query(""SHOW TABLES LIKE "" . $pdo->quote($tbl));
    if (!$st || !$st->fetchColumn()) {
        echo json_encode(['ok'=>false, 'error'=>'missing_tables', 'missing'=>$tbl], JSON_UNESCAPED_UNICODE);
        exit;
    }
}

/** ---- Input ---- */
$post_id = (int)($_POST['post_id'] ?? $_GET['post_id'] ?? 0);
$message = (string)($_POST['message'] ?? $_GET['message'] ?? '');
$message = trim($message);
if (mb_strlen($message) > 1000) { $message = mb_substr($message, 0, 1000); }

if ($post_id"
api/lfg/create.php,17,text,,create_false_error_server_error_message_e_getmessage_16900bb1,"false, 'error'=>'server_error', 'message'=>$e->getMessage()], JSON_UNESCAPED_UNICODE);
  exit;
});
set_error_handler(function($severity,$message,$file,$line){
  throw new ErrorException($message, 0, $severity, $file, $line);
});

require_once __DIR__ . '/../../auth/db.php';
$pdo = db();
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

// ---- Auth ohne Redirect ----
$me = null;
if (is_file(__DIR__ . '/../../auth/guards.php')) {
  require_once __DIR__ . '/../../auth/guards.php';
  if (function_exists('optional_auth')) {
    $me = optional_auth();
  } elseif (function_exists('current_user')) {
    $me = current_user();
  }
}
if (session_status() !== PHP_SESSION_ACTIVE) { @session_start(); }
if (!$me && isset($_SESSION['user']['id'])) { $me = ['id'=>(int)$_SESSION['user']['id']]; }
$user_id = (int)($me['id'] ?? 0);
if ($user_id"
api/lfg/list.php,16,text,,list_false_error_server_error_message_e_getmessage_23aa5b1e,"false, 'error'=>'server_error', 'message'=>$e->getMessage()], JSON_UNESCAPED_UNICODE);
    exit;
});
set_error_handler(function($severity, $message, $file, $line){
    throw new ErrorException($message, 0, $severity, $file, $line);
});

require_once __DIR__ . '/../../auth/db.php';

$pdo = db(); // PDO

// --- Quick diag
if (isset($_GET['__ping'])) {
    echo json_encode(['ok'=>true, 'pong'=>true, 'route'=>'/api/lfg/list.php']);
    exit;
}

// --- Hilfsfunktionen (lokal, ohne _util.php)
function jint($v, ?int $min=null, ?int $max=null): ?int {
    if ($v === null || $v === '') return null;
    if (!is_numeric($v)) return null;
    $i = (int)$v;
    if ($min !== null && $i"
api/lfg/list.php,39,text,,list_max_i_max_return_i_function_jnum_v_floa_86a83c7c,"$max) $i = $max;
    return $i;
}
function jnum($v, ?float $min=null, ?float $max=null): ?float {
    if ($v === null || $v === '') return null;
    if (!is_numeric($v)) return null;
    $f = (float)$v;
    if ($min !== null && $f"
api/lfg/list.php,47,text,,list_max_f_max_return_f_function_jin_string_v_51253dd6,"$max) $f = $max;
    return $f;
}
function jin(string $v=null, array $allowed=[], string $default=''): string {
    if ($v === null || $v === '') return $default;
    return in_array($v, $allowed, true) ? $v : $default;
}

// --- Pr√ºfe Tabellen-Existenz, um HTML-SQL-Fehler zu vermeiden
$need = ['lfg_posts','lfg_requests'];
foreach ($need as $tbl) {
    $st = $pdo->query(""SHOW TABLES LIKE "" . $pdo->quote($tbl));
    if (!$st || !$st->fetchColumn()) {
        echo json_encode(['ok'=>false, 'error'=>'missing_tables', 'missing'=>$tbl]);
        exit;
    }
}

// --- Filter einlesen
$q          = trim((string)($_GET['q'] ?? ''));
$platform   = $_GET['platform']  ?? null;
$region     = $_GET['region']    ?? null;
$mode       = $_GET['mode']      ?? null;
$playstyle  = $_GET['playstyle'] ?? null;
$headset    = $_GET['headset']   ?? null;
$looking    = $_GET['looking_for'] ?? null;
$lang       = $_GET['lang']      ?? null;
$min_mmr    = jint($_GET['min_mmr'] ?? null, 0);
$max_mmr    = jint($_GET['max_mmr'] ?? null, 0);
$min_kd     = jnum($_GET['min_kd']  ?? null, 0.0);
$max_kd     = jnum($_GET['max_kd']  ?? null, 0.0);
$page       = max(1, (int)($_GET['page'] ?? 1));
$per_page   = min(50, max(5, (int)($_GET['per_page'] ?? 20)));
$offset     = ($page - 1) * $per_page;

// Erlaubte Sets
$platform = jin($platform,  ['pc','xbox','ps'], '');
$region   = jin($region,    ['eu','na','sa','asia','oce'], '');
$mode     = jin($mode,      ['bounty','clash','both'], '');
$playstyle= jin($playstyle, ['offensive','defensive','balanced'], '');
$looking  = jin($looking,   ['solo','duo','trio','any'], '');

$where  = [""p.visible=1"", ""(p.expires_at IS NULL OR p.expires_at > NOW())""];
$params = [];

if ($q !== '')         { $where[] = ""(p.notes LIKE :q OR p.primary_weapon LIKE :q)""; $params[':q'] = '%'.$q.'%'; }
if ($platform !== '')   { $where[] = ""p.platform = :platform"";  $params[':platform'] = $platform; }
if ($region   !== '')   { $where[] = ""p.region   = :region"";    $params[':region']   = $region; }
if ($mode     !== '')   { $where[] = ""p.mode     = :mode"";      $params[':mode']     = $mode; }
if ($playstyle!== '')   { $where[] = ""p.playstyle= :playstyle""; $params[':playstyle']= $playstyle; }
if ($headset !== null && $headset !== '') { $where[] = ""p.headset = :headset""; $params[':headset'] = ($headset==='1'||$headset===1||$headset==='true')?1:0; }
if ($looking  !== '')   { $where[] = ""p.looking_for = :looking""; $params[':looking'] = $looking; }
if ($lang && $lang!==''){ $where[] = ""FIND_IN_SET(:lng, COALESCE(p.languages,'')) > 0""; $params[':lng'] = trim((string)$lang); }
if ($min_mmr !== null)  { $where[] = ""p.mmr >= :min_mmr""; $params[':min_mmr'] = $min_mmr; }
if ($max_mmr && $max_mmr>0) { $where[] = ""p.mmr"
api/lfg/list.php,102,text,,list_min_kd_params_min_kd_min_kd_if_max_kd_7d01ffe2,"= :min_kd"";   $params[':min_kd']  = $min_kd; }
if ($max_kd && $max_kd>0) { $where[] = ""p.kd"
api/lfg/_util.php,17,text,,_util_false_error_server_error_message_e_getmessage_c0793286,"false, 'error'=>'server_error', 'message'=>$e->getMessage()], 500);
});
set_error_handler(function($severity,$message,$file,$line){
    // Wandelt PHP-Warnings/Notices in Exceptions -> oben gefangen
    throw new ErrorException($message, 0, $severity, $file, $line);
});
function lfg_json($data, int $code = 200): never {
    http_response_code($code);
    echo json_encode($data, JSON_UNESCAPED_UNICODE);
    exit;
}

function lfg_require_auth(): array {
    $me = require_auth(); // liefert user-array oder beendet mit 401
    if (empty($me['id'])) lfg_json(['ok'=>false,'error'=>'unauthorized'], 401);
    return $me;
}

function lfg_int($v, ?int $min=null, ?int $max=null): ?int {
    if ($v === null || $v === '') return null;
    if (!is_numeric($v)) return null;
    $i = (int)$v;
    if ($min !== null && $i"
api/lfg/_util.php,40,text,,_util_max_return_max_return_i_function_lfg_num_v_0a42e5dd,"$max) return $max;
    return $i;
}

function lfg_num($v, ?float $min=null, ?float $max=null): ?float {
    if ($v === null || $v === '') return null;
    if (!is_numeric($v)) return null;
    $f = (float)$v;
    if ($min !== null && $f"
api/lfg/details.php,12,text,,details_false_error_server_error_message_e_getmessage_d8db960f,"false, 'error'=>'server_error', 'message'=>$e->getMessage()], JSON_UNESCAPED_UNICODE);
    exit;
});
set_error_handler(function($severity,$message,$file,$line){
    throw new ErrorException($message, 0, $severity, $file, $line);
});

require_once __DIR__ . '/../../auth/db.php';
$pdo = db();

// Ping
if (isset($_GET['__ping'])) {
    echo json_encode(['ok'=>true, 'pong'=>true, 'route'=>'/api/lfg/details.php']);
    exit;
}

$id = (int)($_GET['id'] ?? 0);
if ($id"
api/admin/notifications/broadcast.php,13,text,,broadcast_false_error_missing_title_or_body_exit_if_in_ar_a2ca51d0,"false,'error'=>'missing_title_or_body']); exit;
}
if (!in_array($level, ['info','warn','critical'], true)) $level = 'info';

// Tabelle f√ºr Broadcasts anlegen (id, title, body, link, level, created_by, is_active)
$pdo->exec(""
  CREATE TABLE IF NOT EXISTS site_broadcasts (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(160) NOT NULL,
    body TEXT NOT NULL,
    link VARCHAR(255) NULL,
    level ENUM('info','warn','critical') NOT NULL DEFAULT 'info',
    created_by BIGINT UNSIGNED NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    is_active TINYINT(1) NOT NULL DEFAULT 1
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
"");

$st = $pdo->prepare(""INSERT INTO site_broadcasts (title,body,link,level,created_by) VALUES (:t,:b,:l,:lv,:uid)"");
$st->execute([':t'=>$title, ':b'=>$body, ':l'=>($link?:null), ':lv'=>$level, ':uid'=>$me['id']]);
$bid = (int)$pdo->lastInsertId();

$fanCount = 0;
if ($fan) {
  // notifications.type um 'broadcast' erweitern, falls nicht vorhanden
  $col = $pdo->query(""
    SELECT COLUMN_TYPE FROM INFORMATION_SCHEMA.COLUMNS
    WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME='notifications' AND COLUMN_NAME='type'
  "")->fetchColumn();

  if ($col && str_starts_with($col, ""enum("") && strpos($col, ""'broadcast'"") === false) {
    // enum-Liste extrahieren + 'broadcast' anh√§ngen
    $enumVals = trim(substr($col, 5, -1)); // ohne enum(...)
    $new = $enumVals . "",'broadcast'"";
    $pdo->exec(""ALTER TABLE notifications MODIFY COLUMN type ENUM($new) NOT NULL"");
  }

  // Fan-Out: Eintrag pro User (actor = Admin), thread_id/post_id = NULL
  $ins = $pdo->prepare(""
    INSERT INTO notifications (user_id, actor_id, type, thread_id, post_id, created_at)
    SELECT id, :actor, 'broadcast', NULL, NULL, NOW()
    FROM users WHERE id"
api/admin/users/get.php,29,text,,get_getnumberofparameters_if_argc_3_rf_invok_796ff777,"getNumberOfParameters();
      if ($argc >= 3) { $rf->invoke($pdo, $sessionCookie, $token); return; }
      if ($argc === 2){ $rf->invoke($pdo, $token);                 return; }
      if ($argc === 1){ $rf->invoke($token);                       return; }
                       $rf->invoke();                               return;
    } catch (Throwable $e) {}
  };
  foreach (['verify_csrf','csrf_verify','check_csrf','assert_csrf','require_csrf'] as $cand) {
    if (function_exists($cand)) { $invoke($cand); return; }
  }
}
hh_verify_csrf();

$pdo = db();

/* Spalten-Erkennung */
$cols = [];
foreach ($pdo->query(""SHOW COLUMNS FROM users"", PDO::FETCH_ASSOC) as $c) $cols[$c['Field']] = true;
$hasTw  = isset($cols['is_twitch_streamer']);
$hasUrl = isset($cols['twitch_url']);

$twCol  = $hasTw  ? 'is_twitch_streamer' : '0 AS is_twitch_streamer';
$urlCol = $hasUrl ? 'twitch_url'        : 'NULL AS twitch_url';

$id = (int)($HH_JSON['id'] ?? 0);
if ($id"
api/admin/users/save.php,29,text,,save_getnumberofparameters_if_argc_3_rf_invok_9d238cdb,"getNumberOfParameters();
      if ($argc >= 3) { $rf->invoke($pdo, $sessionCookie, $token); return; }
      if ($argc === 2){ $rf->invoke($pdo, $token);                 return; }
      if ($argc === 1){ $rf->invoke($token);                       return; }
                       $rf->invoke();                               return;
    } catch (Throwable $e) {}
  };
  foreach (['verify_csrf','csrf_verify','check_csrf','assert_csrf','require_csrf'] as $cand) {
    if (function_exists($cand)) { $invoke($cand); return; }
  }
}
hh_verify_csrf();

$pdo = db();

/* Spalten-Erkennung (Migration optional) */
$cols = [];
foreach ($pdo->query(""SHOW COLUMNS FROM users"", PDO::FETCH_ASSOC) as $c) $cols[$c['Field']] = true;
$hasTw  = isset($cols['is_twitch_streamer']);
$hasUrl = isset($cols['twitch_url']);

$id = (int)($HH_JSON['id'] ?? 0);
if ($id"
api/admin/tournaments/run_set_status.php,5,text,,run_set_status_false_error_exception_detail_e_getmessage_5dafeaa9,"false,'error'=>'exception','detail'=>$e->getMessage()]); });


require_once __DIR__ . '/../../../auth/db.php';
require_once __DIR__ . '/../../../auth/guards.php';
require_once __DIR__ . '/../../../auth/csrf.php';


$pdo = db(); $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); require_admin();
$in = json_decode(file_get_contents('php://input') ?: '[]', true) ?: [];
$token = $in['csrf'] ?? ($_SERVER['HTTP_X_CSRF'] ?? '');
if (function_exists('verify_csrf') && !verify_csrf($pdo,(string)$token)) { http_response_code(403); echo json_encode(['ok'=>false,'error'=>'bad_csrf']); exit; }


$id = (int)($in['id'] ?? 0);
$want = (string)($in['status'] ?? 'approved'); // approved|rejected|pending|flagged
$reason = trim((string)($in['reason'] ?? ''));
if ($id"
api/admin/mute/admin_moderation.php,69,text,,admin_moderation_moderation_verwarnungen_mutes_f1c63c3b,"Moderation ‚Äì Verwarnungen & Mutes"
api/admin/mute/admin_moderation.php,75,text,,admin_moderation_moderation_verwarnungen_mutes_f1c63c3b,"Moderation ‚Äì Verwarnungen & Mutes"
api/admin/mute/admin_moderation.php,78,text,,admin_moderation_placeholder_nutzer_per_name_oder_e_mail_suchen_class_px_47cadb88,""" placeholder=""Nutzer per Name oder E-Mail suchen"" class=""px-3 py-2 rounded border w-[360px] text-black"">"
api/admin/mute/admin_moderation.php,79,text,,admin_moderation_suchen_795c4c91,Suchen
api/admin/mute/admin_moderation.php,84,text,,admin_moderation_treffer_8f6dda35,Treffer
api/admin/mute/admin_moderation.php,87,text,,admin_moderation_keine_nutzer_gefunden_33e9cfcb,"Keine Nutzer gefunden."
api/admin/mute/admin_moderation.php,92,text,,admin_moderation_rolle_8f9ca279,Rolle:
api/admin/mute/admin_moderation.php,94,text,,admin_moderation_class_px_3_py_1_rounded_bg_gray_700_text_white_moderiere_5defb1cc,""" class=""px-3 py-1 rounded bg-gray-700 text-white"">Moderieren"
api/admin/mute/admin_moderation.php,103,text,,admin_moderation_zielnutzer_b2a74103,Zielnutzer
api/admin/mute/admin_moderation.php,106,text,,admin_moderation_rolle_8f9ca279,Rolle:
api/admin/mute/admin_moderation.php,108,text,,admin_moderation_offene_verwarnungen_140b357d,"Offene Verwarnungen:"
api/admin/mute/admin_moderation.php,109,text,,admin_moderation_mute_fb8ecb21,Mute:
api/admin/mute/admin_moderation.php,116,text,,admin_moderation_verwarnung_vergeben_bbf0d36a,"Verwarnung vergeben"
api/admin/mute/admin_moderation.php,119,text,,admin_moderation_grund_optional_89a191ff,"Grund (optional)"
api/admin/mute/admin_moderation.php,121,text,,admin_moderation_auto_mute_dauer_minuten_optional_d781a7c9,"Auto-Mute Dauer (Minuten, optional)"
api/admin/mute/admin_moderation.php,123,text,,admin_moderation_verwarnung_speichern_fc36023a,"Verwarnung speichern"
api/admin/mute/admin_moderation.php,127,text,,admin_moderation_manuell_muten_4fe4fd24,"Manuell muten"
api/admin/mute/admin_moderation.php,130,text,,admin_moderation_dauer_in_minuten_e57a1738,"Dauer in Minuten"
api/admin/mute/admin_moderation.php,132,text,,admin_moderation_grund_optional_89a191ff,"Grund (optional)"
api/admin/mute/admin_moderation.php,135,text,,admin_moderation_mute_setzen_04ad3907,"Mute setzen"
api/admin/mute/admin_moderation.php,136,text,,admin_moderation_aktiven_mute_aufheben_4a21503b,"Aktiven Mute aufheben"
api/admin/mute/admin_moderation.php,144,text,,admin_moderation_verwarnungen_letzte_100_c9a096a4,"Verwarnungen (letzte 100)"
api/admin/mute/admin_moderation.php,146,text,,admin_moderation_keine_eintrage_62e87e6f,"Keine Eintr√§ge"
api/admin/mute/admin_moderation.php,149,text,,admin_moderation_am_6e1d3e40,am
api/admin/mute/admin_moderation.php,149,text,,admin_moderation_von_3603c599,von
api/admin/mute/admin_moderation.php,156,text,,admin_moderation_mutes_letzte_100_8c138ee4,"Mutes (letzte 100)"
api/admin/mute/admin_moderation.php,158,text,,admin_moderation_keine_eintrage_62e87e6f,"Keine Eintr√§ge"
api/admin/mute/admin_moderation.php,161,text,,admin_moderation_am_6e1d3e40,am
api/admin/mute/admin_moderation.php,161,text,,admin_moderation_von_3603c599,von
api/admin/mute/admin_moderation.php,162,text,,admin_moderation_bis_8fd1f021,bis
api/admin/mute/admin_moderation.php,166,text,,admin_moderation_mute_aufheben_8c2b9268,"Mute aufheben"
api/admin/mute/admin_moderation.php,175,text,,admin_moderation_i18n_mask_script_0_6d589c56,%%I18N_MASK_SCRIPT_0%%
api/admin/mute/admin_moderation.php,78,attr,placeholder,admin_moderation_placeholder_nutzer_per_name_oder_e_mail_suchen_0b3bbb1b,"Nutzer per Name oder E-Mail suchen"
api/admin/mute/admin_moderation.php,120,attr,placeholder,admin_moderation_placeholder_z_b_beleidigungen_im_forum_b2f926d0,"z. B. Beleidigungen im Forum"
api/admin/mute/admin_moderation.php,122,attr,placeholder,admin_moderation_placeholder_standard_defined_hh_auto_mute_minutes_default_hh_bebe5925,"(Standard: <?= defined('HH_AUTO_MUTE_MINUTES_DEFAULT') ? HH_AUTO_MUTE_MINUTES_DEFAULT : 1440 ?>)"
api/admin/mute/admin_moderation.php,133,attr,placeholder,admin_moderation_placeholder_z_b_spam_29534110,"z. B. Spam"
api/admin/mute/admin_moderation.php,78,attr,value,admin_moderation_value_htmlspecialchars_q_5f56a89c,"<?= htmlspecialchars($q) ?>"
api/admin/mute/admin_moderation.php,118,attr,value,admin_moderation_value_int_target_id_3e0b1fd4,"<?= (int)$target['id'] ?>"
api/admin/mute/admin_moderation.php,129,attr,value,admin_moderation_value_int_target_id_3e0b1fd4,"<?= (int)$target['id'] ?>"
api/admin/mute/admin_moderation.php,131,attr,value,admin_moderation_value_60_98fc27e0,60
api/admin/mute/admin_moderation.php,165,attr,value,admin_moderation_value_int_m_id_fdcaf78d,"<?= (int)$m['id'] ?>"
api/admin/uploads/list.php,10,text,,list_root_realpath_dir_if_a0ebe031,"../../../
  $root = realpath(__DIR__ . '/../../../');
  if ($root === false) { throw new RuntimeException('root_resolve_failed'); }

  // ----- Verzeichnisse bestimmen -----
  $dirs = [];
  if ($kind === 'images') {
    // NUR diese sechs Ordner durchsuchen (sowohl unter /uploads als auch /public/uploads)
    $sub = ['avatars','covers','forum','messages','posts','video_posters'];
    foreach ([$root . '/uploads', $root . '/public/uploads'] as $base) {
      foreach ($sub as $s) {
        $p = rtrim($base, '/') . '/' . $s;
        if (is_dir($p)) $dirs[] = $p;
      }
    }
  } else { // videos
    foreach ([$root . '/uploads/videos', $root . '/public/uploads/videos'] as $p) {
      if (is_dir($p)) $dirs[] = $p;
    }
  }

  if (!$dirs) {
    http_response_code(404);
    echo json_encode([
      'ok' => false,
      'error' => 'uploads_dir_missing',
      'required_dirs' => $kind === 'images'
        ? array_map(fn($s)=>""/uploads/$s & /public/uploads/$s"", ['avatars','covers','forum','messages','posts','video_posters'])
        : ['/uploads/videos', '/public/uploads/videos'],
      'checked_root' => $root,
    ], JSON_UNESCAPED_SLASHES|JSON_UNESCAPED_UNICODE);
    exit;
  }

  // ----- Dateifilter -----
  $extImg = ['jpg','jpeg','png','webp','gif','svg'];
  $extVid = ['mp4','mov','webm','mkv'];

  // ----- Scan -----
  $items = [];
  foreach ($dirs as $base) {
    $rii = new RecursiveIteratorIterator(
      new RecursiveDirectoryIterator($base, FilesystemIterator::SKIP_DOTS)
    );
    foreach ($rii as $f) {
      /** @var SplFileInfo $f */
      if (!$f->isFile()) continue;
      $ext = strtolower(pathinfo($f->getFilename(), PATHINFO_EXTENSION));
      if ($kind === 'images' && !in_array($ext, $extImg, true)) continue;
      if ($kind === 'videos' && !in_array($ext, $extVid, true)) continue;

      $abs = $f->getPathname();
      $rel = substr($abs, strlen($root)); if ($rel === false || $rel === '') $rel = $abs;

      $mime = $kind === 'images'
        ? ($ext==='svg' ? 'image/svg+xml' :
           (($ext==='jpg'||$ext==='jpeg') ? 'image/jpeg' :
           ($ext==='png' ? 'image/png' :
           ($ext==='webp' ? 'image/webp' :
           ($ext==='gif' ? 'image/gif' : 'image/*')))))
        : ($ext==='mp4' ? 'video/mp4' :
           ($ext==='webm' ? 'video/webm' :
           ($ext==='mov' ? 'video/quicktime' :
           ($ext==='mkv' ? 'video/x-matroska' : 'video/*'))));

      $items[] = [
        'kind' => $kind,
        'path' => $abs,
        'rel'  => $rel,
        'size' => $f->getSize(),
        'mime' => $mime,
      ];
    }
  }

  usort($items, fn($a,$b) => $b['size']"
api/admin/forum/thread_update.php,14,text,,thread_update_false_error_bad_id_exit_fields_params_c39cb428,"false,'error'=>'bad_id']); exit; }

$fields = [];
$params = [':id' => $id];

// Welche Spalten existieren?
$cols = $pdo->prepare(""
  SELECT COLUMN_NAME FROM INFORMATION_SCHEMA.COLUMNS
  WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'threads'
"");
$cols->execute();
$have = array_column($cols->fetchAll(PDO::FETCH_ASSOC), 'COLUMN_NAME');
$have = array_flip($have); // faster isset

// Titel
if (array_key_exists('title', $in)) {
  $title = trim((string)$in['title']);
  if ($title === '') { http_response_code(400); echo json_encode(['ok'=>false,'error'=>'title_empty']); exit; }
  $fields[] = ""title = :title"";
  $params[':title'] = $title;
}

// Slug
if (array_key_exists('slug', $in) && isset($have['slug'])) {
  $slug = trim((string)$in['slug']);
  if ($slug !== '') {
    // basic cleanup
    $slug = strtolower(preg_replace('~[^a-z0-9\-]+~', '-', $slug));
    $slug = trim($slug, '-');
    if ($slug === '') { http_response_code(400); echo json_encode(['ok'=>false,'error'=>'slug_empty']); exit; }

    // Eindeutigkeit (global). Wenn du Board-spezifisch willst, erg√§nze board_id in WHERE.
    $chk = $pdo->prepare(""SELECT id FROM threads WHERE slug = :s AND id"
api/admin/resolve_report.php,16,text,,resolve_report_false_error_missing_csrf_exit_id_int_7f09d7d1,"false,'error'=>'missing_csrf']); exit; }


$id = (int)($_POST['id'] ?? 0);
if ($id"
api/friends/send_request.php,10,text,,send_request_false_error_method_not_allowed_exit_pdo_db_c51a2f0a,"false,'error'=>'method_not_allowed']); exit;
}

$pdo  = db();
$user = require_auth();
// NEU
$cfg = require __DIR__ . '/../../auth/config.php';
$sessionName = $cfg['cookies']['session_name'] ?? '';
if (!check_csrf($pdo, $_COOKIE[$sessionName] ?? '', (string)($_POST['csrf'] ?? ''))) {
  http_response_code(400);
  echo json_encode(['ok'=>false,'error'=>'csrf']);
  exit;
}


$targetId = (int)($_POST['user_id'] ?? 0);
if ($targetId"
api/friends/unfriend.php,11,text,,unfriend_false_error_method_not_allowed_exit_pdo_db_ca2abcf9,"false,'error'=>'method_not_allowed']); exit;
}

$pdo  = db();
$user = require_auth();

$cfg = require __DIR__ . '/../../auth/config.php';
$sessionName = $cfg['cookies']['session_name'] ?? '';
if (!check_csrf($pdo, $_COOKIE[$sessionName] ?? '', (string)($_POST['csrf'] ?? ''))) {
  http_response_code(400);
  echo json_encode(['ok'=>false,'error'=>'csrf']); exit;
}

$otherId = (int)($_POST['user_id'] ?? 0);
$meId    = (int)$user['id'];
if ($otherId"
api/friends/unfriend.php,27,text,,unfriend_false_error_invalid_target_exit_pair_meid_db7bae7a,"false,'error'=>'invalid_target']); exit;
}

$pair = $meId"
api/friends/cancel_request.php,9,text,,cancel_request_false_error_method_not_allowed_exit_pdo_db_fae483c1,"false,'error'=>'method_not_allowed']); exit;
}

$pdo  = db();
$user = require_auth();
// NEU
$cfg = require __DIR__ . '/../../auth/config.php';
$sessionName = $cfg['cookies']['session_name'] ?? '';
if (!check_csrf($pdo, $_COOKIE[$sessionName] ?? '', (string)($_POST['csrf'] ?? ''))) {
  http_response_code(400);
  echo json_encode(['ok'=>false,'error'=>'csrf']);
  exit;
}


$otherId = (int)($_POST['user_id'] ?? 0);
if ($otherId"
api/friends/respond_request.php,9,text,,respond_request_false_error_method_not_allowed_exit_pdo_db_8074b923,"false,'error'=>'method_not_allowed']); exit;
}

$pdo  = db();
$user = require_auth();
// NEU
$cfg = require __DIR__ . '/../../auth/config.php';
$sessionName = $cfg['cookies']['session_name'] ?? '';
if (!check_csrf($pdo, $_COOKIE[$sessionName] ?? '', (string)($_POST['csrf'] ?? ''))) {
  http_response_code(400);
  echo json_encode(['ok'=>false,'error'=>'csrf']);
  exit;
}


$requestId = (int)($_POST['request_id'] ?? 0);
$action    = (string)($_POST['action'] ?? '');
if ($requestId"
api/tournaments/reject_run.php,19,text,,reject_run_setattribute_pdo_attr_errmode_pdo_errmode_exception_7c923319,"setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $me  = require_admin();

    // Input
    $runId  = (int)($_POST['run_id'] ?? $_POST['id'] ?? $_GET['run_id'] ?? $_GET['id'] ?? 0);
    $reason = trim((string)($_REQUEST['reason'] ?? ''));

    // CSRF (POST/GET/Header/Cookie) + Admin-Fallback auf gleicher Origin
    $token = $_REQUEST['csrf'] ?? ($_SERVER['HTTP_X_CSRF'] ?? '');
    if (!$token && isset($_COOKIE['csrf'])) $token = (string)$_COOKIE['csrf'];
    $ref = $_SERVER['HTTP_REFERER'] ?? ''; $host = $_SERVER['HTTP_HOST'] ?? '';
    $sameOrigin = $ref && (parse_url($ref, PHP_URL_HOST) === $host);
    $csrfOk = function_exists('verify_csrf') && verify_csrf($pdo, (string)$token);
    if (!$csrfOk && $sameOrigin && !empty($me) && !empty($me['is_admin'])) $csrfOk = true;
    if (!$csrfOk) { http_response_code(403); echo json_encode(['ok'=>false,'error'=>'bad_csrf']); exit; }
    if ($runId"
api/tournaments/team_join.php,11,text,,team_join_setattribute_pdo_attr_errmode_pdo_errmode_exception_if_590aa20e,"setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
if (function_exists('require_user')) { $me = require_user(); }
elseif (function_exists('require_login')) { $me = require_login(); }
elseif (function_exists('require_auth')) { $me = require_auth(); }
else { $me = require_admin(); }
$uid = (int)($me['id'] ?? 0);


$token = $_POST['csrf'] ?? $_SERVER['HTTP_X_CSRF'] ?? '';
if (function_exists('verify_csrf') && !verify_csrf($pdo,(string)$token)) { http_response_code(403); echo json_encode(['ok'=>false,'error'=>'bad_csrf']); exit; }


$tid = (int)($_POST['tournament_id'] ?? 0);
$code = strtoupper(trim((string)($_POST['join_code'] ?? '')));
if ($tid"
api/tournaments/run_upload.php,13,text,,run_upload_getmessage_basename_e_getfile_e_getline_7cae0599,"getMessage().' @ '.basename($e->getFile()).':'.$e->getLine());
  echo json_encode(['ok'=>false,'error'=>'exception','detail'=>$e->getMessage(),'where'=>basename($e->getFile()).':'.$e->getLine()], JSON_UNESCAPED_UNICODE|JSON_UNESCAPED_SLASHES);
});

require_once __DIR__ . '/../../auth/db.php';
require_once __DIR__ . '/../../auth/guards.php';
require_once __DIR__ . '/../../auth/csrf.php';
$cfg = require __DIR__ . '/../../auth/config.php';

$pdo = db();
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

// ---- User ----
if (function_exists('require_user'))      { $me = require_user(); }
elseif (function_exists('require_login')) { $me = require_login(); }
elseif (function_exists('require_auth'))  { $me = require_auth(); }
else                                      { $me = require_admin(); }
$uid = (int)($me['id'] ?? 0);

// ---- CSRF ----
$token = $_POST['csrf'] ?? $_SERVER['HTTP_X_CSRF'] ?? '';
if (function_exists('verify_csrf') && !verify_csrf($pdo,(string)$token)) {
  http_response_code(403);
  echo json_encode(['ok'=>false,'error'=>'bad_csrf']); return;
}

$tid = (int)($_POST['tournament_id'] ?? 0);
if ($tid"
api/tournaments/run_upload.php,40,text,,run_upload_false_error_missing_tournament_id_return_09f14aeb,"false,'error'=>'missing_tournament_id']); return; }

// ---- Turnier & Zeitfenster ----
$tzId = $cfg['timezone'] ?? 'Europe/Berlin';
$tz   = new DateTimeZone($tzId);
$stT = $pdo->prepare('SELECT id, starts_at, ends_at, scoring_json, '.(columnExists($pdo,'tournaments','status')?'status':'\'\' AS status').' FROM tournaments WHERE id=?');
$stT->execute([$tid]);
$T = $stT->fetch(PDO::FETCH_ASSOC);
if (!$T) { echo json_encode(['ok'=>false,'error'=>'tournament_not_found']); return; }

$now  = new DateTimeImmutable('now', $tz);
$grace= 300; // 5min
$startOk = true; $endOk = true;
$ss = (string)($T['starts_at'] ?? '');
$se = (string)($T['ends_at'] ?? '');
if ($ss!==''){ $s=DateTimeImmutable::createFromFormat('Y-m-d H:i:s',$ss,$tz) ?: new DateTimeImmutable($ss,$tz); $startOk = ($now->getTimestamp() >= ($s->getTimestamp()-$grace)); }
if ($se!==''){ $e=DateTimeImmutable::createFromFormat('Y-m-d H:i:s',$se,$tz) ?: new DateTimeImmutable($se,$tz); $endOk   = ($now->getTimestamp()"
api/tournaments/run_upload.php,56,text,,run_upload_gettimestamp_grace_windowok_startok_endok_120ec0d6,"getTimestamp()+$grace)); }
$windowOk = ($startOk && $endOk) || in_array((string)$T['status'],['open','running'],true);
if (!$windowOk) {
  echo json_encode(['ok'=>false,'error'=>'outside_time_window','detail'=>['now'=>$now->format('Y-m-d H:i:s'),'starts_at'=>$ss,'ends_at'=>$se,'status'=>$T['status']]]); return;
}

// ---- Team des Users ----
$stTeam = $pdo->prepare('SELECT tt.id FROM tournament_teams tt JOIN tournament_team_members m ON m.tournament_team_id=tt.id WHERE tt.tournament_id=? AND m.user_id=? LIMIT 1');
$stTeam->execute([$tid, $uid]);
$teamId = (int)($stTeam->fetchColumn() ?: 0);
if (!$teamId) { echo json_encode(['ok'=>false,'error'=>'no_team']); return; }

// ---- Eingaben & Punkte ----
$kills    = max(0,(int)($_POST['kills']    ?? 0));
$bosses   = max(0,(int)($_POST['bosses']   ?? 0));
$tokens   = max(0,(int)($_POST['tokens']   ?? 0));
$gauntlet = max(0,(int)($_POST['gauntlet'] ?? 0));
$deaths   = max(0,(int)($_POST['deaths']   ?? 0));
$sc = ['kill'=>1,'boss'=>3,'token'=>5,'gauntlet'=>10,'death'=>-5];
if (!empty($T['scoring_json'])) { $tmp=json_decode((string)$T['scoring_json'],true); if(is_array($tmp)) $sc=array_merge($sc,$tmp); }
$points = ($kills*$sc['kill'])+($bosses*$sc['boss'])+($tokens*$sc['token'])+($gauntlet*$sc['gauntlet'])+($deaths*$sc['death']);

// ---- Datei pr√ºfen ----
if (empty($_FILES['shot']) || ($_FILES['shot']['error'] ?? UPLOAD_ERR_NO_FILE) !== UPLOAD_ERR_OK) { echo json_encode(['ok'=>false,'error'=>'missing_screenshot']); return; }
$f = $_FILES['shot'];

$finfo = new finfo(FILEINFO_MIME_TYPE);
$mime  = (string)($finfo->file($f['tmp_name']) ?: '');
$allow = ['image/jpeg'=>'.jpg','image/png'=>'.png','image/webp'=>'.webp'];
$ext   = $allow[$mime] ?? null;
if (!$ext) { echo json_encode(['ok'=>false,'error'=>'bad_filetype','detail'=>$mime]); return; }

$maxBytes = 20 * 1024 * 1024;
if (($f['size'] ?? 0)"
api/tournaments/run_upload.php,89,text,,run_upload_maxbytes_echo_json_encode_ok_false_error_bad_b09c21c5,"$maxBytes) {
  echo json_encode(['ok'=>false,'error'=>'bad_size']); return;
}

// ---- Zielpfad
$root   = dirname(__DIR__, 2);
$relDir = '/uploads/tournaments/'.$tid.'/runs/';
$absDir = $root.$relDir; if (!is_dir($absDir)) @mkdir($absDir, 0775, true);
$fn     = $teamId.'_'.date('Ymd_His').'_'.bin2hex(random_bytes(3)).$ext;
$abs    = $absDir.$fn; $rel = $relDir.$fn;

if (!move_uploaded_file($f['tmp_name'], $abs)) { echo json_encode(['ok'=>false,'error'=>'upload_failed']); return; }

// ---- META: Zeitstempel auslesen
[$metaDt, $metaSource] = extract_image_datetime_fast($abs, $mime);

// --- Fallback: wenn keine Metadaten gefunden -> filemtime() nutzen ---
if (!$metaDt) {
  $mt = @filemtime($abs);
  if ($mt) {
    $metaDt = (new DateTime('@'.$mt))->setTimezone(new DateTimeZone('UTC'));
    $metaSource = 'filemtime';
  }
}

// ---- Heuristik
$nowUtc = new DateTimeImmutable('now', new DateTimeZone('UTC'));
$maxAgeHours       = 24;
$maxFutureSkewMin  = 5;

$isSuspicious = 0; $reasons = [];
$startsAt = !empty($T['starts_at']) ? new DateTimeImmutable((string)$T['starts_at'], new DateTimeZone('UTC')) : null;
$endsAt   = !empty($T['ends_at'])   ? new DateTimeImmutable((string)$T['ends_at'],   new DateTimeZone('UTC')) : null;

if ($metaDt instanceof DateTimeInterface) {
  $diffH = (int) floor(($nowUtc->getTimestamp() - $metaDt->getTimestamp()) / 3600);
  if ($diffH > $maxAgeHours) { $isSuspicious = 1; $reasons[] = ""older_than_{$maxAgeHours}h""; }
  if ($metaDt->getTimestamp() - $nowUtc->getTimestamp() > ($maxFutureSkewMin * 60)) {
    $isSuspicious = 1; $reasons[] = 'future_time';
  }
  if ($startsAt && $metaDt"
api/tournaments/run_upload.php,130,text,,run_upload_endsat_issuspicious_1_reasons_after_tourname_34dc04cf,"$endsAt)   { $isSuspicious = 1; $reasons[] = 'after_tournament'; }
} else {
  $isSuspicious = 1; $reasons[] = 'no_metadata';
}

// ---- Spalten autodetektion ----
$cols=[]; foreach($pdo->query('SHOW COLUMNS FROM tournament_runs',PDO::FETCH_ASSOC) as $c){ $cols[$c['Field']]=$c; }

$colTournamentId = pickCol($cols, ['tournament_id','t_id']);
$colTeamId       = pickCol($cols, ['tournament_team_id','team_id']);
$pointsCol       = pickCol($cols, ['raw_points','points_total','points']);
$shotCol         = pickCol($cols, ['screenshot_rel','screenshot_path','screenshot','image_path']);
$uploaderCol     = pickCol($cols, ['uploader_user_id','uploader_id','user_id','created_by']);

$statusCol = isset($cols['status']) ? 'status' : null;
$statusVal = null;
if ($statusCol) {
  $type = strtolower((string)($cols['status']['Type'] ?? ''));
  $default = $cols['status']['Default'] ?? null;
  if (str_starts_with($type, 'enum(')) {
    preg_match_all(""/'([^']*)'/"", $type, $m);
    $allowed = $m[1] ?? [];
    if (in_array('pending', $allowed, true))      $statusVal = 'pending';
    elseif (in_array('new', $allowed, true))      $statusVal = 'new';
    elseif ($default !== null && $default !== '') $statusVal = (string)$default;
    elseif (!empty($allowed))                     $statusVal = (string)$allowed[0];
  } elseif (str_contains($type,'int')) {
    $statusVal = $default !== null && $default !== '' ? (int)$default : 0;
  } else {
    $statusVal = $default !== null ? (string)$default : 'pending';
  }
}

$killCol    = pickCol($cols, ['kills']);
$bossCol    = pickCol($cols, ['bosses','boss_kills']);
$tokenCol   = pickCol($cols, ['tokens','token']);
$gauntCol   = pickCol($cols, ['gauntlet']);
$deathCol   = pickCol($cols, ['deaths','deads']);

$exifDtCol   = pickCol($cols, ['exif_datetime']);
$exifSrcCol  = pickCol($cols, ['exif_source']);
$suspCol     = pickCol($cols, ['suspicious']);
$metaNoteCol = pickCol($cols, ['meta_note']);

if (!$colTournamentId || !$colTeamId) {
  echo json_encode(['ok'=>false,'error'=>'schema_unsupported','detail'=>['need'=>['tournament_id','tournament_team_id'],'have'=>array_keys($cols)]]); return;
}

$data = [ $colTournamentId=>$tid, $colTeamId=>$teamId ];
if ($killCol)  $data[$killCol]  = $kills;
if ($bossCol)  $data[$bossCol]  = $bosses;
if ($tokenCol) $data[$tokenCol] = $tokens;
if ($gauntCol) $data[$gauntCol] = $gauntlet;
if ($deathCol) $data[$deathCol] = $deaths;
if ($pointsCol)   $data[$pointsCol]   = $points;
if ($shotCol)     $data[$shotCol]     = $rel;
if ($statusCol && $statusVal !== null) $data[$statusCol] = $statusVal;
if ($uploaderCol) $data[$uploaderCol] = $uid;

if ($exifDtCol)   $data[$exifDtCol]   = $metaDt ? $metaDt->format('Y-m-d H:i:s') : null;
if ($exifSrcCol)  $data[$exifSrcCol]  = $metaSource ?: null;
if ($suspCol)     $data[$suspCol]     = (int)$isSuspicious;
if ($metaNoteCol) $data[$metaNoteCol] = $reasons ? implode(',', $reasons) : null;

$keys = array_keys($data);
$place= implode(',', array_fill(0, count($keys), '?'));
$sql  = 'INSERT INTO tournament_runs ('.implode(',', $keys).') VALUES ('.$place.')';
$stI  = $pdo->prepare($sql);
$stI->execute(array_values($data));
$id   = (int)$pdo->lastInsertId();

echo json_encode([
  'ok'=>true,
  'id'=>$id,
  'points'=>$points,
  'file'=>$rel,
  'status_set'=>$statusVal,
  'suspicious'=>(bool)$isSuspicious,
  'reason'=>$reasons,
]);

// ---------------- helpers ----------------

function columnExists(PDO $pdo, string $table, string $col): bool {
  foreach ($pdo->query('SHOW COLUMNS FROM `'.$table.'`', PDO::FETCH_ASSOC) as $c) {
    if (isset($c['Field']) && $c['Field'] === $col) return true;
  }
  return false;
}
function pickCol(array $cols, array $candidates): ?string {
  foreach ($candidates as $c) if (isset($cols[$c])) return $c;
  return null;
}

/** PNG tIME chunk parser */
function read_png_time(?string $path): ?DateTime {
  if (!$path || !is_file($path)) return null;
  $fp = @fopen($path, 'rb'); if (!$fp) return null;
  $sig = fread($fp, 8);
  if ($sig !== ""\x89PNG\r\n\x1a\n"") { fclose($fp); return null; }
  while (!feof($fp)) {
    $lenData = fread($fp, 4); if (strlen($lenData)"
api/tournaments/team_create.php,11,text,,team_create_setattribute_pdo_attr_errmode_pdo_errmode_exception_if_e0628534,"setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
if (function_exists('require_user')) { $me = require_user(); }
elseif (function_exists('require_login')) { $me = require_login(); }
elseif (function_exists('require_auth')) { $me = require_auth(); }
else { $me = require_admin(); }
$uid = (int)($me['id'] ?? 0);


$token = $_POST['csrf'] ?? $_SERVER['HTTP_X_CSRF'] ?? '';
if (function_exists('verify_csrf') && !verify_csrf($pdo,(string)$token)) { http_response_code(403); echo json_encode(['ok'=>false,'error'=>'bad_csrf']); exit; }


$tid = (int)($_POST['tournament_id'] ?? 0);
$name = trim((string)($_POST['name'] ?? ''));
if ($tid"
api/tournaments/approve_run.php,23,text,,approve_run_setattribute_pdo_attr_errmode_pdo_errmode_exception_9d9dc82a,"setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // Admin n√∂tig
    $me = require_admin();

    // ---- Input
    $runId = (int)($_POST['run_id'] ?? $_POST['id'] ?? $_GET['run_id'] ?? $_GET['id'] ?? 0);

    // CSRF robust lesen: POST / GET / Header
    $token = $_REQUEST['csrf'] ?? ($_SERVER['HTTP_X_CSRF'] ?? '');

    // optional: Cookie-Token (falls dein Helper das nutzt)
    if (!$token && isset($_COOKIE['csrf'])) {
        $token = (string)$_COOKIE['csrf'];
    }

    // gleiche-Origin pr√ºfen (f√ºr Admin-Fallback)
    $ref        = $_SERVER['HTTP_REFERER'] ?? '';
    $host       = $_SERVER['HTTP_HOST'] ?? '';
    $sameOrigin = $ref && (parse_url($ref, PHP_URL_HOST) === $host);

    // eigentliche CSRF-Pr√ºfung
    $csrfOk = function_exists('verify_csrf') && verify_csrf($pdo, (string)$token);

    // Fallback: wenn gleiches Origin und Admin eingeloggt, erlauben (nur Backend-Buttons)
    if (!$csrfOk && $sameOrigin && !empty($me) && !empty($me['is_admin'])) {
        $csrfOk = true;
    }

    if (!$csrfOk) {
        http_response_code(403);
        echo json_encode(['ok' => false, 'error' => 'bad_csrf']);
        exit;
    }

    if ($runId"
api/tournaments/invite.php,15,text,,invite_prepare_select_t_tournament_id_t_captain_user_id_tr_team_90ecc659,"prepare('SELECT t.tournament_id, t.captain_user_id, tr.team_size FROM tournament_teams t JOIN tournaments tr ON tr.id=t.tournament_id WHERE t.id=?');
$st->execute([$team_id]);
$row = $st->fetch(PDO::FETCH_ASSOC);
if (!$row) json_err('team_not_found',404);
if ((int)$row['captain_user_id'] !== (int)$me['id']) json_err('not_captain',403);


// Teamgr√∂√üe pr√ºfen
$cur = $pdo->prepare('SELECT COUNT(*) FROM tournament_team_members WHERE tournament_team_id=?');
$cur->execute([$team_id]);
$slotsLeft = (int)$row['team_size'] - (int)$cur->fetchColumn();
if ($slotsLeft"
api/tournaments/my_state.php,17,text,,my_state_setattribute_pdo_attr_errmode_pdo_errmode_exception_6728fa96,"setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

  // User ermitteln (kompatibel mit verschiedenen Guard-Setups)
  if (function_exists('require_user'))      { $me = require_user(); }
  elseif (function_exists('require_login')) { $me = require_login(); }
  elseif (function_exists('require_auth'))  { $me = require_auth(); }
  else                                      { $me = require_admin(); }
  $uid = (int)($me['id'] ?? 0);

  // CSRF pr√ºfen
  $token = $_POST['csrf'] ?? $_SERVER['HTTP_X_CSRF'] ?? '';
  if (function_exists('verify_csrf') && !verify_csrf($pdo,(string)$token)) {
    http_response_code(403);
    echo json_encode(['ok'=>false,'error'=>'bad_csrf']);
    return; }

  $tid = (int)($_POST['tournament_id'] ?? 0);
  if ($tid"
api/tournaments/flag_run.php,19,text,,flag_run_setattribute_pdo_attr_errmode_pdo_errmode_exception_7e9f662c,"setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $me  = require_admin();

    // Input
    $runId  = (int)($_POST['run_id'] ?? $_POST['id'] ?? $_GET['run_id'] ?? $_GET['id'] ?? 0);
    $reason = trim((string)($_REQUEST['reason'] ?? ''));

    // CSRF (POST/GET/Header/Cookie) + Admin-Fallback auf gleicher Origin
    $token = $_REQUEST['csrf'] ?? ($_SERVER['HTTP_X_CSRF'] ?? '');
    if (!$token && isset($_COOKIE['csrf'])) $token = (string)$_COOKIE['csrf'];
    $ref = $_SERVER['HTTP_REFERER'] ?? ''; $host = $_SERVER['HTTP_HOST'] ?? '';
    $sameOrigin = $ref && (parse_url($ref, PHP_URL_HOST) === $host);
    $csrfOk = function_exists('verify_csrf') && verify_csrf($pdo, (string)$token);
    if (!$csrfOk && $sameOrigin && !empty($me) && !empty($me['is_admin'])) $csrfOk = true;
    if (!$csrfOk) { http_response_code(403); echo json_encode(['ok'=>false,'error'=>'bad_csrf']); exit; }
    if ($runId"
api/tournaments/lib.php,6,text,,lib_true_data_200_function_json_err_string_msg_int_c6ab7d81,"true] + $data, 200); }
function json_err(string $msg, int $code = 400, array $extra = []): void { json_out(['ok' => false, 'error' => $msg] + $extra, $code); }


function verify_csrf_if_available(): void {
if (function_exists('verify_csrf')) {
try { verify_csrf(); } catch (Throwable $e) { json_err('bad_csrf', 403); }
}
}


function require_admin_user(): array {
$me = require_auth();
$role = $me['role'] ?? 'user';
if (!in_array($role, ['administrator','moderator'], true)) json_err('forbidden', 403);
return $me;
}


function slugify(string $s): string {
$s = trim($s);
$s = mb_strtolower($s);
$s = preg_replace('~[^a-z0-9]+~u', '-', $s);
$s = trim($s, '-');
return $s !== '' ? $s : bin2hex(random_bytes(3));
}


function get_tournament(PDO $pdo, int $id): ?array {
$st = $pdo->prepare('SELECT * FROM tournaments WHERE id=?');
$st->execute([$id]);
$t = $st->fetch(PDO::FETCH_ASSOC);
return $t ?: null;
}


function ensure_team_member(PDO $pdo, int $teamId, int $userId): bool {
$st = $pdo->prepare('SELECT 1 FROM tournament_team_members WHERE tournament_team_id=? AND user_id=?');
$st->execute([$teamId, $userId]);
return (bool)$st->fetchColumn();
}


function compute_points_arr(array $run, array $sc): int {
$p = 0;
$p += (int)($run['kills'] ?? 0) * (int)($sc['kill'] ?? 1);
$p += (int)($run['boss_kills'] ?? 0) * (int)($sc['boss'] ?? 3);
$p += (int)($run['tokens'] ?? 0) * (int)($sc['token'] ?? 5);
if (!empty($run['gauntlet'])) $p += (int)($sc['gauntlet'] ?? 10);
$p += (int)($run['deaths'] ?? 0) * (int)($sc['death'] ?? -5);
return $p;
}


function can_submit_run(array $t): bool {
if (!in_array($t['status'], ['running','locked'], true)) return false;
$now = new DateTimeImmutable('now');
$start = new DateTimeImmutable($t['starts_at']);
$end = new DateTimeImmutable($t['ends_at']);
return $now >= $start && $now"
api/tournaments/run_decide.php,13,text,,run_decide_false_error_bad_csrf_exit_runid_int_po_0181ff4f,"false,'error'=>'bad_csrf']); exit; }

$runId  = (int)($_POST['run_id'] ?? 0);
$action = strtolower((string)($_POST['action'] ?? '')); // 'approve' | 'reject'
$reason = trim((string)($_POST['reason'] ?? ''));

if ($runId"
api/gamification/lib.php,10,text,,lib_prepare_insert_ignore_into_user_stats_user_id_values_96ca8083,"prepare(""INSERT IGNORE INTO user_stats (user_id) VALUES (?)"")->execute([$userId]);
}

/**
 * Erh√∂ht/Verringert einen Z√§hler und gibt den neuen Wert zur√ºck.
 * Erlaubte $stat: threads_count, posts_count, likes_given, likes_received, friends_count, points_total
 */
function gamify_bump(PDO $pdo, int $userId, string $stat, int $delta=1): int {
  gamify_ensure_stats($pdo, $userId);
  $allowed = ['threads_count','posts_count','likes_given','likes_received','friends_count','points_total'];
  if (!in_array($stat, $allowed, true)) throw new InvalidArgumentException('invalid stat');
  $pdo->prepare(""UPDATE user_stats SET {$stat}=GREATEST({$stat}+?,0), updated_at=NOW() WHERE user_id=?"")
      ->execute([$delta, $userId]);
  $st = $pdo->prepare(""SELECT {$stat} FROM user_stats WHERE user_id=?"");
  $st->execute([$userId]);
  return (int)$st->fetchColumn();
}

/** Platzhalter, falls sp√§ter doch WS genutzt wird. */
if (!function_exists('ws_push_notify')) {
  function ws_push_notify(int $recipientId, array $payload, string $event='notify'): void { /* no-op */ }
}

/**
 * Pr√ºft alle aktiven Achievements zum $event, schaltet fehlende frei
 * und gibt NEU freigeschaltete als Liste zur√ºck (f√ºr Popups im Frontend).
 */
function gamify_check(PDO $pdo, int $userId, string $event): array {
  $st = $pdo->prepare(""SELECT * FROM achievements WHERE is_active=1 AND rule_event=? ORDER BY threshold ASC"");
  $st->execute([$event]);
  $achs = $st->fetchAll(PDO::FETCH_ASSOC);
  if (!$achs) return [];

  gamify_ensure_stats($pdo, $userId);
  $rs = $pdo->prepare(""
    SELECT threads_count, posts_count, likes_given, likes_received, friends_count, points_total
    FROM user_stats WHERE user_id=?
  "");
  $rs->execute([$userId]);
  $s = $rs->fetch(PDO::FETCH_ASSOC) ?: [];

  $unlockedNow = [];
  foreach ($achs as $a) {
    $stat = (string)$a['rule_stat'];
    $need = (int)$a['threshold'];
    $have = (int)($s[$stat] ?? 0);
    if ($have"
api/video/upload.php,12,text,,upload_false_error_fatal_require_once_dir_5d38c304,"false,'error'=>'fatal']);
  }
});

require_once __DIR__ . '/../../auth/db.php';
require_once __DIR__ . '/../../auth/guards.php';
require_once __DIR__ . '/../../auth/csrf.php';

if (($_SERVER['REQUEST_METHOD'] ?? 'GET') !== 'POST') {
  http_response_code(405);
  echo json_encode(['ok'=>false,'error'=>'method_not_allowed']);
  exit;
}

$pdo  = db();
$user = require_auth();

$cfg      = require __DIR__ . '/../../auth/config.php';
$appBase  = rtrim($cfg['app_base'] ?? '', '/');
$sessName = $cfg['cookies']['session_name'] ?? 'sess_id';

$csrf = $_POST['csrf'] ?? ($_SERVER['HTTP_X_CSRF'] ?? null);
if (!check_csrf($pdo, $_COOKIE[$sessName] ?? '', $csrf)) {
  http_response_code(419);
  echo json_encode(['ok'=>false,'error'=>'csrf_failed']);
  exit;
}

/* ---------- Eingaben ---------- */
if (!isset($_FILES['video']['tmp_name']) || !is_uploaded_file($_FILES['video']['tmp_name'])) {
  http_response_code(400);
  echo json_encode(['ok'=>false,'error'=>'no_file']);
  exit;
}

$start = max(0.0, (float)($_POST['start'] ?? 0));
$end   = max(0.0, (float)($_POST['end']   ?? 0));
if (!($end > $start)) {
  http_response_code(400);
  echo json_encode(['ok'=>false,'error'=>'range_invalid']);
  exit;
}

$job = (string)($_POST['job'] ?? '');
if (!preg_match('/^[A-Za-z0-9_-]{8,40}$/', $job)) {
  // falls nichts Sinnvolles mitkommt, generieren wir selbst
  $job = bin2hex(random_bytes(8));
}

/* ---------- Pfade ---------- */
$rootVideos  = __DIR__ . '/../../uploads/videos';
$rootPosters = __DIR__ . '/../../uploads/video_posters';
$rootTmp     = __DIR__ . '/../../uploads/tmp';
foreach ([$rootVideos, $rootPosters, $rootTmp] as $dir) {
  if (!is_dir($dir) && !@mkdir($dir, 0775, true) && !is_dir($dir)) {
    http_response_code(500);
    echo json_encode(['ok'=>false,'error'=>'mkdir_failed']);
    exit;
  }
}

$progFile = $rootTmp . '/ffprog_' . $job . '.txt';
@file_put_contents($progFile, ""init=1\n""); // anlegen

/* ---------- Upload tempor√§r ablegen ---------- */
$tmpSrc = $rootTmp . '/up_' . bin2hex(random_bytes(6));
if (!@move_uploaded_file($_FILES['video']['tmp_name'], $tmpSrc)) {
  @unlink($progFile);
  http_response_code(500);
  echo json_encode(['ok'=>false,'error'=>'move_failed']);
  exit;
}

/* ---------- ffprobe Dauer ---------- */
function probe_duration(string $file): float {
  $cmd = 'ffprobe -v error -show_entries format=duration -of default=noprint_wrappers=1:nokey=1 ' . escapeshellarg($file);
  $out = []; @exec($cmd, $out, $rc);
  if ($rc !== 0 || empty($out)) return 0.0;
  return max(0.0, (float)$out[0]);
}

$total = probe_duration($tmpSrc);
if ($total"
api/video/upload.php,97,text,,upload_false_error_unsupported_media_exit_start_mi_df2e6857,"false,'error'=>'unsupported_media']);
  exit;
}

$start = min($start, max(0.0, $total - 0.1));
$end   = min($end, $total);
$dur   = max(0.1, $end - $start);

/* ---------- Ausgabedateien ---------- */
$baseName  = 'u' . (int)$user['id'] . '_' . date('Ymd_His') . '_' . bin2hex(random_bytes(4));
$outVideo  = $rootVideos  . '/' . $baseName . '.mp4';
$outPoster = $rootPosters . '/' . $baseName . '.jpg';

/* ---------- ffmpeg-Trim (neu encodieren + Fortschritt) ---------- */
$cmdVideo = sprintf(
  'ffmpeg -hide_banner -loglevel error -y ' .
  '-ss %s -i %s -t %s ' .
  '-analyzeduration 0 -probesize 5M -sn ' .
  '-c:v libx264 -preset veryfast -crf 23 -pix_fmt yuv420p ' .
  '-c:a aac -b:a 128k -movflags +faststart ' .
  '-progress %s -nostats ' .
  '%s',
  escapeshellarg((string)$start),
  escapeshellarg($tmpSrc),
  escapeshellarg((string)$dur),
  escapeshellarg($progFile),
  escapeshellarg($outVideo)
);
exec($cmdVideo, $void, $rcVideo);

/* Poster (nicht kritisch f√ºrs Fortschritt) */
$thumbAt = max(0.0, $dur / 2.0);
$cmdPoster = sprintf(
  'ffmpeg -hide_banner -loglevel error -y -ss %s -i %s -frames:v 1 -q:v 2 %s',
  escapeshellarg((string)$thumbAt),
  escapeshellarg($outVideo),
  escapeshellarg($outPoster)
);
exec($cmdPoster, $void2, $rcPoster);

/* Fortschritt ‚Äûend‚Äú markieren */
@file_put_contents($progFile, ""progress=end\n"");

/* ---------- Validierung ---------- */
$outDur = probe_duration($outVideo);
if ($rcVideo !== 0 || !is_file($outVideo) || filesize($outVideo)"
api/messages/cleanup_messages.php,17,text,,cleanup_messages_nichts_loschen_andern_nur_zahlen_hh_batch_227ef45c,"nichts l√∂schen/√§ndern, nur z√§hlen
 *   HH_BATCH            = Batchgr√∂√üe SELECT (Default 500)
 *   HH_UPDATE_CHUNK     = Update-Chunkgr√∂√üe (Default 200)
 */

require_once __DIR__ . '/../../auth/db.php';
$pdo = db();

/* ------------------ Parameter ------------------ */
$RETENTION_DAYS = (int) (getenv('HH_RETENTION_DAYS') ?: 15);
$PLACEHOLDER    = (string) (getenv('HH_PLACEHOLDER') ?: 'Anhang (Bild/Video) automatisch gel√∂scht ‚Äì √§lter als 15 Tage.');
$DRY_RUN        = (getenv('HH_DRY_RUN') === '1');
$BATCH          = (int) (getenv('HH_BATCH') ?: 500);
$UPDATE_CHUNK   = (int) (getenv('HH_UPDATE_CHUNK') ?: 200);

/* ------------------ Pfade ermitteln ------------------ */
$UPLOADDIR = null;
$DOCROOT   = null;

// 1) Override per Env
$env = getenv('HH_UPLOAD_DIR');
if ($env && is_dir($env)) {
  $UPLOADDIR = realpath($env) ?: $env;
  $DOCROOT   = preg_replace('~/?uploads/messages/?$~', '', $UPLOADDIR) ?: null;
  if ($DOCROOT && !is_dir($DOCROOT)) $DOCROOT = null;
}

// 2) Auto-Discovery
if (!$UPLOADDIR || !$DOCROOT) {
  $cur = __DIR__;
  for ($i=0; $i"
api/messages/cleanup_messages.php,66,text,,cleanup_messages_modify_retention_days_days_format_y_510bcb97,"modify('-'.$RETENTION_DAYS.' days')
            ->format('Y-m-d H:i:s');

/* ------------------ Helfer ------------------ */
$deletedFilesTotal = 0;
$totalScanned      = 0;
$updatedTotal      = 0;

$addFile = function(string $abs) use (&$deletedFilesTotal, $UPLOADDIR) {
  // nur Dateien innerhalb des Upload-Verzeichnisses zulassen (Whitelisting)
  $dir = realpath(is_dir($abs) ? $abs : dirname($abs)) ?: dirname($abs);
  if (strpos($dir, $UPLOADDIR) !== 0) return;
  if (is_file($abs) && !is_link($abs)) {
    // idempotent: Fehler egal
    @unlink($abs);
    $deletedFilesTotal++;
  }
};

$urlToAbs = function(string $url) use ($DOCROOT) : ?string {
  $path = parse_url($url, PHP_URL_PATH) ?: '';
  if ($path === '') return null;
  if ($path[0] !== '/') $path = '/'.ltrim($path, '/');
  if (strpos($path, '/uploads/messages/') !== 0) return null; // nur unsere Uploads
  return $DOCROOT . $path;
};

$extractMediaUrls = function(string $body) : array {
  $urls = [];

  // JSON-Anhang (aktuelles Format)
  $json = json_decode($body, true);
  if (is_array($json) && ($json['type'] ?? '') === 'attach') {
    $kind = strtolower((string)($json['kind'] ?? ''));
    if (($kind === 'image' || $kind === 'video') && !empty($json['url'])) {
      $urls[] = (string)$json['url'];
      if (!empty($json['meta']['thumb'])) $urls[] = (string)$json['meta']['thumb'];
      return $urls;
    }
  }

  // Legacy: [img]...[/img], [video poster=""...""]...[/video]
  if (preg_match_all('~\[(?:img|video)[^\]]*\](.*?)\[/\s*(?:img|video)\]~i', $body, $m)) {
    foreach ($m[1] as $u) $urls[] = (string)$u;
  }
  if (preg_match('~poster=""([^""]+)""~i', $body, $m2)) $urls[] = (string)$m2[1];

  return $urls;
};

$updatePlaceholders = function(PDO $pdo, array $ids, string $placeholder, int $chunkSize) : int {
  if (!$ids) return 0;
  $affected = 0;
  $pdo->setAttribute(PDO::ATTR_EMULATE_PREPARES, true); // erlaubt variable Anzahl Platzhalter
  foreach (array_chunk($ids, $chunkSize) as $chunk) {
    $in = implode(',', array_fill(0, count($chunk), '?'));
    $sql = ""UPDATE messages SET body = ? WHERE id IN ($in)"";
    $params = array_merge([$placeholder], $chunk);
    $pdo->beginTransaction();
    $stmt = $pdo->prepare($sql);
    $stmt->execute($params);
    $affected += $stmt->rowCount();
    $pdo->commit();
  }
  return $affected;
};

/* ------------------ Hauptschleife: Batches ------------------ */
while (true) {
  // nur nach Zeit filtern ‚Äì Medien-Erkennung in PHP
  $st = $pdo->prepare(""
    SELECT id, body
    FROM messages
    WHERE created_at"
api/messages/history.php,17,text,,history_false_error_auth_exit_other_4ece6636,"false, 'error' => 'auth']);
        exit;
    }

    $other   = isset($_GET['user_id'])  ? (int)$_GET['user_id']  : 0;
    $sinceId = isset($_GET['since_id']) ? (int)$_GET['since_id'] : 0;

    if ($other"
api/messages/history.php,26,text,,history_false_error_bad_user_exit_if_2be3b9fb,"false, 'error' => 'bad_user']);
        exit;
    }
    if ($sinceId"
api/messages/threads.php,13,text,,threads_false_error_unauthenticated_exit_b44c869e,"false, 'error' => 'unauthenticated']);
        exit;
    }

    $meId  = (int)$me['id'];
    $limit = isset($_GET['limit']) ? (int)$_GET['limit'] : 5;
    if ($limit"
api/messages/my_contacts.php,24,text,,my_contacts_prepare_convsql_st_execute_my_my_pairs_s_ad7f6d73,"prepare($convSql);
  $st->execute([$my, $my]);
  $pairs = $st->fetchAll(PDO::FETCH_ASSOC) ?: [];
  if (!$pairs) { echo json_encode(['ok'=>true,'items'=>[]]); exit; }

  $ids = array_map(fn($r)=>(int)$r['partner_id'], $pairs);
  $ph  = implode(',', array_fill(0, count($ids), '?'));

  $sqlU = ""SELECT id, display_name, avatar_path FROM users WHERE id IN ($ph)"";
  $params = $ids;
  if ($q !== '') {
    $sqlU .= "" AND display_name LIKE ?"";
    $params[] = '%'.$q.'%';
  }
  $u = $pdo->prepare($sqlU);
  $u->execute($params);
  $users = [];
  foreach ($u->fetchAll(PDO::FETCH_ASSOC) as $row) { $users[(int)$row['id']] = $row; }

  $getBody   = $pdo->prepare(""SELECT body FROM messages WHERE id = ?"");
  $cntUnread = $pdo->prepare(""
    SELECT COUNT(*) FROM messages
    WHERE sender_id = ? AND recipient_id = ? AND read_at IS NULL
  "");

  $items = [];
  foreach ($pairs as $r) {
    $uid = (int)$r['partner_id'];
    if (!isset($users[$uid])) continue;

    $getBody->execute([(int)$r['last_msg_id']]);
    $last = (string)($getBody->fetchColumn() ?: '');
    $label = trim(preg_replace('/\s+/', ' ', $last));
    if ($label !== '' && $label[0] === '{') {
      $j = json_decode($label, true);
      if (is_array($j) && ($j['type'] ?? '') === 'attach') {
        $kind  = strtolower((string)($j['kind'] ?? 'anhang'));
        $label = '[Anhang: '.$kind.']';
      }
    }

    $cntUnread->execute([$uid, $my]);
    $unread = (int)$cntUnread->fetchColumn();

    $items[] = [
      'user_id'      => $uid,
      'display_name' => $users[$uid]['display_name'],
      'avatar_path'  => $users[$uid]['avatar_path'],
      'last_text'    => $label,
      'unread'       => $unread,
    ];
  }

  // Wenn du zus√§tzlich nach ‚Äûletzte Aktivit√§t‚Äú sortieren willst:
  usort($items, function($a, $b) {
    return ($b['unread']"
api/messages/mark_read.php,10,text,,mark_read_false_error_method_exit_pdo_db_me_requ_83beb155,"false,'error'=>'method']); exit;
}

$pdo = db();
$me  = require_auth();
$cfg = require __DIR__ . '/../../auth/config.php';
$sn  = $cfg['cookies']['session_name'] ?? '';

if (!check_csrf($pdo, $_COOKIE[$sn] ?? '', (string)($_POST['csrf'] ?? ''))) {
  http_response_code(400); echo json_encode(['ok'=>false,'error'=>'csrf']); exit;
}

$otherId = (int)($_POST['user_id'] ?? 0);
$upToId  = (int)($_POST['up_to_id'] ?? 0);
if ($otherId"
api/messages/mark_read.php,24,text,,mark_read_false_error_bad_params_exit_st_pdo_prepare_2f9fd6d4,"false,'error'=>'bad_params']); exit; }

$st = $pdo->prepare(""
  UPDATE messages
     SET read_at = IF(read_at IS NULL, NOW(), read_at)
   WHERE recipient_id = ? AND sender_id = ? AND id"
api/messages/presence.php,20,text,,presence_true_users_exit_placeholde_a315c5f0,"true,'users'=>[]]);
        exit;
    }

    $placeholders = implode(',', array_fill(0, count($ids), '?'));
    $st = $pdo->prepare(""SELECT id, display_name, slug, last_seen FROM users WHERE id IN ($placeholders)"");
    $st->execute($ids);
    $rows = $st->fetchAll(PDO::FETCH_ASSOC);

    $ONLINE_WINDOW = 120; // Sekunden: innerhalb der letzten 2 Minuten gesehen = online
    $now = time();
    $out = [];
    foreach ($rows as $r) {
        $ls  = isset($r['last_seen']) ? strtotime((string)$r['last_seen']) : 0;
        $out[(int)$r['id']] = [
            'online'    => $ls && ($now - $ls)"
api/messages/send.php,10,text,,send_false_error_method_exit_pdo_db_me_requ_24f926e1,"false,'error'=>'method']); exit;
}

$pdo = db();
$me  = require_auth();
$cfg = require __DIR__ . '/../../auth/config.php';
$sn  = $cfg['cookies']['session_name'] ?? '';

// --- simples Rate-Limit: max. 20 Nachrichten pro 60 Sekunden ---
$WINDOW_SECONDS = 60;
$MAX_MESSAGES   = 20;
$cutoff = date('Y-m-d H:i:s', time() - $WINDOW_SECONDS);

$st = $pdo->prepare(""SELECT COUNT(*) AS c FROM messages WHERE sender_id = :me AND created_at > :cutoff"");
$st->execute([':me'=>$me['id'], ':cutoff'=>$cutoff]);
$cnt = (int)$st->fetchColumn();

if ($cnt >= $MAX_MESSAGES) {
  http_response_code(429);
  echo json_encode(['ok'=>false,'error'=>'rate_limit','detail'=>'Zu viele Nachrichten, bitte kurz warten.']);
  exit;
}
// --- Ende Rate-Limit ---

if (!check_csrf($pdo, $_COOKIE[$sn] ?? '', (string)($_POST['csrf'] ?? ''))) {
  http_response_code(400); echo json_encode(['ok'=>false,'error'=>'csrf']); exit;
}

$otherId = (int)($_POST['user_id'] ?? 0);
$body    = trim((string)($_POST['body'] ?? ''));

if ($otherId"
api/messages/last_seen.php,10,text,,last_seen_false_error_auth_exit_other_isset_get_us_b4abc2d2,"false,'error'=>'auth']); exit; }

  $other = isset($_GET['user_id']) ? (int)$_GET['user_id'] : 0;
  if ($other"
api/upload_image_tiny.php,37,text,,upload_image_tiny_5_1024_1024_throw_new_runtimeexception_datei_b98b65b0,"5 * 1024 * 1024) {
        throw new RuntimeException('Datei zu gro√ü (max. 5 MB).');
    }

    $finfo = new finfo(FILEINFO_MIME_TYPE);
    $mime  = $finfo->file($file['tmp_name']) ?: 'application/octet-stream';
    $allowed = [
        'image/png'  => 'png',
        'image/jpeg' => 'jpg',
        'image/webp' => 'webp',
        'image/gif'  => 'gif',
    ];
    if (!isset($allowed[$mime])) {
        throw new RuntimeException('Nur PNG/JPG/WEBP/GIF erlaubt.');
    }

    $root = realpath(__DIR__ . '/..'); // /cms/api -> /cms
    $relDir = '/uploads/posts';
    $targetDir = $root . $relDir;
    if (!is_dir($targetDir)) {
        if (!mkdir($targetDir, 0775, true) && !is_dir($targetDir)) {
            throw new RuntimeException('Upload-Verzeichnis nicht beschreibbar.');
        }
    }

    $ext  = $allowed[$mime];
    $base = bin2hex(random_bytes(6));
    $name = sprintf('%s_%d.%s', $base, (int)$me['id'], $ext);
    $dest = $targetDir . '/' . $name;

    if (!move_uploaded_file($file['tmp_name'], $dest)) {
        throw new RuntimeException('Speichern fehlgeschlagen.');
    }

    $url = $APP_BASE . $relDir . '/' . $name;

    // TinyMCE erwartet {""location"": """
api/auth/reset.php,10,text,,reset_json_ok_true_redirect_sonst_303_redirect_try_b65c5027,"JSON {ok:true, redirect}, sonst 303 Redirect
 */
try {
    $accept     = $_SERVER['HTTP_ACCEPT'] ?? '';
    $xhrHeader  = strtolower($_SERVER['HTTP_X_REQUESTED_WITH'] ?? '') === 'xmlhttprequest';
    $wantsJson  = $xhrHeader || stripos($accept, 'application/json') !== false;

    $pdo = db();
    $pdo->setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);

    // Eingabe
    $ct  = $_SERVER['CONTENT_TYPE'] ?? '';
    $raw = file_get_contents('php://input') ?: '';
    $in  = [];
    if (stripos($ct, 'application/json') !== false) {
        $in = json_decode($raw, true) ?: [];
    } elseif (!empty($_POST)) {
        $in = $_POST;
    } else {
        parse_str($raw, $in);
        if (!is_array($in)) $in = [];
    }

    $token = trim((string)($in['token'] ?? ($_GET['token'] ?? '')));
    $pass  = (string)($in['password'] ?? '');

    if ($token === '' || $pass === '' || strlen($pass)"
api/auth/reset.php,37,text,,reset_false_error_ungultige_eingabe_else_head_44efb306,"false,'error'=>'Ung√ºltige Eingabe']); }
        else { header('Location: /reset.php?token='.urlencode($token).'&err=1', true, 303); }
        exit;
    }

    $tbl = $cfg['password_resets_table'] ?? 'auth_password_resets';
    $st = $pdo->prepare(""SELECT r.id, r.user_id, r.expires_at, r.used_at, u.id AS uid FROM `{$tbl}` r JOIN users u ON u.id = r.user_id WHERE r.token=? LIMIT 1"");
    $st->execute([$token]);
    $row = $st->fetch();

    if (!$row || $row['used_at'] !== null || strtotime((string)$row['expires_at'])"
api/auth/oauth_lib.php,16,text,,oauth_lib_true_curlopt_post_true_curlopt_postfields_ht_8b307594,"true,
    CURLOPT_POST => true,
    CURLOPT_POSTFIELDS => http_build_query($data),
    CURLOPT_HTTPHEADER => $headers,
  ]);
  $res = curl_exec($ch);
  if ($res === false) throw new RuntimeException('HTTP POST failed: '.curl_error($ch));
  $code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
  curl_close($ch);
  $json = json_decode($res, true);
  if ($code >= 400) throw new RuntimeException('HTTP '.$code.': '.$res);
  return $json ?? [];
}

function http_get_json(string $url, array $headers = []): array {
  $ch = curl_init($url);
  $headers = array_merge(['Accept: application/json'], $headers);
  curl_setopt_array($ch, [
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_HTTPHEADER => $headers,
  ]);
  $res = curl_exec($ch);
  if ($res === false) throw new RuntimeException('HTTP GET failed: '.curl_error($ch));
  $code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
  curl_close($ch);
  $json = json_decode($res, true);
  if ($code >= 400) throw new RuntimeException('HTTP '.$code.': '.$res);
  return $json ?? [];
}

/**
 * OAuth State (CSRF-Schutz)
 */
function oauth_state_start(string $provider): string {
  if (session_status() !== PHP_SESSION_ACTIVE) session_start();
  $state = bin2hex(random_bytes(16));
  $_SESSION['oauth_state_'.$provider] = $state;
  return $state;
}

function oauth_state_check(string $provider, ?string $incoming): void {
  if (session_status() !== PHP_SESSION_ACTIVE) session_start();
  $expected = $_SESSION['oauth_state_'.$provider] ?? null;
  unset($_SESSION['oauth_state_'.$provider]);
  if (!$expected || !$incoming || !hash_equals($expected, $incoming)) {
    throw new RuntimeException('Invalid OAuth state');
  }
}

/**
 * Display-Name/Slug-Generator
 */
function generate_unique_display(string $base): array {
  $pdo = db();
  $slug = preg_replace('~[^a-z0-9]+~i', '-', strtolower(trim($base)));
  $slug = trim($slug, '-');
  if ($slug === '') $slug = 'user';
  $display = $base;

  $suffix = 1;
  $slugTry = $slug;
  $displayTry = $display;
  while (true) {
    $stmt = $pdo->prepare(""SELECT COUNT(*) FROM users WHERE slug = ? OR display_name = ?"");
    $stmt->execute([$slugTry, $displayTry]);
    $exists = (int)$stmt->fetchColumn();
    if ($exists === 0) break;
    $suffix++;
    $slugTry = $slug . '-' . $suffix;
    $displayTry = $display . ' ' . $suffix;
  }
  return [$displayTry, $slugTry];
}

/**
 * Avatar-Download
 */
function fetch_binary(string $url): ?string {
  if (function_exists('curl_init')) {
    $ch = curl_init($url);
    curl_setopt_array($ch, [
      CURLOPT_RETURNTRANSFER => true,
      CURLOPT_FOLLOWLOCATION => true,
      CURLOPT_TIMEOUT => 20,
      CURLOPT_SSL_VERIFYPEER => true,
      CURLOPT_SSL_VERIFYHOST => 2,
      CURLOPT_USERAGENT => 'HunthubAvatarDownloader/1.0',
    ]);
    $data = curl_exec($ch);
    $code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    if ($data !== false && $code >= 200 && $code"
api/auth/forgot.php,15,text,,forgot_setattribute_pdo_attr_default_fetch_mode_pdo_fetch_assoc_317d6fd6,"setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);

    // Logging
    $logDir = __DIR__ . '/../../var';
    if (!is_dir($logDir)) { @mkdir($logDir, 0775, true); }
    $logFile = $logDir . '/reset-links.log';
    $log = function (string $m) use ($logFile) {
        @file_put_contents($logFile, '['.date('c').'] '.$m.""\n"", FILE_APPEND);
    };

    // Eingabe lesen (JSON/FORM)
    $contentType = $_SERVER['CONTENT_TYPE'] ?? '';
    $raw = file_get_contents('php://input'); if ($raw === false) $raw = '';
    $in = [];
    if (stripos($contentType, 'application/json') !== false) {
        $tmp = json_decode($raw, true);
        $in  = is_array($tmp) ? $tmp : [];
    } elseif (!empty($_POST)) {
        $in = $_POST;
    } else {
        parse_str($raw, $in);
        if (!is_array($in)) $in = [];
    }

    // Email normalisieren (case-insensitive)
    $email = trim((string)($in['email'] ?? ''));
    $email = function_exists('mb_strtolower') ? mb_strtolower($email) : strtolower($email);

    if ($email === '') {
        if ($wantsJson) {
            header('Content-Type: application/json; charset=utf-8');
            http_response_code(400);
            echo json_encode(['ok'=>false, 'message'=>'Bitte E-Mail eingeben.']);
        } else {
            header('Location: /forgot.php?err=1', true, 303);
        }
        exit;
    }

    // Tabelle sicherstellen
    $tbl = $cfg['password_resets_table'] ?? 'auth_password_resets';
    $pdo->exec(
        ""CREATE TABLE IF NOT EXISTS `{$tbl}` (
          `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
          `user_id` INT UNSIGNED NOT NULL,
          `token` CHAR(64) NOT NULL,
          `created_at` DATETIME NOT NULL,
          `expires_at` DATETIME NOT NULL,
          `used_at` DATETIME NULL DEFAULT NULL,
          `ip` VARCHAR(45) NULL,
          `user_agent` VARCHAR(255) NULL,
          PRIMARY KEY(`id`),
          UNIQUE KEY `uniq_token` (`token`),
          KEY `idx_user` (`user_id`),
          KEY `idx_expires` (`expires_at`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4""
    );

    // User suchen (case-insensitive)
    $st = $pdo->prepare('SELECT id, email, display_name FROM users WHERE LOWER(email)=LOWER(?) LIMIT 1');
    $st->execute([$email]);
    $u = $st->fetch();

    if (!$u) {
        $log('NO_USER email='.$email);
        if ($wantsJson) {
            header('Content-Type: application/json; charset=utf-8');
            http_response_code(404);
            echo json_encode(['ok'=>false, 'message'=>'User/E-Mail Adresse existiert nicht.']);
        } else {
            header('Location: /forgot.php?err=notfound', true, 303);
        }
        exit;
    }

    // Token ggf. wiederverwenden ("
api/auth/register.php,16,text,,register_false_error_missing_fields_if_email_valid_emai_ec20fa6f,"false,'error'=>'missing_fields']));
}
if (!email_valid($email)) {
  http_response_code(422);
  exit(json_encode(['ok'=>false,'error'=>'invalid_email']));
}
if (strlen($pass)"
api/auth/reg.php,94,text,,reg_target_blank_rel_noopener_76d7be2a,""" target=""_blank"" rel=""noopener"">"
api/auth/reg.php,104,text,,reg_api_auth_oauth_start_php_provider_google_google_4123fc74,"/api/auth/oauth_start.php?provider=google"">Google"
api/auth/reg.php,105,text,,reg_api_auth_oauth_start_php_provider_discord_discord_13c89846,"/api/auth/oauth_start.php?provider=discord"">Discord"
api/auth/reg.php,117,text,,reg_i18n_mask_script_0_2d790641,%%I18N_MASK_SCRIPT_0%%
api/auth/reg.php,71,attr,placeholder,reg_placeholder_z_b_nightrunner_01943e14,"z. B. NightRunner"
api/auth/reg.php,76,attr,placeholder,reg_placeholder_you_example_com_7e83beb2,you@example.com
api/forum/comment_update.php,10,text,,comment_update_false_error_method_not_allowed_exit_require_on_c11a5951,"false,'error'=>'method_not_allowed']);
  exit;
}

require_once __DIR__ . '/../../auth/guards.php';
require_once __DIR__ . '/../../auth/db.php';
require_once __DIR__ . '/../../auth/csrf.php';
require_once __DIR__ . '/../../forum/lib_forum_text.php';

$pdo  = db();
$user = require_auth();

$cfg  = require __DIR__ . '/../../auth/config.php';
$csrf = $_POST['csrf']
     ?? ($_SERVER['HTTP_X_CSRF'] ?? ($_SERVER['HTTP_X_CSRF_TOKEN'] ?? null));

$sid  = $_COOKIE[$cfg['cookies']['session_name']] ?? '';

if (!check_csrf($pdo, $sid, $csrf)) {
  http_response_code(419);
echo json_encode(['ok'=>false,'error'=>'csrf_failed']);
  exit;
}

$commentId = isset($_POST['comment_id']) ? (int)$_POST['comment_id'] : 0;
$content   = isset($_POST['content']) ? (string)$_POST['content'] : '';

if ($commentId"
api/forum/create_thread.php,28,text,,create_thread_function_linkify_plain_urls_string_html_string_r_d0b14c16,"*/
function linkify_plain_urls(string $html): string {
    return preg_replace_callback(
        '~(?"
api/forum/create_thread.php,31,text,,create_thread_https_s_b7609667,"])(https?://[^\s"""
api/forum/create_thread.php,32,text,,create_thread_htmlspecialchars_m_1_eb850224,'.htmlspecialchars($m[1]).'
api/forum/create_thread.php,32,text,,create_thread_html_helper_fur_mention_normalisie_9373ae6f,"',
        $html
    );
}

/** Helper f√ºr Mention-Normalisierung */
function normalize_name(string $s): string {
    $s = preg_replace('/\s+/u', '', $s ?? '');
    return mb_strtolower($s, 'UTF-8');
}

// Nur POST
if (($_SERVER['REQUEST_METHOD'] ?? 'GET') !== 'POST') {
    http_response_code(405);
    echo json_encode(['ok'=>false,'error'=>'method_not_allowed']);
    exit;
}

$pdo   = db();
$user  = require_auth();
$cfg   = require __DIR__ . '/../../auth/config.php';

// CSRF
$session = $_COOKIE[$cfg['cookies']['session_name']] ?? '';
$csrf = $_POST['csrf'] ?? ($_SERVER['HTTP_X_CSRF'] ?? ($_SERVER['HTTP_X_CSRF_TOKEN'] ?? null));
if (!check_csrf($pdo, $session, $csrf)) {
    http_response_code(419);
    echo json_encode(['ok'=>false,'error'=>'csrf_failed']);
    exit;
}

// Eingaben
$board_id = (int)($_POST['board_id'] ?? 0);
$title    = trim((string)($_POST['title'] ?? ''));
$content  = trim((string)($_POST['content'] ?? ''));

if ($board_id"
api/forum/create_thread.php,70,text,,create_thread_false_error_invalid_input_exit_links_klic_e3718aa5,"false,'error'=>'invalid_input']);
    exit;
}

// Links klickbar machen
$content = linkify_plain_urls($content);

// Mentions
$mentionIds = [];
$mentionsRaw = $_POST['mentions'] ?? '[]';
$mentionsArr = json_decode((string)$mentionsRaw, true);
if (is_array($mentionsArr)) {
    foreach ($mentionsArr as $m) {
        $id = (int)($m['id'] ?? 0);
        if ($id > 0 && $id !== (int)$user['id']) $mentionIds[$id] = true;
    }
}
if (!$mentionIds) {
    if (preg_match_all('/@([^\s"
api/forum/create_post.php,18,text,,create_post_false_error_method_not_allowed_exit_pdo_db_cbdf261d,"false,'error'=>'method_not_allowed']);
  exit;
}

$pdo  = db();
$user = require_auth();

$cfg  = require __DIR__ . '/../../auth/config.php';
$csrf = $_POST['csrf']
     ?? ($_SERVER['HTTP_X_CSRF'] ?? ($_SERVER['HTTP_X_CSRF_TOKEN'] ?? null));

if (!check_csrf($pdo, $_COOKIE[$cfg['cookies']['session_name']] ?? '', $csrf)) {
  http_response_code(419);
  echo json_encode(['ok'=>false,'error'=>'csrf_failed']);
  exit;
}

/* ------------ Eingaben ------------ */
$thread_id = isset($_POST['thread_id']) ? (int)$_POST['thread_id'] : 0;

// Frontend liefert i.d.R. bereits fertiges HTML in ""content"" (siehe thread.php)
$content = trim((string)($_POST['content'] ?? ''));

// Legacy-Fallback: content_plain + content_html zusammenbauen, falls ""content"" leer ist
if ($content === '') {
  $plain = trim((string)($_POST['content_plain'] ?? ''));
  $extra = trim((string)($_POST['content_html'] ?? ''));
  if ($plain !== '') {
    $esc = htmlspecialchars($plain, ENT_QUOTES, 'UTF-8');
    $blocks = preg_split('/\n{2,}/', $esc) ?: [];
    $content = '"
api/forum/create_post.php,48,text,,create_post_implode_ec2ba603,'.implode('
api/forum/create_post.php,48,text,,create_post_array_map_fn_p_str_replace_n_0856d30c,"', array_map(fn($p)=>str_replace(""\n"", '"
api/forum/create_post.php,48,text,,create_post_p_blocks_fb5e40bf,"', $p), $blocks)).'"
api/forum/create_post.php,48,text,,create_post_if_extra_content_content_co_fe52d6dd,"';
  }
  if ($extra !== '') {
    $content = $content ? ($content.""\n"".$extra) : $extra;
  }
}

// Bild aus Editor (Base64 Data-URL)
$editedImageDataUrl = (string)($_POST['edited_image'] ?? '');

/* ------------ Thread pr√ºfen ------------ */
$st = $pdo->prepare(""SELECT board_id, is_locked FROM threads WHERE id = ? AND deleted_at IS NULL"");
$st->execute([$thread_id]);
$thread = $st->fetch(PDO::FETCH_ASSOC);

if (!$thread) { http_response_code(404); echo json_encode(['ok'=>false,'error'=>'thread_not_found']); exit; }
if ((int)$thread['is_locked'] === 1) { http_response_code(403); echo json_encode(['ok'=>false,'error'=>'thread_locked']); exit; }

/* ------------ Upload-Helfer ------------ */
$DOC = rtrim((string)($_SERVER['DOCUMENT_ROOT'] ?? ''), '/');
$UPLOAD_DIR = $DOC . '/uploads/forum';
$PUBLIC_BASE = '/uploads/forum'; // √∂ffentlich erreichbar

if (!is_dir($UPLOAD_DIR)) {
  @mkdir($UPLOAD_DIR, 0777, true);
}

function save_base64_image(string $dataUrl, string $destDir): array {
  // erwartet data:image/"
api/forum/create_post.php,76,text,,create_post_base64_xxxx_if_preg_match_data_image_png_jpe_g_gif_e15d4667,";base64,XXXX
  if (!preg_match('~^data:(image/(png|jpe?g|gif|webp));base64,~i', $dataUrl, $m)) {
    return [false, 'unsupported_dataurl', null];
  }
  $mime = strtolower($m[1]);
  $ext  = $m[2] === 'jpeg' ? 'jpg' : ($m[2] === 'jpg' ? 'jpg' : $m[2]);
  $bin  = base64_decode(preg_replace('~^data:[^,]+,~', '', $dataUrl), true);
  if ($bin === false) return [false, 'decode_failed', null];

  $name = 'post_' . date('Ymd_His') . '_' . bin2hex(random_bytes(4)) . '.' . $ext;
  $path = rtrim($destDir,'/') . '/' . $name;
  if (file_put_contents($path, $bin) === false) {
    return [false, 'write_failed', null];
  }
  return [true, null, $name];
}

function save_uploaded_file(array $file, string $destDir): array {
  if (($file['error'] ?? UPLOAD_ERR_NO_FILE) !== UPLOAD_ERR_OK) {
    return [false, 'no_file', null];
  }
  $finfo = finfo_open(FILEINFO_MIME_TYPE);
  $mime  = finfo_file($finfo, $file['tmp_name']) ?: '';
  finfo_close($finfo);
  if (!preg_match('~^image/(png|jpe?g|gif|webp)$~i', $mime, $m)) {
    return [false, 'unsupported_mime', null];
  }
  $ext = strtolower($m[1]) === 'jpeg' ? 'jpg' : strtolower($m[1]);
  $name = 'post_' . date('Ymd_His') . '_' . bin2hex(random_bytes(4)) . '.' . $ext;
  $dest = rtrim($destDir,'/') . '/' . $name;
  if (!move_uploaded_file($file['tmp_name'], $dest)) {
    return [false, 'move_failed', null];
  }
  return [true, null, $name];
}

/* ------------ optional: Bild speichern ------------ */
$imageUrl = null;

// Priorit√§t 1: bearbeitetes Bild (Editor)
if ($editedImageDataUrl !== '') {
  [$ok, $err, $fn] = save_base64_image($editedImageDataUrl, $UPLOAD_DIR);
  if ($ok && $fn) {
    $imageUrl = $PUBLIC_BASE . '/' . $fn;
    // Bild-Snippet an den Content anh√§ngen (oder Content setzen, wenn leer)
    $imgHtml = '"
api/forum/create_post.php,121,text,,create_post_content_content_content_n_imghtml_72d80eb6,"';
    $content = $content ? ($content . ""\n"" . $imgHtml) : $imgHtml;
  }
}

// Priorit√§t 2: klassischer Datei-Upload (falls zus√§tzlich vorhanden)
if ($imageUrl === null && !empty($_FILES['file']) && is_array($_FILES['file'])) {
  [$ok, $err, $fn] = save_uploaded_file($_FILES['file'], $UPLOAD_DIR);
  if ($ok && $fn) {
    $imageUrl = $PUBLIC_BASE . '/' . $fn;
    $imgHtml = '"
api/forum/create_post.php,131,text,,create_post_content_content_content_n_imghtml_fafd3b70,"';
    $content = $content ? ($content . ""\n"" . $imgHtml) : $imgHtml;
  }
}

/* ------------ Validierung: Text ODER Bild muss vorhanden sein ------------ */
if ($thread_id"
api/forum/create_post.php,139,text,,create_post_false_error_invalid_input_exit_346dc36d,"false,'error'=>'invalid_input']);
  exit;
}

/* ------------ Mentions vorbereiten ------------ */
function normalize_name(string $s): string {
  $s = preg_replace('/\s+/u', '', $s ?? '');
  return mb_strtolower($s, 'UTF-8');
}

$mentionIds = [];
$mentionsRaw = $_POST['mentions'] ?? '[]';
$mentionsArr = json_decode((string)$mentionsRaw, true);
if (is_array($mentionsArr)) {
  foreach ($mentionsArr as $m) {
    $id = (int)($m['id'] ?? 0);
    if ($id > 0 && $id !== (int)$user['id']) $mentionIds[$id] = true;
  }
}
if (!$mentionIds) {
  if (preg_match_all('/@([^\s"
api/forum/create_post.php,159,text,,create_post_3_40_u_content_m_tokens_array_unique_ar_5dfa6c78,"&]{3,40})/u', $content, $m)) {
    $tokens = array_unique(array_map('normalize_name', $m[1]));
    if ($tokens) {
      $ph  = implode(',', array_fill(0, count($tokens), '?'));
      $sql = ""SELECT id, display_name FROM users
              WHERE REPLACE(LOWER(display_name), ' ', '') IN ($ph)"";
      $st = $pdo->prepare($sql);
      $st->execute($tokens);
      foreach ($st->fetchAll(PDO::FETCH_ASSOC) as $u) {
        $uid = (int)$u['id'];
        if ($uid !== (int)$user['id']) $mentionIds[$uid] = true;
      }
    }
  }
}
$mentionIds = array_map('intval', array_keys($mentionIds));

/* ------------ Links automatisch klickbar machen (ohne vorhandene"
api/forum/create_post.php,176,text,,create_post_zu_doppeln_function_linkify_plain_urls_stri_a8efe09e,"zu doppeln) ------------ */
function linkify_plain_urls(string $html): string {
  return preg_replace_callback(
    '~(?"
api/forum/create_post.php,179,text,,create_post_https_s_9c1b859d,"])(https?://[^\s"""
api/forum/create_post.php,180,text,,create_post_htmlspecialchars_m_1_6e81b18d,'.htmlspecialchars($m[1]).'
api/forum/toggle_like.php,17,text,,toggle_like_query_show_columns_from_notifications_foreach_st_as_d2458552,"query(""SHOW COLUMNS FROM notifications"");
  foreach ($st as $row) {
    $cols[] = $row['Field'] ?? array_values($row)[0];
  }
  return $cols;
}

function notif_delete(PDO $pdo, int $recipientId, int $actorId, string $type, string $objectType, int $objectId): void {
  $cols = notif_cols($pdo);
  $where = ['user_id=?','actor_id=?','type=?'];
  $args  = [$recipientId, $actorId, $type];
  if (in_array('object_id', $cols, true))   { $where[] = 'object_id=?';   $args[] = $objectId; }
  if (in_array('object_type', $cols, true)) { $where[] = 'object_type=?'; $args[] = $objectType; }
  $sql = ""DELETE FROM notifications WHERE "".implode(' AND ',$where);
  $pdo->prepare($sql)->execute($args);
}

function notif_insert(PDO $pdo, int $recipientId, int $actorId, string $type, string $objectType, int $objectId, array $meta = []): void {
  if ($recipientId === $actorId) return; // kein Self-Notify
  $cols = notif_cols($pdo);
  notif_delete($pdo, $recipientId, $actorId, $type, $objectType, $objectId);
  $fields = ['user_id','actor_id','type'];
  $ph     = ['?','?','?'];
  $args   = [$recipientId,$actorId,$type];
  if (in_array('object_type',$cols,true)) { $fields[]='object_type'; $ph[]='?'; $args[]=$objectType; }
  if (in_array('object_id'  ,$cols,true)) { $fields[]='object_id';   $ph[]='?'; $args[]=$objectId;   }
  $metaJson = json_encode($meta, JSON_UNESCAPED_UNICODE|JSON_UNESCAPED_SLASHES);
  if (in_array('meta_json',$cols,true))   { $fields[]='meta_json';   $ph[]='?'; $args[]=$metaJson; }
  elseif (in_array('meta',$cols,true))    { $fields[]='meta';        $ph[]='?'; $args[]=$metaJson; }
  if (in_array('created_at',$cols,true))  { $fields[]='created_at';  $ph[]='NOW()'; }
  $sql = ""INSERT INTO notifications ("".implode(',',$fields)."") VALUES ("".implode(',',$ph)."")"";
  $pdo->prepare($sql)->execute($args);
}
/* ---- /helpers ---- */

// Lade die Konfiguration VOR dem try-Block
$cfg  = require __DIR__ . '/../../auth/config.php';

try {
  if (($_SERVER['REQUEST_METHOD'] ?? 'GET') !== 'POST') {
    http_response_code(405);
    echo json_encode(['ok'=>false,'error'=>'method_not_allowed']);
    exit;
  }

  $pdo = db();
  $me  = require_auth();

  $csrf = $_POST['csrf'] ?? ($_SERVER['HTTP_X_CSRF'] ?? ($_SERVER['HTTP_X_CSRF_TOKEN'] ?? null));
  if (!check_csrf($pdo, $_COOKIE[$cfg['cookies']['session_name']] ?? '', $csrf)) {
    http_response_code(419);
    echo json_encode(['ok'=>false,'error'=>'csrf_failed']);
    exit;
  }

  $type = $_POST['type'] ?? '';
  $id   = isset($_POST['id']) ? (int)$_POST['id'] : 0;
  if (!in_array($type, ['thread','post'], true) || $id"
api/forum/comment_delete.php,9,text,,comment_delete_false_error_method_not_allowed_exit_require_o_9695d370,"false, 'error'=>'method_not_allowed']);
  exit;
}

require_once __DIR__ . '/../../auth/guards.php';
require_once __DIR__ . '/../../auth/db.php';
require_once __DIR__ . '/../../auth/csrf.php';

$pdo  = db();
$user = require_auth();

$cfg  = require __DIR__ . '/../../auth/config.php';
$csrf = $_POST['csrf']
     ?? ($_SERVER['HTTP_X_CSRF'] ?? ($_SERVER['HTTP_X_CSRF_TOKEN'] ?? null));

$sid  = $_COOKIE[$cfg['cookies']['session_name']] ?? '';

if (!check_csrf($pdo, $sid, $csrf)) {
http_response_code(419);
echo json_encode(['ok'=>false,'error'=>'csrf_failed']);
  exit;
}

$commentId = isset($_POST['comment_id']) ? (int)$_POST['comment_id'] : 0;
if ($commentId"
api/ratings/submit.php,29,text,,submit_play_friendly_friendly_helpful_helpful_as_k_v_ac0f6816,"$play,'friendly'=>$friendly,'helpful'=>$helpful] as $k=>$v) {
    if ($v"
api/gamercard.php,27,text,,gamercard_prepare_select_id_display_name_slug_avatar_path_created_ae1bed28,"prepare(""SELECT id, display_name, slug, avatar_path, created_at FROM users WHERE slug=? LIMIT 1"");
  $st->execute([$slug]);
} else {
  $st = $pdo->prepare(""SELECT id, display_name, slug, avatar_path, created_at FROM users WHERE id=? LIMIT 1"");
  $st->execute([$uid]);
}
$user = $st->fetch(PDO::FETCH_ASSOC);
if (!$user) fail('user not found', 404, $debug);
$uid = (int)$user['id'];

/* ---- Stats ---- */
$st = $pdo->prepare(""SELECT COUNT(*) FROM threads WHERE author_id=?"");
$st->execute([$uid]); $threadsCount = (int)$st->fetchColumn();

$st = $pdo->prepare(""SELECT COUNT(*) FROM posts WHERE author_id=?"");
$st->execute([$uid]); $postsCount = (int)$st->fetchColumn();

$st = $pdo->prepare(""SELECT COALESCE(SUM(likes_count),0) FROM threads WHERE author_id=?"");
$st->execute([$uid]); $likesThreads = (int)$st->fetchColumn();

$st = $pdo->prepare(""SELECT COALESCE(SUM(likes_count),0) FROM posts WHERE author_id=?"");
$st->execute([$uid]); $likesPosts = (int)$st->fetchColumn();

$likesTotal = $likesThreads + $likesPosts;

/* ---- Canvas ---- */
$W=1200; $H=360; $R=32; $PAD=32;

$im = imagecreatetruecolor($W,$H);
imagesavealpha($im,true); imagealphablending($im,true);
$trans = imagecolorallocatealpha($im,0,0,0,127);
imagefill($im,0,0,$trans);

$bgDark   = imagecolorallocate($im,17,17,17);
$muted    = imagecolorallocate($im,156,163,175);
$white    = imagecolorallocate($im,238,238,238);
$accent   = imagecolorallocate($im,242,150,32);

/* ---- Rounded rect helper ---- */
$rounded = function($img,$x1,$y1,$x2,$y2,$r,$col){
  imagefilledrectangle($img,$x1+$r,$y1,$x2-$r,$y2,$col);
  imagefilledrectangle($img,$x1,$y1+$r,$x2,$y2-$r,$col);
  imagefilledellipse($img,$x1+$r,$y1+$r,2*$r,2*$r,$col);
  imagefilledellipse($img,$x2-$r,$y1+$r,2*$r,2*$r,$col);
  imagefilledellipse($img,$x1+$r,$y2-$r,2*$r,2*$r,$col);
  imagefilledellipse($img,$x2-$r,$y2-$r,2*$r,2*$r,$col);
};
$rounded($im,0,0,$W-1,$H-1,$R,$bgDark);

/* ---- Avatar ---- */
function loadImageAny(string $path){
  if (!$path) return null;
  if (preg_match('~^https?://~i',$path)) {
    $data=@file_get_contents($path); if($data===false) return null;
    return @imagecreatefromstring($data);
  }
  $real = $_SERVER['DOCUMENT_ROOT'].'/'.ltrim($path,'/');
  if (!is_file($real)) return null;
  $ext=strtolower(pathinfo($real,PATHINFO_EXTENSION));
  return match($ext){
    'jpg','jpeg' => @imagecreatefromjpeg($real),
    'png'        => @imagecreatefrompng($real),
    'gif'        => @imagecreatefromgif($real),
    default      => @imagecreatefromstring(@file_get_contents($real))
  };
}
function circleThumb($src,int $size){
  $dst=imagecreatetruecolor($size,$size);
  imagesavealpha($dst,true);
  $t=imagecolorallocatealpha($dst,0,0,0,127);
  imagefill($dst,0,0,$t);
  $w=imagesx($src); $h=imagesy($src); $side=min($w,$h);
  $sx=(int)(($w-$side)/2); $sy=(int)(($h-$side)/2);
  imagecopyresampled($dst,$src,0,0,$sx,$sy,$size,$size,$side,$side);
  // Maske
  $mask=imagecreatetruecolor($size,$size);
  imagesavealpha($mask,true);
  $clear=imagecolorallocatealpha($mask,0,0,0,127);
  $solid=imagecolorallocatealpha($mask,0,0,0,0);
  imagefill($mask,0,0,$clear);
  imagefilledellipse($mask,$size/2,$size/2,$size,$size,$solid);
  for($x=0;$x"
api/gamercard.php,110,text,,gamercard_24_rgba_imagecolorat_dst_x_y_a2_rgba_0fab87e0,">24;
      $rgba=imagecolorat($dst,$x,$y);
      $a2=($rgba&0x7F000000)>>24;
      $newA=max($a,$a2);
      imagesetpixel($dst,$x,$y,($rgba&0x00FFFFFF)|($newA"
api/gamercard.php,169,text,,gamercard_0_w_b6c15fbd,"0 && $w"
api/privacy/export.php,30,text,,export_setattribute_pdo_attr_default_fetch_mode_pdo_fetch_assoc_5b6fdd26,"setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);

// === Debug & Rate-Limit ===
$DEBUG = isset($_GET['debug']);
if (session_status() !== PHP_SESSION_ACTIVE) { session_start(); }
$key = 'hh_last_export_ts_' . $userId;
if (isset($_GET['reset'])) { unset($_SESSION[$key]); }
$COOLDOWN = 15; // Sekunden
$now = time();
if (!$DEBUG && !empty($_SESSION[$key]) && ($now - (int)$_SESSION[$key])"
api/global_chat/history.php,8,text,,history_exec_create_table_if_not_exists_global_chat_messages_bd945c0e,"exec(""
    CREATE TABLE IF NOT EXISTS global_chat_messages (
      id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
      user_id INT UNSIGNED NOT NULL DEFAULT 0,
      username VARCHAR(64) NULL,
      body TEXT NOT NULL,
      created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
      INDEX idx_created_at (created_at),
      INDEX idx_user_id (user_id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
  "");

  $since_id = isset($_GET['since_id']) ? (int)$_GET['since_id'] : 0;
  $limit    = (int)($_GET['limit'] ?? 100);
  if ($limit"
api/global_chat/cleanup.php,5,text,,cleanup_prepare_delete_from_global_chat_messages_where_created_at_8b8d7d77,"prepare(""DELETE FROM global_chat_messages WHERE created_at"
api/global_chat/send.php,10,text,,send_exec_create_table_if_not_exists_global_chat_messages_be3de136,"exec(""
    CREATE TABLE IF NOT EXISTS global_chat_messages (
      id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
      user_id INT UNSIGNED NOT NULL DEFAULT 0,
      username VARCHAR(64) NULL,
      body TEXT NOT NULL,
      created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
      INDEX idx_created_at (created_at),
      INDEX idx_user_id (user_id)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
  "");

  // Eingabe lesen
  $raw  = file_get_contents('php://input');
  $data = json_decode($raw, true);
  if (!is_array($data)) $data = $_POST ?? [];
  $body = trim((string)($data['body'] ?? ''));
  $username = trim((string)($data['username'] ?? 'Gast'));

  if ($body === '' || mb_strlen($body) > 2000) {
    http_response_code(400);
    echo json_encode(['ok'=>false,'error'=>'Empty or too long']); exit;
  }
  if ($username === '') $username = 'Gast';
  if (mb_strlen($username) > 64) $username = mb_substr($username, 0, 64);

  $userId = 0; // bis Auth repariert ist

  // Alte Nachrichten l√∂schen (>24h)
  $db->exec(""DELETE FROM global_chat_messages WHERE created_at"
admin_user_moderate.php,85,text,,admin_user_moderate_zuruck_zur_nutzerliste_a41f8310,"¬´ Zur√ºck zur Nutzerliste"
admin_user_moderate.php,92,text,,admin_user_moderate_aktueller_status_a257a5bf,"Aktueller Status"
admin_user_moderate.php,93,text,,admin_user_moderate_username_c6ed50b8,Username:
admin_user_moderate.php,94,text,,admin_user_moderate_verwarnungen_176c03df,Verwarnungen:
admin_user_moderate.php,96,text,,admin_user_moderate_stummgeschaltet_bis_c5c675da,"Stummgeschaltet bis:"
admin_user_moderate.php,100,text,,admin_user_moderate_grund_2ebaa050,Grund:
admin_user_moderate.php,102,text,,admin_user_moderate_account_ist_aktiv_b1705acb,"Account ist aktiv."
admin_user_moderate.php,108,text,,admin_user_moderate_aktionen_cc0e813b,Aktionen
admin_user_moderate.php,112,text,,admin_user_moderate_verwarnung_erteilen_85555d29,"Verwarnung erteilen"
admin_user_moderate.php,114,text,,admin_user_moderate_begrundung_min_10_zeichen_6e03f979,"Begr√ºndung (min. 10 Zeichen)"
admin_user_moderate.php,114,text,,admin_user_moderate_i18n_mask_textarea_1_8b750367,%%I18N_MASK_TEXTAREA_1%%
admin_user_moderate.php,117,text,,admin_user_moderate_verwarnen_68dd06f4,Verwarnen
admin_user_moderate.php,124,text,,admin_user_moderate_nutzer_manuell_stummschalten_1fa0ee0a,"Nutzer manuell stummschalten"
admin_user_moderate.php,126,text,,admin_user_moderate_begrundung_optional_db27814e,"Begr√ºndung (optional)"
admin_user_moderate.php,126,text,,admin_user_moderate_i18n_mask_textarea_2_c9dcdb73,%%I18N_MASK_TEXTAREA_2%%
admin_user_moderate.php,130,text,,admin_user_moderate_dauer_9adb514e,Dauer
admin_user_moderate.php,132,text,,admin_user_moderate_1_stunde_5f3528b4,"1 Stunde"
admin_user_moderate.php,133,text,,admin_user_moderate_12_stunden_8661f824,"12 Stunden"
admin_user_moderate.php,134,text,,admin_user_moderate_1_tag_a0c4fd58,"1 Tag"
admin_user_moderate.php,135,text,,admin_user_moderate_7_tage_2271f6a3,"7 Tage"
admin_user_moderate.php,136,text,,admin_user_moderate_1_monat_f0f323b2,"1 Monat"
admin_user_moderate.php,137,text,,admin_user_moderate_permanent_9d7bac7f,Permanent
admin_user_moderate.php,140,text,,admin_user_moderate_stummschalten_3379b154,Stummschalten
admin_user_moderate.php,146,text,,admin_user_moderate_sonstige_aktionen_bd7fe238,"Sonstige Aktionen"
admin_user_moderate.php,149,text,,admin_user_moderate_stummschaltung_aufheben_0fb7bd79,">Stummschaltung aufheben"
admin_user_moderate.php,152,text,,admin_user_moderate_verwarnungen_zurucksetzen_c2a6dac5,"Verwarnungen zur√ºcksetzen"
admin_user_moderate.php,157,text,,admin_user_moderate_verlauf_3dc0028b,Verlauf
admin_user_moderate.php,158,text,,admin_user_moderate_verwarnungen_66fabe11,Verwarnungen
admin_user_moderate.php,161,text,,admin_user_moderate_keine_verwarnungen_vorhanden_2ca24ab9,"Keine Verwarnungen vorhanden."
admin_user_moderate.php,164,text,,admin_user_moderate_von_d37caa22,von
admin_user_moderate.php,170,text,,admin_user_moderate_stummschaltungen_fa409fd1,Stummschaltungen
admin_user_moderate.php,173,text,,admin_user_moderate_keine_stummschaltungen_vorhanden_4da0fed1,"Keine Stummschaltungen vorhanden."
admin_user_moderate.php,178,text,,admin_user_moderate_endet_78ddbcab,Endet:
admin_user_moderate.php,179,text,,admin_user_moderate_grund_2ebaa050,Grund:
admin_user_moderate.php,180,text,,admin_user_moderate_von_e8567dd4,Von:
admin_user_moderate.php,78,attr,title,admin_user_moderate_title_moderation_fur_1a2ffa7f,"Moderation f√ºr"
admin_user_moderate.php,117,attr,value,admin_user_moderate_value_warn_9f2e3814,warn
admin_user_moderate.php,132,attr,value,admin_user_moderate_value_1_hour_ce7e09e6,"1 HOUR"
admin_user_moderate.php,133,attr,value,admin_user_moderate_value_12_hour_99806a50,"12 HOUR"
admin_user_moderate.php,134,attr,value,admin_user_moderate_value_1_day_ddf4c9c6,"1 DAY"
admin_user_moderate.php,135,attr,value,admin_user_moderate_value_7_day_c3f8b9a1,"7 DAY"
admin_user_moderate.php,136,attr,value,admin_user_moderate_value_1_month_6d6257f5,"1 MONTH"
admin_user_moderate.php,137,attr,value,admin_user_moderate_value_permanent_43363f17,PERMANENT
admin_user_moderate.php,140,attr,value,admin_user_moderate_value_mute_0ac4973d,mute
admin_user_moderate.php,149,attr,value,admin_user_moderate_value_unmute_bd63a5af,unmute
admin_user_moderate.php,152,attr,value,admin_user_moderate_value_clear_warnings_96269c4e,clear_warnings
tournaments/index.php,35,text,,index_turniere_d6f94bd4,Turniere
tournaments/index.php,40,text,,index_plattform_49f5e52a,Plattform:
tournaments/index.php,41,text,,index_teamgrosse_b8f3926c,"¬∑ Teamgr√∂√üe:"
tournaments/index.php,41,text,,index_modus_66cf3806,"¬∑ Modus:"
tournaments/index.php,45,text,,index_status_c692aa18,Status:
tournaments/index.php,47,text,,index_details_0d78f4c1,""">Details"
tournaments/view.php,21,text,,view_prepare_select_id_name_description_status_format_team_53ed1778,"prepare('SELECT id, name, description, status, format, team_size, platform, rules_text, prizes_text, best_runs, starts_at, ends_at, scoring_json, titelbild FROM tournaments WHERE id=? LIMIT 1');
$st->execute([$id]);
$t = $st->fetch(PDO::FETCH_ASSOC);
if (!$t) { http_response_code(404); echo 'Tournament not found'; exit; }

// Scoring (nur Anzeige)
$scoring = [];
if (!empty($t['scoring_json'])) {
  $tmp = json_decode((string)$t['scoring_json'], true);
  if (is_array($tmp)) $scoring = $tmp;
}

// ------------------------------------------------------
// Robust: Spalten-Infos
// ------------------------------------------------------
$ttCols = [];
foreach ($pdo->query('SHOW COLUMNS FROM tournament_teams', PDO::FETCH_ASSOC) as $row) {
  $ttCols[$row['Field']] = true;
}
$trCols = [];
foreach ($pdo->query('SHOW COLUMNS FROM tournament_runs', PDO::FETCH_ASSOC) as $row) {
  $trCols[$row['Field']] = true;
}

// Sichere ORDER-BY-Spalte f√ºr Teams
if (!empty($ttCols['created_at']))      { $orderBy = 'tt.created_at ASC'; }
elseif (!empty($ttCols['id']))          { $orderBy = 'tt.id ASC'; }
elseif (!empty($ttCols['name']))        { $orderBy = 'tt.name ASC'; }
else                                     { $orderBy = '1'; }

// Punkte-/Screenshot-Felder ermitteln
$pointsExpr = !empty($trCols['raw_points'])   ? 'r.raw_points'
            : (!empty($trCols['points_total'])? 'r.points_total'
            : (!empty($trCols['points'])      ? 'r.points'       : 'r.raw_points'));

$shotExpr   = !empty($trCols['screenshot_rel'])  ? 'r.screenshot_rel'
            : (!empty($trCols['screenshot_path'])? 'r.screenshot_path'
            : (!empty($trCols['screenshot'])     ? 'r.screenshot'      : 'NULL'));

// ------------------------------------------------------
// Leaderboard: Best-of-N freigegebene Runs pro Team
// ------------------------------------------------------
$bestN = max(1, (int)($t['best_runs'] ?? 3));

$stL = $pdo->prepare(""\n  SELECT\n    r.id,\n    r.tournament_team_id,\n    $pointsExpr AS pts,\n    $shotExpr   AS shot,\n    r.created_at,\n    tt.name     AS team_name\n  FROM tournament_runs r\n  JOIN tournament_teams tt ON tt.id = r.tournament_team_id\n  WHERE r.tournament_id = ? AND r.status = 'approved'\n  ORDER BY r.tournament_team_id ASC, pts DESC, r.created_at ASC\n"");
$stL->execute([$id]);
$rows = $stL->fetchAll(PDO::FETCH_ASSOC);

// Gruppieren & Best-of-N summieren
$teams = [];
foreach ($rows as $r) {
  $k = (int)$r['tournament_team_id'];
  if (!isset($teams[$k])) $teams[$k] = ['team_id'=>$k, 'team_name'=>$r['team_name'], 'runs'=>[]];
  $teams[$k]['runs'][] = $r;
}

$board = [];
foreach ($teams as $trow) {
  $best = array_slice($trow['runs'], 0, $bestN);
  $total = 0; $bestSingle = 0; $bestRuns = [];
  foreach ($best as $b) {
    $p = (int)$b['pts'];
    $total += $p;
    if ($p > $bestSingle) $bestSingle = $p;
    $bestRuns[] = ['id'=>(int)$b['id'], 'p'=>$p, 'shot'=>$b['shot'] ?: ''];
  }
  $board[] = [
    'team_id'     => $trow['team_id'],
    'team_name'   => $trow['team_name'],
    'total'       => $total,
    'best_single' => $bestSingle,
    'runs'        => $bestRuns,
    'count'       => count($bestRuns),
  ];
}

// Sortierung: Total desc, beste Einzelrunde desc, Name
usort($board, function($a,$b){
  if ($b['total'] !== $a['total']) return $b['total']"
tournaments/view.php,99,text,,view_a_total_if_b_best_single_a_best_single_cf08632e,"$a['total'];
  if ($b['best_single'] !== $a['best_single']) return $b['best_single']"
tournaments/view.php,100,text,,view_a_best_single_return_strnatcasecmp_a_team_name_7799bede,"$a['best_single'];
  return strnatcasecmp($a['team_name'], $b['team_name']);
});

// ------------------------------------------------------
// Teams (mit Captain)
// ------------------------------------------------------
$sqlTeams = ""SELECT tt.*, u.display_name AS captain_name\n             FROM tournament_teams tt\n             JOIN users u ON u.id = tt.captain_user_id\n             WHERE tt.tournament_id = ?\n             ORDER BY $orderBy"";
$stT = $pdo->prepare($sqlTeams);
$stT->execute([$id]);
$teamsList = $stT->fetchAll(PDO::FETCH_ASSOC);

// ------------------------------------------------------
// Helpers: Safe HTML + Safe partial include
// ------------------------------------------------------
function safe_html(string $html): string {
  $html = preg_replace('#%%I18N_MASK_SCRIPT_0%%#is', '', $html);
  $html = preg_replace('#\\son\\w+\\s*=\\s*([\'\"]) .*? \\1#ix', '', $html);
  $allowed = '"
tournaments/view.php,118,text,,view_html_strip_tags_html_allowed_html_preg_r_5b59cd6c,"';
  $html = strip_tags($html, $allowed);
  $html = preg_replace_callback('#"
tournaments/view.php,120,text,,view_href_1_ix_function_m_hre_4700ef45,"]*href=([\'\"]) (.*?) \\1[^>]*>#ix', function($m){
    $href = htmlspecialchars($m[2], ENT_QUOTES);
    return '"
tournaments/view.php,122,text,,view_html_return_html_i18n_helper_if_9eba6d52,"';
  }, $html);
  return $html;
}

// i18n Helper
if (!function_exists('t')) {
  function t(string $key, string $fallback=''): string {
    $L = $GLOBALS['L'] ?? [];
    return htmlspecialchars((string)($L[$key] ?? $fallback), ENT_QUOTES, 'UTF-8');
  }
}

// --- Pfade sauber aufl√∂sen ---------------------------------------------------
$CANDIDATE_DIRS = [
  __DIR__ . '/partials/tournament',
  dirname(__DIR__) . '/partials/tournament',
  __DIR__ . '/partials',
  dirname(__DIR__) . '/partials',
];

$PARTIALS_DIR = null;
foreach ($CANDIDATE_DIRS as $d) {
  if (is_dir($d)) { $PARTIALS_DIR = realpath($d) ?: $d; break; }
}
if (!$PARTIALS_DIR) { $PARTIALS_DIR = __DIR__; }

// --- Mapping f√ºr erlaubte Partials ------------------------------------------
$TAB_MAP = [
  'overview'     => 'overview.php',
  'prizes'       => 'prizes.php',
  'participants' => 'participants.php',
  'matches'      => 'matches.php',
  'brackets'     => 'brackets.php',
  'rules'        => 'rules.php',
  'leaderboard'  => 'leaderboard.php',
];

// --- Tabs + Active bestimmen -------------------------------------------------
$tabs = [
  ['key' => 'overview',     'label' => t('tab_overview','Overview')],
  ['key' => 'participants', 'label' => t('tab_leaderboard','Leaderboard')],
  ['key' => 'matches',      'label' => t('tab_winner','Winner')],
];
$active = $_GET['tab'] ?? 'overview';
if (!isset($TAB_MAP[$active])) { $active = 'overview'; }

// --- Sichere Include-Funktion ------------------------------------------------
function render_partial(string $key, array $vars = []): void {
  global $PARTIALS_DIR, $TAB_MAP;
  $fileName = $TAB_MAP[$key] ?? 'overview.php';
  $path = rtrim($PARTIALS_DIR, '/\\') . DIRECTORY_SEPARATOR . basename($fileName);
  if (!is_file($path)) { echo '"
tournaments/view.php,174,text,,view_partial_nicht_gefunden_fe201999,"Partial nicht gefunden."
tournaments/view.php,197,text,,view_class_breadcrumb_link_home_d3e0776f,"/"" class=""breadcrumb-link"">Home"
tournaments/view.php,231,text,,view_class_btn_btn_md_btn_primary_rounded_12_mb_16p_3f92d2f4,""" class=""btn btn-md btn-primary rounded-12 mb-16p"">"
tournaments/view.php,237,text,,view_1_bf649054,1
tournaments/view.php,239,text,,view_3_0d25ca40,3
tournaments/view.php,241,text,,view_5_2ceff585,5
tournaments/view.php,243,text,,view_5_68e0ac7b,-5
tournaments/view.php,258,text,,view_class_10835097,"""  class="""
tournaments/view.php,300,text,,view_organized_by_7880c276,"Organized by"
tournaments/view.php,301,text,,view_hunthub_d735f892,HuntHub
tournaments/view.php,315,text,,view_hinweis_0179f6ac,Hinweis
tournaments/view.php,317,text,,view_stelle_sicher_dass_dein_screenshot_die_post_match_ubersicht_8ea908c5,"Stelle sicher, dass dein Screenshot die Post-Match-√úbersicht mit Punkten eindeutig zeigt."
tournaments/view.php,322,text,,view_regeln_cf8ec640,Regeln
tournaments/view.php,324,text,,view_betrug_fuhrt_zur_disqualifizierung_uploads_werden_manuell_g_a38801fd,"Betrug f√ºhrt zur Disqualifizierung. Uploads werden manuell gepr√ºft."
tournaments/play.php,40,text,,play_i18n_mask_style_2_237d559e,""">
%%I18N_MASK_STYLE_2%%"
tournaments/play.php,50,text,,play_mitmachen_ff05682d,"Mitmachen ¬∑"
tournaments/play.php,52,text,,play_class_breadcrumb_link_start_dc457084,"/"" class=""breadcrumb-link"">Start"
tournaments/play.php,54,text,,play_tournaments_view_php_id_0997c692,/tournaments/view.php?id=
tournaments/play.php,54,text,,play_class_breadcrumb_link_turnier_e73cc55a,""" class=""breadcrumb-link"">Turnier"
tournaments/play.php,55,text,,play_mitmachen_8f6a862f,Mitmachen
tournaments/play.php,77,text,,play_gewinn_cb1978c2,Gewinn
tournaments/play.php,81,text,,play_plattform_bc1da687,Plattform
tournaments/play.php,88,text,,play_tournaments_view_php_id_0997c692,/tournaments/view.php?id=
tournaments/play.php,88,text,,play_class_btn_btn_md_btn_primary_rounded_12_mb_16p_zuruck_zu_f18644c7,""" class=""btn btn-md btn-primary rounded-12 mb-16p"">Zur√ºck zum Turnier"
tournaments/play.php,91,text,,play_1_40474f25,1
tournaments/play.php,91,text,,play_kills_ee7b855f,Kills
tournaments/play.php,93,text,,play_3_61cc65cc,3
tournaments/play.php,93,text,,play_boss_c22334e1,Boss
tournaments/play.php,95,text,,play_5_c3dc7b6e,5
tournaments/play.php,95,text,,play_bounty_382b3bf7,Bounty
tournaments/play.php,97,text,,play_5_29e991ff,-5
tournaments/play.php,97,text,,play_tode_cd948f41,Tode
tournaments/play.php,100,text,,play_punktevergabe_76e14efe,Punktevergabe
tournaments/play.php,123,text,,play_team_68eb19e9,Team
tournaments/play.php,124,text,,play_teamgrosse_2a1232cd,Teamgr√∂√üe:
tournaments/play.php,126,text,,play_lade_1952b5f9,"Lade ‚Ä¶"
tournaments/play.php,131,text,,play_neues_team_anlegen_7f3872e2,"Neues Team anlegen"
tournaments/play.php,134,text,,play_team_erstellen_3f50bc45,"Team erstellen"
tournaments/play.php,139,text,,play_team_beitreten_join_code_d6d6c287,"Team beitreten (Join-Code)"
tournaments/play.php,142,text,,play_beitreten_58e88f5a,Beitreten
tournaments/play.php,149,text,,play_ergebnis_upload_4ff1ca94,Ergebnis-Upload
tournaments/play.php,150,text,,play_du_musst_in_einem_team_sein_um_hochzuladen_38924bba,"Du musst in einem Team sein, um hochzuladen."
tournaments/play.php,155,text,,play_kills_ee7b855f,Kills
tournaments/play.php,159,text,,play_boss_kills_f5cdbffa,Boss-Kills
tournaments/play.php,163,text,,play_bounty_extrahiert_b063a68e,"Bounty extrahiert"
tournaments/play.php,170,text,,play_gauntlet_0_1_c93b0d95,"Gauntlet (0/1)"
tournaments/play.php,171,text,,play_0_f44ed040,0
tournaments/play.php,171,text,,play_1_40474f25,1
tournaments/play.php,174,text,,play_tode_im_team_3a19edb3,"Tode im Team"
tournaments/play.php,177,text,,play_i18n_mask_style_3_fd21dd0d,%%I18N_MASK_STYLE_3%%
tournaments/play.php,183,text,,play_screenshot_post_match_b7b30686,"Screenshot (Post-Match)"
tournaments/play.php,194,text,,play_screenshot_auswahlen_024140a5,"Screenshot ausw√§hlen"
tournaments/play.php,201,text,,play_kein_bild_ausgewahlt_c47c0a4d,"Kein Bild ausgew√§hlt"
tournaments/play.php,202,text,,play_zurucksetzen_089ba766,Zur√ºcksetzen
tournaments/play.php,209,text,,play_i18n_mask_script_0_f7e17e4e,%%I18N_MASK_SCRIPT_0%%
tournaments/play.php,213,text,,play_upload_senden_d43d9cfb,"Upload senden"
tournaments/play.php,221,text,,play_meine_uploads_c04be6c0,"Meine Uploads"
tournaments/play.php,226,text,,play_zeit_61f613f5,Zeit
tournaments/play.php,227,text,,play_punkte_caca446d,Punkte
tournaments/play.php,228,text,,play_status_a045876e,Status
tournaments/play.php,229,text,,play_screenshot_33e14594,Screenshot
tournaments/play.php,245,text,,play_hinweis_a58a096c,Hinweis
tournaments/play.php,247,text,,play_stelle_sicher_dass_dein_screenshot_die_post_match_ubersicht_0698e4fb,"Stelle sicher, dass dein Screenshot die Post-Match-√úbersicht mit Punkten eindeutig zeigt."
tournaments/play.php,252,text,,play_regeln_6ea1588d,Regeln
tournaments/play.php,254,text,,play_betrug_fuhrt_zur_disqualifizierung_uploads_werden_manuell_g_86d4bfa5,"Betrug f√ºhrt zur Disqualifizierung. Uploads werden manuell gepr√ºft."
tournaments/play.php,265,text,,play_i18n_mask_script_1_28a2f361,%%I18N_MASK_SCRIPT_1%%
tournaments/play.php,132,attr,placeholder,play_placeholder_teamname_1f27d219,Teamname
tournaments/play.php,140,attr,placeholder,play_placeholder_z_b_7ghd3k_f932b667,"z.‚ÄØB. 7GHD3K"
tournaments/play.php,156,attr,value,play_value_0_2110921a,0
tournaments/play.php,160,attr,value,play_value_0_2110921a,0
tournaments/play.php,164,attr,value,play_value_0_2110921a,0
tournaments/play.php,171,attr,value,play_value_0_2110921a,0
tournaments/play.php,171,attr,value,play_value_1_4133c072,1
tournaments/play.php,175,attr,value,play_value_0_2110921a,0
gamification/overview.php,204,text,,overview_i18n_mask_style_0_210df2e1,%%I18N_MASK_STYLE_0%%
tools/i18n/scan_echoes.php,6,text,,scan_echoes_und_erstellt_vorschlage_fur_i18n_keys_erganzt_fehlende_3b8dd175,"und
 * erstellt Vorschl√§ge f√ºr i18n-Keys + erg√§nzt fehlende Keys in lang/*.php.
 *
 * Aufruf:
 *   php tools/i18n/scan_echoes.php --root=. --langs=de,en --langdir=lang
 */

$opts = getopt('', ['root::','langs::','langdir::']);
$ROOT    = rtrim($opts['root'] ?? '.', '/');
$LANGS   = array_filter(array_map('trim', explode(',', $opts['langs'] ?? 'de,en')));
$LANGDIR = rtrim($opts['langdir'] ?? 'lang', '/');

if (!is_dir($ROOT)) { fwrite(STDERR, ""Root not found: $ROOT\n""); exit(1); }
if (!is_dir(""$ROOT/$LANGDIR"")) { fwrite(STDERR, ""Lang dir not found: $ROOT/$LANGDIR\n""); exit(1); }

function slugify(string $s): string {
    $s = trim($s);
    $s = preg_replace('~[^\pL\d]+~u', '_', $s);
    $s = iconv('UTF-8','ASCII//TRANSLIT//IGNORE',$s);
    $s = preg_replace('~[^-\w]+~', '', $s);
    $s = trim($s, '_');
    $s = preg_replace('~_+~', '_', $s);
    $s = strtolower($s);
    if ($s === '') $s = 'text';
    return $s;
}
function loadLang(string $file): array {
    if (!file_exists($file)) return [];
    $L = require $file;
    return is_array($L) ? $L : [];
}
function saveLang(string $file, array $L): void {
    ksort($L, SORT_NATURAL);
    $code = """
tools/i18n/scan_echoes.php,43,text,,scan_echoes_text_file_line_count_n_25ec1e83,"[ 'text'=>..., 'file'=>..., 'line'=>..., 'count'=>n ] ]

$rii = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT, FilesystemIterator::SKIP_DOTS));
foreach ($rii as $spl) {
    /** @var SplFileInfo $spl */
    $path = $spl->getPathname();
    if ($spl->isDir()) continue;
    $rel = ltrim(str_replace($ROOT, '', $path), '/');

    // Skip-Verzeichnisse
    if (preg_match('~^(uploads|public/uploads|vendor|node_modules|assets|.git|.idea|lang)\/~', $rel)) continue;
    if (!preg_match('~\.php$~i', $rel)) continue;

    $code = file_get_contents($path);
    if ($code === false) continue;

    $tokens = token_get_all($code);
    $n = count($tokens);
    for ($i = 0; $i"
tools/i18n/scan_html_grep.php,56,text,,scan_html_grep_nein_t2_preg_replace_s_u_t_return_mb_2599dda4,"nein
  $t2 = preg_replace('~\s+~u', ' ', $t);
  return mb_strlen($t2) >= $minlen;
}
function getLineForPos(string $txt, int $pos): int {
  return 1 + substr_count(substr($txt, 0, max(0,$pos)), ""\n"");
}
function contextAround(string $txt, int $pos, int $len, int $ctx=35): string {
  $start = max(0, $pos - $ctx);
  $end   = min(strlen($txt), $pos + $len + $ctx);
  $pre   = substr($txt, $start, $pos - $start);
  $hit   = substr($txt, $pos, $len);
  $post  = substr($txt, $pos + $len, $end - ($pos + $len));
  return $pre.'‚ü™'.$hit.'‚ü´'.$post;
}

$EXT_RX = '~\.(php|phtml|html|htm|tpl)$~i';
$SKIP   = '~^(uploads|public/uploads|vendor|node_modules|assets|\.git|\.idea|cache|logs|lang)/~i';

$suggestions = [];
$totalTxt = 0; $totalAttr = 0;

$rii = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT, FilesystemIterator::SKIP_DOTS));
foreach ($rii as $spl) {
  /** @var SplFileInfo $spl */
  if ($spl->isDir()) continue;
  $path = $spl->getPathname();
  $rel  = ltrim(str_replace($ROOT, '', $path), '/');

  if (!preg_match($EXT_RX, $rel)) continue;
  if (preg_match($SKIP, $rel))    continue;

  $src = file_get_contents($path);
  if ($src === false || $src === '') continue;

  $perFileTxt = 0; $perFileAttr = 0;

  // 1) Text zwischen >..."
tools/i18n/apply_echoes.php,22,text,,apply_echoes_text_key_byfile_foreach_suggestions_as_9caa910b,"[ [text,key], ...]
$byFile = [];
foreach ($suggestions as $key => $it) {
    $byFile[$it['file']][] = ['text'=>$it['text'], 'key'=>$key];
}

$totalChanges = 0;
foreach ($byFile as $rel => $items) {
    $path = ""$ROOT/$rel"";
    if (!is_file($path)) continue;
    $code = file_get_contents($path);
    if ($code === false) continue;

    $tokens = token_get_all($code);
    $n = count($tokens);
    $changed = false;

    // F√ºr schnelleren Lookup: Strings -> key
    $textToKey = [];
    foreach ($items as $row) $textToKey[$row['text']] = $row['key'];

    $out = '';
    for ($i=0; $i"
tools/i18n/scan_report.php,9,text,,scan_report_schreibt_i18n_report_json_i18n_report_csv_auf_497f14e4,"*  - schreibt i18n_report.json + i18n_report.csv
 *
 * Aufruf: php tools/i18n/scan_report.php
 */

$ROOT = getcwd();
$ATTRS = ['title','placeholder','alt','aria-label','value'];
$IGNORE_TAGS = ['script','style','template','textarea'];
$EXT_RX = '~\.(php|phtml|html|htm|tpl)$~i';
$SKIP   = '~^(uploads|public/uploads|vendor|node_modules|assets|\.git|\.idea|cache|logs|lang)/~i';

function slugify(string $s): string {
  $s = trim($s);
  $s = preg_replace('~\s+~u', ' ', $s);
  $s = preg_replace('~[^\pL\d]+~u', '_', $s);
  $s = iconv('UTF-8','ASCII//TRANSLIT//IGNORE',$s);
  $s = preg_replace('~[^-\w]+~', '', $s);
  $s = trim($s, '_');
  $s = preg_replace('~_+~', '_', $s);
  $s = strtolower($s);
  return $s === '' ? 'text' : $s;
}
function maskBlocks(string $html, array $tags): array {
  $map = [];
  foreach ($tags as $tag) {
    $rx = '~"
tools/i18n/scan_report.php,35,text,,scan_report_is_html_preg_replace_callback_rx_function_m_u_d32138a7,"~is';
    $html = preg_replace_callback($rx, function($m) use (&$map, $tag) {
      $id = '%%I18N_MASK_'.strtoupper($tag).'_'.count($map).'%%';
      $map[$id] = $m[0];
      return $id;
    }, $html);
  }
  return [$html, $map];
}
function restoreMasks(string $html, array $map): string { return $map ? strtr($html,$map) : $html; }
function getLine(string $src, int $pos): int { return 1 + substr_count(substr($src, 0, $pos), ""\n""); }

$it = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT, FilesystemIterator::SKIP_DOTS));
$suggestions = []; // array of rows
$totalText = 0; $totalAttr = 0;

foreach ($it as $f) {
  if ($f->isDir()) continue;
  $path = $f->getPathname();
  $rel  = ltrim(str_replace($ROOT.'/', '', $path), '/');
  if (!preg_match($EXT_RX, $rel)) continue;
  if (preg_match($SKIP, $rel))    continue;

  $src = @file_get_contents($path);
  if ($src === false || $src === '') continue;

  list($masked, $map) = maskBlocks($src, $IGNORE_TAGS);

  // Textknoten >..."
tools/i18n/quick_find_html.php,21,text,,quick_find_html_isdir_continue_path_spl_getpathname_rel_4883ec1a,"isDir()) continue;
  $path = $spl->getPathname();
  $rel  = ltrim(str_replace($ROOT.'/', '', $path), '/');
  if (!preg_match($rxExt, $rel)) continue;
  if (preg_match($rxSkip, $rel)) continue;

  $s = @file_get_contents($path);
  if ($s === false || $s === '') continue;

  // -------- Textknoten: > ..."
tools/i18n/quick_find_html.php,34,text,,quick_find_html_skip_if_str_contains_txt_aecd0c9a,"skip
      if (str_contains($txt, '"
tools/i18n/wrap_file_safe.php,7,text,,wrap_file_safe_t_key_html_textknoten_ui_attribute_4e1ee14a,") -> t('key')
 * - HTML-Textknoten & UI-Attribute                 ->"
tools/i18n/wrap_file_safe.php,8,text,,wrap_file_safe_ignoriert_bereiche_in_dc940be3,"* - Ignoriert Bereiche in"
tools/i18n/wrap_file_safe.php,9,text,,wrap_file_safe_legt_bak_backup_an_und_erganzt_lang_de_php_original_1b5c20e6,"* - Legt .bak-Backup an und erg√§nzt lang/de.php (Original) & lang/en.php (leer)
 *
 * Aufruf:
 *   php tools/i18n/wrap_file_safe.php \
 *     --file=theme/login.php \
 *     --langdir=lang --langs=de,en \
 *     --ignoretags=script,style,template,textarea
 */

$opts = getopt('', ['file:', 'langdir::', 'langs::', 'ignoretags::']);
$FILE        = $opts['file'] ?? '';
$LANGDIR     = rtrim($opts['langdir'] ?? 'lang', '/');
$LANGS       = array_filter(array_map('trim', explode(',', $opts['langs'] ?? 'de,en')));
$IGNORE_TAGS = array_filter(array_map('trim', explode(',', $opts['ignoretags'] ?? 'script,style,template,textarea')));

if ($FILE === '' || !is_file($FILE)) { fwrite(STDERR, ""Datei nicht gefunden: {$FILE}\n""); exit(1); }
if (!is_dir($LANGDIR)) { fwrite(STDERR, ""Sprachordner nicht gefunden: {$LANGDIR}\n""); exit(1); }

function slugify(string $s): string {
  $s = trim($s);
  $s = preg_replace('~\s+~u', ' ', $s);
  $s = preg_replace('~[^\pL\d]+~u', '_', $s);
  $s = iconv('UTF-8','ASCII//TRANSLIT//IGNORE',$s);
  $s = preg_replace('~[^-\w]+~', '', $s);
  $s = trim($s, '_');
  $s = preg_replace('~_+~', '_', $s);
  $s = strtolower($s);
  return $s === '' ? 'text' : $s;
}
function loadLang(string $file): array {
  if (!file_exists($file)) return [];
  $L = require $file;
  return is_array($L) ? $L : [];
}
function saveLang(string $file, array $L): void {
  ksort($L, SORT_NATURAL);
  $code = """
tools/i18n/wrap_file_safe.php,53,text,,wrap_file_safe_is_html_preg_replace_callback_rx_function_m_u_b4d9e5c9,"~is';
    $html = preg_replace_callback($rx, function($m) use (&$map, $tag) {
      $id = '%%I18N_MASK_'.strtoupper($tag).'_'.count($map).'%%';
      $map[$id] = $m[0];
      return $id;
    }, $html);
  }
  return [$html, $map];
}
function restoreMasks(string $html, array $map): string {
  return $map ? strtr($html, $map) : $html;
}
function decStr(string $raw): string {
  // $raw ist komplettes Literal inkl. Quotes
  $q = $raw[0];
  $s = substr($raw, 1, -1);
  return stripcslashes($s);
}

$base = pathinfo($FILE, PATHINFO_FILENAME);
$orig = file_get_contents($FILE);
if ($orig === false) { fwrite(STDERR, ""Lesefehler.\n""); exit(1); }

$suggestions = [];  // key => text
$changed = false;

/* =========================================================
 * TEIL 1: PHP tokenisieren ‚Äì String-Literale bei Zuweisung
 * ========================================================= */
$tokens = token_get_all($orig);
$out    = '';
$inPhp  = false;

for ($i=0,$n=count($tokens); $i"
tools/i18n/wrap_file_safe.php,98,text,,wrap_file_safe_j_i_1_prev_while_j_0_dc12e6ce,"'
        $j=$i-1; $prev='';
        while ($j>=0) {
          $pt = $tokens[$j];
          if (is_array($pt) && $pt[0] === T_WHITESPACE) { $j--; continue; }
          $prev = is_array($pt) ? $pt[1] : $pt; break;
        }
        $isAssign = ($prev === '=' || $prev === '=>');

        if ($isAssign) {
          $val = decStr($text);
          // schon i18nisiert?
          if (!preg_match(""~^(?:\\s*t\\(|\\s*\\\$L\\[)~"", $val) && preg_match('~[\\p{L}\\d]~u', $val)) {
            // kein HTML/JS-M√ºll
            if (!preg_match('~"
tools/i18n/wrap_file_safe.php,112,text,,wrap_file_safe_val_trim_preg_replace_s_u_f354f22f,"~', $val)) {
              $trim = preg_replace('~\\s+~u',' ', trim(html_entity_decode($val, ENT_QUOTES|ENT_HTML5, 'UTF-8')));
              if ($trim !== '') {
                $key = ""{$base}_"" . slugify(mb_substr($trim, 0, 60)) . '_' . substr(sha1($FILE.'|php|string|'.$trim), 0, 8);
                $suggestions[$key] = $trim;
                $out .= ""t('"".$key.""')"";
                $changed = true;
                continue;
              }
            }
          }
        }
      }
      // Standard: √ºbernehmen
      $out .= $text;
      continue;
    }

    // HTML-Kontext
    $out .= $text;

  } else {
    // einfache Zeichen
    $out .= $tk;
  }
}

/* =========================================================
 * TEIL 2: HTML ‚Äì Textknoten & UI-Attribute
 *  - maskiert"
tools/i18n/wrap_file_safe.php,141,text,,wrap_file_safe_text_4a36986c,"* ========================================================= */
$html = $out;

// 2a) maskieren
list($html, $maskedMap) = maskBlocks($html, $IGNORE_TAGS);

// 2b) Textknoten ersetzen
$patternText = '~(>)([^"
tools/i18n/wrap_file_safe.php,154,text,,wrap_file_safe_return_m_0_rudimentare_js_fragmente_im_text_ube_be404ce7,"')) return $m[0];
  // rudiment√§re JS-Fragmente im Text √ºberspringen
  if (preg_match('~document\\.|addEventListener\\(|=>|\\bvar\\b|\\blet\\b|\\bconst\\b~', $raw)) return $m[0];

  $trim = preg_replace('~\\s+~u',' ', $txt);
  $key  = ""{$base}_"" . slugify(mb_substr($trim, 0, 60)) . '_' . substr(sha1($FILE.'|html|text|'.$trim), 0, 8);
  $suggestions[$key] = $trim;
  $changed = true;
  return $open.'"
tools/i18n/wrap_file_safe.php,162,text,,wrap_file_safe_close_html_2c_nur_ui_attribute_keine_ev_ce175a1e,"'.$close;
}, $html);

// 2c) nur ‚ÄûUI-Attribute‚Äú (keine Events wie onclick)
foreach (['title','placeholder','alt','aria-label','value'] as $a) {
  $rx = '~\b'.preg_quote($a,'~').'\s*=\s*(""([^""]+)""|\'([^\']+)\')~u';
  $html = preg_replace_callback($rx, function($m) use (&$suggestions,&$changed,$FILE,$base,$a){
    $val = $m[2] !== '' ? $m[2] : $m[3];
    if (preg_match('~t\\s*\\([\'""]~', $val) || preg_match('~\\$L\\[[\'""]~', $val)) return $m[0];
    if (str_contains($val,'"
tools/i18n/wrap_file_safe.php,171,text,,wrap_file_safe_return_m_0_txt_trim_html_entity_decode_val_1014376d,"')) return $m[0];

    $txt = trim(html_entity_decode($val, ENT_QUOTES|ENT_HTML5, 'UTF-8'));
    if ($txt === '' || !preg_match('~[\\p{L}\\d]~u', $txt)) return $m[0];

    $trim = preg_replace('~\\s+~u',' ', $txt);
    $key  = ""{$base}_{$a}_"" . slugify(mb_substr($trim, 0, 60)) . '_' . substr(sha1($FILE.'|html|attr|'.$a.'|'.$trim), 0, 8);
    $suggestions[$key] = $trim;
    $changed = true;
    $q = $m[2] !== '' ? '""' : ""'"";
    return $a.'='.$q.'"
tools/i18n/fix_bad_short_echo.php,6,text,,fix_bad_short_echo_macht_daraus_title_t_key_root_7d6f8be9,"';
 * -> macht daraus:     $title = t(""key"");
 */
$ROOT = getcwd();
$it = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT, FilesystemIterator::SKIP_DOTS));
$rxExt = '~\.php$~i';
$skip  = '~^(uploads|public/uploads|vendor|node_modules|assets|\.git|\.idea|cache|logs|lang)/~i';
$changed = 0;

foreach ($it as $f) {
  $rel = ltrim(str_replace($ROOT.'/', '', $f->getPathname()),'/');
  if ($f->isDir() || !preg_match($rxExt,$rel) || preg_match($skip,$rel)) continue;
  $src = @file_get_contents($f->getPathname());
  if ($src === false || $src === '') continue;


  $out = preg_replace(
    '~([\'""])\s*"
tools/i18n/fix_bad_short_echo.php,23,text,,fix_bad_short_echo_s_1_t_3_src_1_cnt1_3560f018,"\s*\1~',
    't(""$3"")',
    $src,
    -1,
    $cnt1
  );
  // Falls innen Singlequotes gew√ºnscht:
  $out = preg_replace(
    '~([\'""])\s*"
tools/i18n/scan_html.php,67,text,,scan_html_minlen_function_stripphpblocks_string_code_string_74354bed,"= $minlen;
}
function stripPhpBlocks(string $code): string {

  return preg_replace_callback('~"
tools/i18n/scan_html.php,71,text,,scan_html_is_function_m_return_str_repeat_strlen_m_0_e76b03a4,"~is', function($m){
    return str_repeat(' ', strlen($m[0]));
  }, $code);
}
function findLineAndContext(string $haystack, string $needle, int $contextLen = 40): array {
  $pos = mb_stripos($haystack, $needle);
  if ($pos === false) return [0, ''];
  $pre  = mb_substr($haystack, max(0, $pos - $contextLen), $contextLen);
  $hit  = mb_substr($haystack, $pos, mb_strlen($needle));
  $post = mb_substr($haystack, $pos + mb_strlen($needle), $contextLen);
  // Zeile bestimmen
  $prefix = mb_substr($haystack, 0, $pos);
  $line = 1 + substr_count($prefix, ""\n"");
  $ctx = $pre . '‚ü™' . $hit . '‚ü´' . $post;
  return [$line, $ctx];
}

$EXT_RX = '~\.(php|phtml|html|htm|tpl)$~i';
$SKIP   = '~^(uploads|public/uploads|vendor|node_modules|assets|\.git|\.idea|cache|logs|lang)/~i';

$suggestions = []; // key => item
$countText = 0;
$countAttr = 0;

$rii = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($ROOT, FilesystemIterator::SKIP_DOTS));
foreach ($rii as $spl) {
  /** @var SplFileInfo $spl */
  if ($spl->isDir()) continue;
  $path = $spl->getPathname();
  $rel  = ltrim(str_replace($ROOT, '', $path), '/');

  if (!preg_match($EXT_RX, $rel)) continue;
  if (preg_match($SKIP, $rel))    continue;

  $orig = file_get_contents($path);
  if ($orig === false) continue;

  $clean = $orig;
  // F√ºr PHP-Dateien HTML extrahieren
  if (preg_match('~\.php$~i', $rel)) {
    $clean = stripPhpBlocks($orig);
  }

  // DOM laden
  $html = $clean;
  if (stripos($html, '"
tools/cookie-inspector.php,29,text,,cookie-inspector_cookie_storage_inspector_b17be209,"Cookie & Storage Inspector"
tools/cookie-inspector.php,29,text,,cookie-inspector_i18n_mask_style_1_a5d14641,%%I18N_MASK_STYLE_1%%
tools/cookie-inspector.php,32,text,,cookie-inspector_cookie_storage_inspector_b17be209,"Cookie & Storage Inspector"
tools/cookie-inspector.php,35,text,,cookie-inspector_export_json_0ee7c5e6,"Export JSON"
tools/cookie-inspector.php,36,text,,cookie-inspector_tipp_fur_drittanbieter_cookies_devtools_offnen_application_b2d5af4c,"Tipp: F√ºr Drittanbieter-Cookies DevTools √∂ffnen (Application ‚Üí Cookies) und Seite mit ‚Äûincluding third-party cookies‚Äú neu laden."
tools/cookie-inspector.php,41,text,,cookie-inspector_cookies_2c4d1c7d,Cookies
tools/cookie-inspector.php,43,text,,cookie-inspector_name_dbac771d,Name
tools/cookie-inspector.php,43,text,,cookie-inspector_wert_gekurzt_9df02bbb,"Wert (gek√ºrzt)"
tools/cookie-inspector.php,43,text,,cookie-inspector_flags_erkannt_95264110,"Flags (erkannt)"
tools/cookie-inspector.php,46,text,,cookie-inspector_hinweis_3ef65d25,Hinweis:
tools/cookie-inspector.php,46,text,,cookie-inspector_httponly_7d5da6f1,HttpOnly
tools/cookie-inspector.php,46,text,,cookie-inspector_wird_erkannt_indem_wir_server_cookies_mit_69615bba,"wird erkannt, indem wir Server-Cookies mit"
tools/cookie-inspector.php,46,text,,cookie-inspector_document_cookie_1ae3eae9,document.cookie
tools/cookie-inspector.php,46,text,,cookie-inspector_vergleichen_55fc837d,vergleichen.
tools/cookie-inspector.php,46,text,,cookie-inspector_secure_72cead9e,Secure
tools/cookie-inspector.php,46,text,,cookie-inspector_samesite_1543a703,SameSite
tools/cookie-inspector.php,46,text,,cookie-inspector_path_edf6f6be,Path
tools/cookie-inspector.php,46,text,,cookie-inspector_domain_630fe8b9,Domain
tools/cookie-inspector.php,46,text,,cookie-inspector_sind_clientseitig_nicht_zuverlassig_auslesbar_dafur_devtoo_1b1bed8f,"sind clientseitig nicht zuverl√§ssig auslesbar ‚Äì daf√ºr DevTools (Response-Header"
tools/cookie-inspector.php,46,text,,cookie-inspector_set_cookie_8a326ef7,Set-Cookie
tools/cookie-inspector.php,46,text,,cookie-inspector_nutzen_744578bc,") nutzen."
tools/cookie-inspector.php,50,text,,cookie-inspector_localstorage_116bab8b,localStorage
tools/cookie-inspector.php,51,text,,cookie-inspector_key_845ee927,Key
tools/cookie-inspector.php,51,text,,cookie-inspector_value_5e276ec2,Value
tools/cookie-inspector.php,55,text,,cookie-inspector_sessionstorage_d0c0a179,sessionStorage
tools/cookie-inspector.php,56,text,,cookie-inspector_key_845ee927,Key
tools/cookie-inspector.php,56,text,,cookie-inspector_value_5e276ec2,Value
tools/cookie-inspector.php,60,text,,cookie-inspector_indexeddb_4cc00c37,IndexedDB
tools/cookie-inspector.php,61,text,,cookie-inspector_prufe_unterstutzung_e43c8894,"Pr√ºfe Unterst√ºtzung‚Ä¶"
tools/cookie-inspector.php,65,text,,cookie-inspector_cache_storage_1ac940c3,"Cache Storage"
tools/cookie-inspector.php,66,text,,cookie-inspector_prufe_caches_274bcdae,"Pr√ºfe Caches‚Ä¶"
tools/cookie-inspector.php,70,text,,cookie-inspector_rohdaten_b2aba0a7,Rohdaten
admin.php,28,text,,admin_i18n_mask_style_4_d4c36ef3,""">
%%I18N_MASK_STYLE_4%%"
admin.php,32,text,,admin_admin_1841a36a,Admin
admin.php,34,text,,admin_admin_php_view_dashboard_dashboard_491bdd61,"/admin.php?view=dashboard"">Dashboard"
admin.php,35,text,,admin_admin_php_view_users_users_5fe4711c,"/admin.php?view=users"">Users"
admin.php,36,text,,admin_admin_php_view_forum_forum_da32d811,"/admin.php?view=forum"">Forum"
admin.php,37,text,,admin_admin_php_view_tournaments_turniere_8185aed3,"/admin.php?view=tournaments"">Turniere"
admin.php,38,text,,admin_admin_php_view_uploads_uploads_cd8f93b1,"/admin.php?view=uploads"">Uploads"
admin.php,39,text,,admin_admin_php_view_cache_cache_23b4644c,"/admin.php?view=cache"">Cache"
admin.php,40,text,,admin_admin_php_view_health_health_7537ee94,"/admin.php?view=health"">Health"
admin.php,41,text,,admin_admin_php_view_notifications_notifications_8dd6715f,"/admin.php?view=notifications"">Notifications"
admin.php,42,text,,admin_admin_php_view_gamification_gamification_10a26371,"/admin.php?view=gamification"">Gamification"
admin.php,43,text,,admin_admin_php_view_messages_messages_d1d9b346,"/admin.php?view=messages"">Messages"
admin.php,44,text,,admin_storage_inspector_e7efa702,""">Storage-Inspector"
admin.php,45,text,,admin_admin_php_view_logs_logs_1c463003,"/admin.php?view=logs"">Logs"
admin.php,61,text,,admin_users_daa5787e,Users
admin.php,62,text,,admin_threads_65f43cd9,Threads
admin.php,63,text,,admin_posts_b682de8e,Posts
admin.php,64,text,,admin_messages_4d20884e,Messages
admin.php,65,text,,admin_notifications_bcfa2bba,Notifications
admin.php,66,text,,admin_link_previews_b954fc71,Link-Previews
admin.php,67,text,,admin_achievements_c124a8f0,Achievements
admin.php,68,text,,admin_user_achievements_35dece95,User-Achievements
admin.php,70,text,,admin_i18n_mask_style_5_1b71871d,%%I18N_MASK_STYLE_5%%
admin.php,74,text,,admin_storage_inspector_78bdea66,Storage-Inspector
admin.php,76,text,,admin_export_json_8d3fff92,"Export JSON"
admin.php,77,text,,admin_tipp_secure_samesite_path_siehst_du_in_devtools_network_383372c6,"Tipp: Secure/SameSite/Path siehst du in DevTools ‚Üí Network ‚Üí"
admin.php,77,text,,admin_set_cookie_d1d5ac9a,Set-Cookie
admin.php,82,text,,admin_policy_check_ampel_4a9a7d8a,"Policy-Check (Ampel)"
admin.php,84,text,,admin_scanne_seite_gleiches_origin_08b193bd,"Scanne Seite (gleiches Origin):"
admin.php,86,text,,admin_scannen_12b39a4a,Scannen
admin.php,87,text,,admin_kein_consent_notig_96c835f9,"Kein Consent n√∂tig"
admin.php,87,text,,admin_nur_notwendige_cookies_e8b05067,"‚Äì nur notwendige Cookies"
admin.php,95,text,,admin_cookies_9ac63ab1,Cookies
admin.php,96,text,,admin_name_6ac64074,Name
admin.php,96,text,,admin_wert_gekurzt_e4276e2e,"Wert (gek√ºrzt)"
admin.php,96,text,,admin_kategorie_7dd189b0,Kategorie
admin.php,97,text,,admin_httponly_wird_indirekt_erkannt_server_hat_s_js_nicht_kat_d68c7f5e,"HttpOnly wird indirekt erkannt (Server hat‚Äôs, JS nicht). Kategorien sind Heuristik."
admin.php,101,text,,admin_localstorage_8cab39d7,localStorage
admin.php,102,text,,admin_key_a492d3e1,Key
admin.php,102,text,,admin_value_ade2517b,Value
admin.php,106,text,,admin_sessionstorage_badcfa88,sessionStorage
admin.php,107,text,,admin_key_a492d3e1,Key
admin.php,107,text,,admin_value_ade2517b,Value
admin.php,111,text,,admin_indexeddb_3605f68c,IndexedDB
admin.php,112,text,,admin_prufe_unterstutzung_6e7907ca,"Pr√ºfe Unterst√ºtzung‚Ä¶"
admin.php,116,text,,admin_cache_storage_e13851e3,"Cache Storage"
admin.php,117,text,,admin_prufe_caches_4d600697,"Pr√ºfe Caches‚Ä¶"
admin.php,121,text,,admin_rohdaten_2bc214de,Rohdaten
admin.php,125,text,,admin_i18n_mask_script_0_4b2646d5,%%I18N_MASK_SCRIPT_0%%
admin.php,130,text,,admin_system_logs_d0584c5f,System-Logs
admin.php,132,text,,admin_zeilen_e389561c,Zeilen:
admin.php,134,text,,admin_200_d4f65831,200
admin.php,135,text,,admin_500_30b25661,500
admin.php,136,text,,admin_1000_1f5eba5c,1000
admin.php,137,text,,admin_2000_fda230b9,2000
admin.php,138,text,,admin_5000_d29e867a,5000
admin.php,142,text,,admin_level_24600e3f,Level:
admin.php,144,text,,admin_alle_317ee67d,(alle)
admin.php,145,text,,admin_info_1b10899e,INFO
admin.php,146,text,,admin_php_c3b8c946,PHP
admin.php,147,text,,admin_warning_06f98eb0,WARNING
admin.php,148,text,,admin_error_8fc69bd2,ERROR
admin.php,149,text,,admin_exception_8b8dafb2,EXCEPTION
admin.php,150,text,,admin_fatal_372c050c,FATAL
admin.php,156,text,,admin_regex_af5a6fcf,RegEx
admin.php,157,text,,admin_gross_klein_e7d66a45,Gro√ü/Klein
admin.php,158,text,,admin_invertieren_249f8aea,invertieren
admin.php,160,text,,admin_aktualisieren_993d5ee1,Aktualisieren
admin.php,162,text,,admin_auto_refresh_10s_055eb205,"Auto-Refresh (10s)"
admin.php,164,text,,admin_api_admin_logs_php_download_1_download_45c11d7f,"/api/admin/logs.php?download=1"">Download"
admin.php,165,text,,admin_log_leeren_f4ce3143,"Log leeren"
admin.php,169,text,,admin_i18n_mask_script_1_ea3c653c,%%I18N_MASK_SCRIPT_1%%
admin.php,178,text,,admin_suchen_1ac29db0,Suchen
admin.php,182,text,,admin_id_81d49999,ID
admin.php,182,text,,admin_name_6ac64074,Name
admin.php,182,text,,admin_email_09bc92cd,Email
admin.php,182,text,,admin_role_b187c244,Role
admin.php,182,text,,admin_aktionen_8a610133,Aktionen
admin.php,187,text,,admin_user_bearbeiten_49ff3739,"User bearbeiten"
admin.php,190,text,,admin_user_id_42f04bc8,User-ID
admin.php,194,text,,admin_rolle_d94665a8,Rolle
admin.php,196,text,,admin_user_926056e9,user
admin.php,197,text,,admin_admin_f73969c4,admin
admin.php,202,text,,admin_anzeigename_bce0342f,Anzeigename
admin.php,207,text,,admin_e_mail_read_only_a88a2815,"E-Mail (read-only)"
admin.php,213,text,,admin_twitch_streamer_e5508aab,Twitch-Streamer
admin.php,220,text,,admin_speichern_f3915f2a,Speichern
admin.php,221,text,,admin_abbrechen_90af2557,Abbrechen
admin.php,227,text,,admin_threads_verwalten_02c9a7e1,"Threads verwalten"
admin.php,230,text,,admin_suche_titel_slug_4d2e5546,"Suche (Titel/Slug)"
admin.php,234,text,,admin_board_147c4881,Board
admin.php,235,text,,admin_alle_fb169d9b,Alle
admin.php,237,text,,admin_neu_laden_a5fd9dbb,"Neu laden"
admin.php,245,text,,admin_id_81d49999,ID
admin.php,245,text,,admin_board_147c4881,Board
admin.php,245,text,,admin_titel_eabd94df,Titel
admin.php,245,text,,admin_slug_406d56a0,Slug
admin.php,246,text,,admin_autor_590f84f9,Autor
admin.php,246,text,,admin_posts_b682de8e,Posts
admin.php,246,text,,admin_locked_fd7585c7,Locked
admin.php,246,text,,admin_pinned_ebbfb68b,Pinned
admin.php,247,text,,admin_erstellt_1f3e11f8,Erstellt
admin.php,247,text,,admin_aktion_b37fa2ea,Aktion
admin.php,253,text,,admin_zuruck_d8ba02e8,"¬´ Zur√ºck"
admin.php,254,text,,admin_weiter_f5236a11,"Weiter ¬ª"
admin.php,262,text,,admin_thread_bearbeiten_99464b82,"Thread bearbeiten"
admin.php,265,text,,admin_thread_id_3b6a573c,Thread-ID
admin.php,269,text,,admin_board_147c4881,Board
admin.php,273,text,,admin_titel_eabd94df,Titel
admin.php,277,text,,admin_slug_406d56a0,Slug
admin.php,281,text,,admin_locked_fd7585c7,Locked
admin.php,282,text,,admin_0_16ca4d2a,0
admin.php,282,text,,admin_1_c86f5f26,1
admin.php,285,text,,admin_pinned_ebbfb68b,Pinned
admin.php,286,text,,admin_0_16ca4d2a,0
admin.php,286,text,,admin_1_c86f5f26,1
admin.php,290,text,,admin_speichern_f3915f2a,Speichern
admin.php,291,text,,admin_abbrechen_90af2557,Abbrechen
admin.php,299,text,,admin_posts_in_thread_d5d26d90,"Posts in Thread"
admin.php,301,text,,admin_suche_f1cab2b9,Suche
admin.php,302,text,,admin_zuruck_d8ba02e8,"¬´ Zur√ºck"
admin.php,303,text,,admin_weiter_f5236a11,"Weiter ¬ª"
admin.php,308,text,,admin_id_81d49999,ID
admin.php,308,text,,admin_autor_590f84f9,Autor
admin.php,308,text,,admin_inhalt_01bc7242,Inhalt
admin.php,308,text,,admin_erstellt_1f3e11f8,Erstellt
admin.php,308,text,,admin_aktion_b37fa2ea,Aktion
admin.php,314,text,,admin_post_bearbeiten_943e193f,"Post bearbeiten"
admin.php,315,text,,admin_i18n_mask_textarea_6_c568d460,%%I18N_MASK_TEXTAREA_6%%
admin.php,318,text,,admin_speichern_f3915f2a,Speichern
admin.php,319,text,,admin_loschen_9e5e506b,L√∂schen
admin.php,320,text,,admin_schliessen_6f0188ab,Schlie√üen
admin.php,329,text,,admin_neues_turnier_anlegen_d99a3645,"Neues Turnier anlegen"
admin.php,330,text,,admin_api_tournaments_create_php_e0110703,"/api/tournaments/create.php"">"
admin.php,333,text,,admin_name_6ac64074,Name
admin.php,337,text,,admin_format_841d7101,Format
admin.php,339,text,,admin_punkte_rennen_12df3976,Punkte‚ÄëRennen
admin.php,340,text,,admin_k_o_v2_1a50dfc4,"K.O. (v2)"
admin.php,344,text,,admin_teamgrosse_ed876d57,Teamgr√∂√üe
admin.php,346,text,,admin_solo_5cf01c41,Solo
admin.php,347,text,,admin_duo_40aef5a9,Duo
admin.php,348,text,,admin_trio_7b494a8a,Trio
admin.php,352,text,,admin_plattform_dcb111b4,Plattform
admin.php,354,text,,admin_gemischt_6a06a03e,Gemischt
admin.php,355,text,,admin_pc_05f9fcf0,PC
admin.php,356,text,,admin_xbox_6cf624c5,Xbox
admin.php,357,text,,admin_playstation_4244f1c4,PlayStation
admin.php,361,text,,admin_top_runs_best_of_n_ac60c940,"Top‚ÄëRuns (Best of N)"
admin.php,365,text,,admin_max_teams_optional_1d62cd46,"Max. Teams (optional)"
admin.php,369,text,,admin_start_50c34ebb,Start
admin.php,373,text,,admin_ende_f3138982,Ende
admin.php,377,text,,admin_regeln_i18n_mask_textarea_7_c64b2eec,"Regeln
          %%I18N_MASK_TEXTAREA_7%%"
admin.php,381,text,,admin_preise_optional_i18n_mask_textarea_8_4bdfffb6,"Preise (optional)
          %%I18N_MASK_TEXTAREA_8%%"
admin.php,385,text,,admin_scoring_json_i18n_mask_textarea_9_e864bf21,"Scoring JSON
          %%I18N_MASK_TEXTAREA_9%%"
admin.php,390,text,,admin_turnier_erstellen_13720e33,"Turnier erstellen"
admin.php,391,text,,admin_erstellen_offnen_0ba7c09e,"Erstellen & √ñffnen"
admin.php,403,text,,admin_turniere_57ef99bd,Turniere
admin.php,405,text,,admin_id_81d49999,ID
admin.php,405,text,,admin_name_6ac64074,Name
admin.php,405,text,,admin_status_3d3eb068,Status
admin.php,405,text,,admin_plattform_dcb111b4,Plattform
admin.php,405,text,,admin_team_0799ce2d,Team
admin.php,405,text,,admin_format_841d7101,Format
admin.php,405,text,,admin_start_50c34ebb,Start
admin.php,405,text,,admin_ende_f3138982,Ende
admin.php,405,text,,admin_link_cf4cdfae,Link
admin.php,408,text,,admin_keine_turniere_893c29df,"Keine Turniere"
admin.php,419,text,,admin_tournaments_view_php_id_8efbf504,/tournaments/view.php?id=
admin.php,419,text,,admin_target_blank_rel_noreferrer_noopener_offnen_4dea1fa7,""" target=""_blank"" rel=""noreferrer noopener"">√∂ffnen"
admin.php,492,text,,admin_runs_moderation_fc412ec0,"Runs ‚Äì Moderation"
admin.php,496,text,,admin_id_81d49999,ID
admin.php,496,text,,admin_team_0799ce2d,Team
admin.php,496,text,,admin_turnier_50c2f0e6,Turnier
admin.php,497,text,,admin_kills_bfb94cb2,Kills
admin.php,497,text,,admin_boss_582e2870,Boss
admin.php,497,text,,admin_token_bd3cf8a1,Token
admin.php,497,text,,admin_deaths_5268da13,Deaths
admin.php,497,text,,admin_gauntlet_07dcc572,Gauntlet
admin.php,498,text,,admin_punkte_28ef8c76,Punkte
admin.php,498,text,,admin_screenshot_61beaf35,Screenshot
admin.php,498,text,,admin_status_3d3eb068,Status
admin.php,498,text,,admin_aktion_b37fa2ea,Aktion
admin.php,503,text,,admin_keine_offenen_einreichungen_f28e4dc4,"Keine offenen Einreichungen"
admin.php,515,text,,admin_target_blank_offnen_5cb67fde,""" target=""_blank"">√∂ffnen"
admin.php,518,text,,admin_api_tournaments_approve_run_php_class_inline_style_disp_1e224314,"/api/tournaments/approve_run.php"" class=""inline"" style=""display:inline-block"">"
admin.php,521,text,,admin_approve_6b1d1f18,Approve
admin.php,523,text,,admin_api_tournaments_reject_run_php_class_inline_style_displ_58096a10,"/api/tournaments/reject_run.php"" class=""inline"" style=""display:inline-block"">"
admin.php,527,text,,admin_reject_69bd225d,Reject
admin.php,529,text,,admin_api_tournaments_flag_run_php_class_inline_style_display_a3e85ef5,"/api/tournaments/flag_run.php"" class=""inline"" style=""display:inline-block"">"
admin.php,532,text,,admin_flag_d9e0fdc1,Flag
admin.php,545,text,,admin_query_select_limit_200_runs_rst_fetchall_b0cbc65b,"query(""SELECT ... LIMIT 200"");
    $runs = $rSt->fetchAll(...);"
admin.php,547,text,,admin_tabelle_fffd1ee6,"... Tabelle ..."
admin.php,614,text,,admin_bilder_auflisten_e5965f9d,"Bilder auflisten"
admin.php,615,text,,admin_videos_auflisten_715f3114,"Videos auflisten"
admin.php,620,text,,admin_preview_eee8901c,Preview
admin.php,620,text,,admin_typ_18281ff9,Typ
admin.php,620,text,,admin_pfad_519ae683,Pfad
admin.php,620,text,,admin_thema_2d690536,Thema
admin.php,620,text,,admin_size_25197511,Size
admin.php,620,text,,admin_aktionen_8a610133,Aktionen
admin.php,628,text,,admin_link_preview_cache_leeren_b303a244,"Link-Preview Cache leeren"
admin.php,632,text,,admin_health_wird_geladen_fcd8404f,"Health wird geladen‚Ä¶"
admin.php,636,text,,admin_broadcast_senden_9d343133,"Broadcast senden"
admin.php,638,text,,admin_titel_eabd94df,Titel
admin.php,639,text,,admin_level_b0658ff6,Level
admin.php,640,text,,admin_info_e641d7ef,info
admin.php,640,text,,admin_warn_88cfd921,warn
admin.php,640,text,,admin_critical_ede99ef9,critical
admin.php,643,text,,admin_body_b5d183cd,Body
admin.php,643,text,,admin_i18n_mask_textarea_10_f5aec6d6,%%I18N_MASK_TEXTAREA_10%%
admin.php,645,text,,admin_link_optional_3f4635bf,"Link (optional)"
admin.php,646,text,,admin_fan_out_in_notifications_b451a75a,"Fan-Out in notifications"
admin.php,648,text,,admin_senden_6b91d25e,Senden
admin.php,651,text,,admin_letzte_broadcasts_91647d4b,"Letzte Broadcasts"
admin.php,652,text,,admin_id_81d49999,ID
admin.php,652,text,,admin_titel_eabd94df,Titel
admin.php,652,text,,admin_level_b0658ff6,Level
admin.php,652,text,,admin_body_preview_98d8e6c9,"Body (Preview)"
admin.php,652,text,,admin_link_cf4cdfae,Link
admin.php,652,text,,admin_active_82635a51,Active
admin.php,652,text,,admin_aktion_b37fa2ea,Aktion
admin.php,653,text,,admin_neu_laden_a5fd9dbb,"Neu laden"
admin.php,658,text,,admin_achievement_anlegen_andern_ca34a988,"Achievement anlegen/√§ndern"
admin.php,660,text,,admin_id_leer_neu_327aca90,"ID (leer = neu)"
admin.php,661,text,,admin_key_a492d3e1,Key
admin.php,662,text,,admin_titel_eabd94df,Titel
admin.php,663,text,,admin_icon_bfc08b4a,Icon
admin.php,664,text,,admin_event_875d1da1,Event
admin.php,665,text,,admin_stat_18a5d2af,Stat
admin.php,666,text,,admin_threshold_eb853285,Threshold
admin.php,667,text,,admin_punkte_28ef8c76,Punkte
admin.php,668,text,,admin_aktiv_548fa030,Aktiv
admin.php,668,text,,admin_1_c86f5f26,1
admin.php,668,text,,admin_0_16ca4d2a,0
admin.php,669,text,,admin_beschreibung_2fa6c5b3,Beschreibung
admin.php,671,text,,admin_speichern_f3915f2a,Speichern
admin.php,674,text,,admin_achievements_c124a8f0,Achievements
admin.php,675,text,,admin_id_81d49999,ID
admin.php,675,text,,admin_key_a492d3e1,Key
admin.php,675,text,,admin_titel_eabd94df,Titel
admin.php,675,text,,admin_event_stat_59c66b58,Event/Stat
admin.php,675,text,,admin_threshold_eb853285,Threshold
admin.php,675,text,,admin_punkte_28ef8c76,Punkte
admin.php,675,text,,admin_aktiv_548fa030,Aktiv
admin.php,676,text,,admin_neu_laden_a5fd9dbb,"Neu laden"
admin.php,679,text,,admin_achievement_vergeben_a5ec2cb3,"Achievement vergeben"
admin.php,681,text,,admin_user_id_42f04bc8,User-ID
admin.php,682,text,,admin_email_09bc92cd,Email
admin.php,683,text,,admin_achievement_id_oder_key_e5236fc8,"Achievement (ID oder Key)"
admin.php,685,text,,admin_vergeben_5614637e,Vergeben
admin.php,690,text,,admin_messages_cleanup_d1a406be,"Messages Cleanup"
admin.php,692,text,,admin_retention_tage_802631c0,"Retention (Tage)"
admin.php,693,text,,admin_batch_52b841f5,Batch
admin.php,694,text,,admin_update_chunk_b9d4c293,Update-Chunk
admin.php,696,text,,admin_platzhalter_text_cd8111ca,Platzhalter-Text
admin.php,700,text,,admin_dry_run_2b5f2d8d,Dry-Run
admin.php,701,text,,admin_preview_dry_run_4fad2d2c,"Preview (Dry-Run)"
admin.php,702,text,,admin_cleanup_ausfuhren_b4de22e5,"Cleanup ausf√ºhren"
admin.php,707,text,,admin_i18n_mask_script_3_c8e118d4,%%I18N_MASK_SCRIPT_3%%
admin.php,154,attr,placeholder,admin_placeholder_suche_z_b_signup_file_put_contents_8013d188,"Suche (z. B. signup, file_put_contents‚Ä¶)"
admin.php,177,attr,placeholder,admin_placeholder_suche_name_email_id_941bdd18,"Suche Name/Email/ID‚Ä¶"
admin.php,203,attr,placeholder,admin_placeholder_display_name_d56f79b9,"Display Name"
admin.php,215,attr,placeholder,admin_placeholder_https_twitch_tv_username_8cace53f,https://twitch.tv/username
admin.php,231,attr,placeholder,admin_placeholder_z_b_bug_willkommen_8f9d35a1,"z. B. bug, willkommen"
admin.php,278,attr,placeholder,admin_placeholder_optional_leer_lassen_um_nicht_zu_andern_9f71b5ea,"optional ‚Äì leer lassen um nicht zu √§ndern"
admin.php,301,attr,placeholder,admin_placeholder_textsuche_b654475a,Textsuche
admin.php,334,attr,placeholder,admin_placeholder_bayou_blitz_649c5f7d,"Bayou Blitz"
admin.php,366,attr,placeholder,admin_placeholder_z_b_64_c628ab7f,"z.‚ÄØB. 64"
admin.php,526,attr,placeholder,admin_placeholder_grund_1bd56733,Grund
admin.php,645,attr,placeholder,admin_placeholder_https_2e6a7784,https://‚Ä¶
admin.php,661,attr,placeholder,admin_placeholder_z_b_posts_10_dd05806b,"z.B. posts_10"
admin.php,663,attr,placeholder,admin_placeholder_assets_images_achievements_x_png_fe741f10,/assets/images/achievements/x.png
admin.php,664,attr,placeholder,admin_placeholder_z_b_post_created_7ba114b9,"z.B. post_created"
admin.php,665,attr,placeholder,admin_placeholder_z_b_posts_count_77b5392d,"z.B. posts_count"
admin.php,681,attr,placeholder,admin_placeholder_oder_email_nutzen_7078cd80,"oder Email nutzen"
admin.php,682,attr,placeholder,admin_placeholder_oder_user_id_nutzen_eff5d772,"oder User-ID nutzen"
admin.php,683,attr,placeholder,admin_placeholder_z_b_5_oder_posts_10_89522166,"z.B. 5 oder posts_10"
admin.php,134,attr,value,admin_value_200_49090bf8,200
admin.php,135,attr,value,admin_value_500_ac5b9a6e,500
admin.php,136,attr,value,admin_value_1000_69b019e7,1000
admin.php,137,attr,value,admin_value_2000_3e35bbf8,2000
admin.php,138,attr,value,admin_value_5000_29e3fc2d,5000
admin.php,145,attr,value,admin_value_info_16e06ebd,[INFO]
admin.php,146,attr,value,admin_value_php_526ef6e0,[PHP]
admin.php,147,attr,value,admin_value_warning_7238572f,[WARNING]
admin.php,148,attr,value,admin_value_error_4d2fe024,[ERROR]
admin.php,149,attr,value,admin_value_exception_c4751b10,[EXCEPTION]
admin.php,150,attr,value,admin_value_fatal_e50ef8de,[FATAL]
admin.php,196,attr,value,admin_value_user_44f8f837,user
admin.php,197,attr,value,admin_value_admin_00801bc6,admin
admin.php,235,attr,value,admin_value_0_24db6015,0
admin.php,282,attr,value,admin_value_0_24db6015,0
admin.php,282,attr,value,admin_value_1_4daccc68,1
admin.php,286,attr,value,admin_value_0_24db6015,0
admin.php,286,attr,value,admin_value_1_4daccc68,1
admin.php,331,attr,value,admin_value_htmlspecialchars_string_csrf_ent_quotes_utf_8_4748d059,"<?= htmlspecialchars((string)$csrf, ENT_QUOTES, 'UTF-8') ?>"
admin.php,339,attr,value,admin_value_points_93a7dc4f,points
admin.php,340,attr,value,admin_value_ko_7f6a7a65,ko
admin.php,346,attr,value,admin_value_1_4daccc68,1
admin.php,347,attr,value,admin_value_2_abbb30ef,2
admin.php,348,attr,value,admin_value_3_bfcd946d,3
admin.php,354,attr,value,admin_value_mixed_a243fe2e,mixed
admin.php,355,attr,value,admin_value_pc_9de381c5,pc
admin.php,356,attr,value,admin_value_xbox_09b921cc,xbox
admin.php,357,attr,value,admin_value_ps_1fd4d611,ps
admin.php,362,attr,value,admin_value_3_bfcd946d,3
admin.php,519,attr,value,admin_value_htmlspecialchars_string_csrf_ent_quotes_utf_8_4748d059,"<?= htmlspecialchars((string)$csrf, ENT_QUOTES, 'UTF-8') ?>"
admin.php,520,attr,value,admin_value_int_r_id_997c2bfd,"<?= (int)$r['id'] ?>"
admin.php,524,attr,value,admin_value_htmlspecialchars_string_csrf_ent_quotes_utf_8_4748d059,"<?= htmlspecialchars((string)$csrf, ENT_QUOTES, 'UTF-8') ?>"
admin.php,525,attr,value,admin_value_int_r_id_997c2bfd,"<?= (int)$r['id'] ?>"
admin.php,530,attr,value,admin_value_htmlspecialchars_string_csrf_ent_quotes_utf_8_4748d059,"<?= htmlspecialchars((string)$csrf, ENT_QUOTES, 'UTF-8') ?>"
admin.php,531,attr,value,admin_value_int_r_id_997c2bfd,"<?= (int)$r['id'] ?>"
admin.php,666,attr,value,admin_value_1_4daccc68,1
admin.php,667,attr,value,admin_value_0_24db6015,0
admin.php,668,attr,value,admin_value_1_4daccc68,1
admin.php,668,attr,value,admin_value_0_24db6015,0
admin.php,692,attr,value,admin_value_15_0b6cd640,15
admin.php,693,attr,value,admin_value_500_ac5b9a6e,500
admin.php,694,attr,value,admin_value_200_49090bf8,200
admin.php,697,attr,value,admin_value_anhang_bild_video_automatisch_geloscht_alter_als_15_tage_89daa4c4,"Anhang (Bild/Video) automatisch gel√∂scht ‚Äì √§lter als 15 Tage."
forgot.php,43,text,,forgot_login_c7cdc9bb,Login
forgot.php,48,text,,forgot_home_05db3dde,Home
forgot.php,58,text,,forgot_login_c7cdc9bb,Login
forgot.php,75,text,,forgot_passwort_vergessen_75e3614d,"Passwort vergessen"
forgot.php,124,text,,forgot_i18n_mask_style_3_i18n_mask_script_0_i18n_ma_10257af3,"%%I18N_MASK_STYLE_3%%

%%I18N_MASK_SCRIPT_0%%

%%I18N_MASK_SCRIPT_1%%
%%I18N_MASK_SCRIPT_2%%"
forgot.php,86,attr,placeholder,forgot_placeholder_you_example_com_179bbfb9,you@example.com
index.php,52,text,,index_hunt_showdown_network_5755d3c9,"Hunt:Showdown Network"
index.php,108,text,,index_alt_vr_gaming_trends_b88174d2,""" alt=""VR Gaming Trends"" />"
index.php,135,text,,index_forum_thread_php_t_02613afa,/forum/thread.php?t=
index.php,135,text,,index_comment_f93637bd,#comment-
index.php,135,text,,index_class_heading_5_text_w_ne_2d169c03,"""
                                class=""heading-5 text-w-neutral-1 leading-[130%] line-clamp-2 link-1"">"
index.php,144,text,,index_load_more_6d34670d,"Load More..."
index.php,168,text,,index_i18n_mask_script_0_f502f43e,""">
%%I18N_MASK_SCRIPT_0%%"
index.php,193,text,,index_htda_de_c6edfc62,HTDA.de
index.php,197,text,,index_deutsche_hunt_showdown_news_und_patchnotes_fa02eedf,"Deutsche Hunt:Showdown News und Patchnotes"
index.php,213,text,,index_huntmaps_online_9ccdd6f9,HuntMaps.online
index.php,217,text,,index_interaktive_maps_de_en_c35a1aa6,"Interaktive Maps DE/EN"
index.php,232,text,,index_hunthub_online_3fb6b930,HuntHub.online
index.php,236,text,,index_hunt_showdown_community_de_en_e2bc9890,"Hunt:Showdown Community DE/EN"
index.php,108,attr,alt,index_alt_vr_gaming_trends_213a6381,"VR Gaming Trends"
index.php,203,attr,alt,index_alt_library_e80dc313,library
index.php,222,attr,alt,index_alt_library_e80dc313,library
index.php,241,attr,alt,index_alt_library_e80dc313,library
404.php,51,text,,404_error_404_b4caa788,"Error 404"
404.php,56,text,,404_home_b84fa39e,Home
404.php,66,text,,404_error_404_b4caa788,"Error 404"
404.php,83,text,,404_404_3417b74d,404
404.php,86,text,,404_looks_like_you_are_lost_af61c502,"Looks Like You are Lost"
404.php,89,text,,404_we_can_t_seem_to_find_the_page_you_re_looking_for_3b0cf16a,"We can‚Äôt seem to find the page you‚Äôre looking for."
404.php,92,text,,404_back_to_home_7d6da8ce,"BACK TO HOME"
register.php,57,text,,register_sign_up_b540c07d,"Sign Up"
register.php,62,text,,register_home_3ec92fe5,Home
register.php,72,text,,register_sign_up_b540c07d,"Sign Up"
register.php,89,text,,register_sign_up_b540c07d,"Sign Up"
register.php,92,text,,register_already_have_an_account_40a3c74c,"Already have an account?"
register.php,94,text,,register_login_f5622eef,Login
register.php,99,text,,register_api_auth_oauth_start_php_provider_google_class_btn_b_d8248a66,"/api/auth/oauth_start.php?provider=google""
     class=""btn btn-md bg-[#434DE4] hover:bg-[#434DE4]/80 w-full inline-flex items-center justify-center""
     aria-label=""Log in with Google"" role=""button"">"
register.php,102,text,,register_log_in_with_google_fd23d356,"Log In With Google"
register.php,106,text,,register_log_in_with_twitch_91cb579f,"Log In with Twitch"
register.php,110,text,,register_log_in_with_facebook_1fb4bdd7,"Log In With Facebook"
register.php,117,text,,register_or_3519eecc,Or
register.php,177,text,,register_i18n_mask_script_0_ccaceea9,%%I18N_MASK_SCRIPT_0%%
register.php,128,attr,placeholder,register_placeholder_z_b_hunter19_2fbb44dd,"z. B. Hunter19"
register.php,135,attr,placeholder,register_placeholder_password_7ceec913,Password
register.php,142,attr,placeholder,register_placeholder_password_7ceec913,Password
register.php,149,attr,placeholder,register_placeholder_email_88d74e96,Email
register.php,101,attr,aria-label,register_aria-label_log_in_with_google_fd2e39d8,"Log in with Google"
account-deletion.php,8,text,,account-deletion_konto_loschen_hunthub_5393d16c,"Konto l√∂schen ‚Äì Hunthub"
account-deletion.php,11,text,,account-deletion_konto_loschen_0ac972e7,"Konto l√∂schen"
account-deletion.php,12,text,,account-deletion_wenn_du_dein_hunthub_konto_loschen_mochtest_sende_uns_bitte_486f1e9e,"Wenn du dein Hunthub-Konto l√∂schen m√∂chtest, sende uns bitte eine E-Mail an"
account-deletion.php,13,text,,account-deletion_support_hunthub_online_c5238325,support@hunthub.online
account-deletion.php,13,text,,account-deletion_von_der_adresse_die_mit_deinem_konto_verknupft_ist_w_ac497eed,"von der Adresse, die mit deinem Konto verkn√ºpft ist. 
     Wir l√∂schen anschlie√üend alle deine Daten dauerhaft."
auth/session_bootstrap.php,11,text,,session_bootstrap_60_60_24_14_14_tage_path_ebddbd58,"60*60*24*14, // 14 Tage
  'path'     => '/',         //"
auth/guards.php,13,text,,guards_db_auth_config_php_cookies_session_name_ee1dfe3a,"db()
 * - /auth/config.php    -> cookies.session_name
 * - /auth/roles.php     -> is_admin($user), role_rank($role) (Fallbacks hier enthalten)
 */

require_once __DIR__ . '/db.php';
require_once __DIR__ . '/roles.php'; // stellt idealerweise is_admin() & role_rank() bereit

/* ---- Fallbacks, falls roles.php sie nicht definiert hat ---- */
if (!function_exists('role_rank')) {
  /**
   * Gibt eine numerische Rangfolge zur√ºck (user"
auth/guards.php,27,text,,guards_0_mod_1_admin_2_r_strtolower_string_2cc3f4fe,"0, 'mod' => 1, 'admin' => 2];
    $r = strtolower((string)($role ?? 'user'));
    return $map[$r] ?? 0;
  }
}
if (!function_exists('is_admin')) {
  /**
   * Admin ist, wer role='admin' ODER is_admin=1 besitzt
   */
  function is_admin(array $u): bool {
    if (!$u) return false;
    $role = strtolower((string)($u['role'] ?? ''));
    return $role === 'admin' || !empty($u['is_admin'] ?? 0);
  }
}

/**
 * Liefert den eingeloggten User (per Session-Cookie aus config.php)
 * oder null, wenn niemand eingeloggt ist. Aktualisiert last_seen der Session.
 */
function current_user(): ?array {
  $cfg    = require __DIR__ . '/config.php';
  $cookie = $_COOKIE[$cfg['cookies']['session_name']] ?? null;
  if (!$cookie) return null;

  $pdo = db();
  $stmt = $pdo->prepare(""
    SELECT s.token AS session_id, u.*
    FROM auth_sessions s
    JOIN users u ON u.id = s.user_id
    WHERE s.token = ?
    LIMIT 1
  "");
  $stmt->execute([$cookie]);
  $row = $stmt->fetch();
  if (!$row) return null;

  // Session ‚Äûtouch‚Äú
  $pdo->prepare(""UPDATE auth_sessions SET last_seen = NOW() WHERE token = ?"")->execute([$cookie]);

  return $row;
}
function is_twitch_streamer(array $u = null): bool {
    if ($u === null) {
        $u = function_exists('current_user') ? current_user() : [];
    }
    return !empty($u) && !empty($u['is_twitch_streamer']);
}
/**
 * Weiche Variante: gibt User oder null zur√ºck ‚Äì kein Exit, kein Redirect.
 * Ideal f√ºr Views (z. B. Forum-Board/Thread), um Formulare konditional einzublenden.
 */
function optional_auth(): ?array {
  return current_user();
}

/**
 * Harte Variante: erzwingt Login; bei fehlender Auth Abbruch mit 401 JSON.
 * Ideal f√ºr APIs.
 */
function require_auth(): array {
  $user = current_user();
  if (!$user) {
    http_response_code(401);
    header('Content-Type: application/json; charset=utf-8');
    echo json_encode(['ok' => false, 'error' => 'unauthorized']);
    exit;
  }
  return $user;
}

/**
 * Rollen-Guard f√ºr APIs: erzwingt Mindestrolle, sonst 403 JSON.
 */
function require_role(string $minRole): array {
  $user = require_auth();
  if (role_rank($user['role'] ?? 'user')"
auth/csrf.php,13,text,,csrf_token_erzeugen_holen_fur_2ed46bbe,"Token erzeugen/holen (f√ºr"
auth/csrf.php,13,text,,csrf_check_csrf_request_array_data_bool_pruft_dat_8384a091,")
 *  - check_csrf_request(array $data): bool  -> pr√ºft $data['csrf'] / ['csrf_token']
 *  - csrf_meta_tag(): string                -> fertiges"
auth/csrf.php,15,text,,csrf_grundhelfer_belassen_weiterverwen_057d70a7,"*/

/* ---------------- Grundhelfer (belassen / weiterverwenden) ---------------- */

function sessions_table_from_config(): string {
  $cfg = require __DIR__ . '/config.php';
  $t = $cfg['sessions_table'] ?? 'auth_sessions';
  $t = strtolower((string)$t);
  return preg_match('/^[a-z0-9_]+$/', $t) ? $t : 'auth_sessions';
}

function session_key_col(\PDO $pdo, string $table): string {
  try {
    $cols = $pdo->query(""SHOW COLUMNS FROM `{$table}`"")->fetchAll(\PDO::FETCH_COLUMN, 0);
    if (in_array('token', $cols, true)) return 'token';
    if (in_array('id', $cols, true))    return 'id';
  } catch (\PDOException $e) {
    // Fallback
  }
  return 'token';
}

function random_hex(int $bytes = 32): string {
  return bin2hex(random_bytes($bytes));
}

/** Name des Session-Cookies aus config.php ‚Äì Fallback 'sess_id' */
function session_cookie_name_from_config(): string {
  $cfg = require __DIR__ . '/config.php';
  // versuche mehrere m√∂gliche Keys
  $name =
    $cfg['session_cookie'] ??
    $cfg['cookie_name'] ??
    $cfg['sess_cookie'] ??
    'sess_id';
  $name = (string)$name;
  return $name !== '' ? $name : 'sess_id';
}

/**
 * Gibt vorhandenes CSRF-Token zur Session zur√ºck oder legt es an.
 * Wirft RuntimeException, wenn Spalte csrf_token fehlt (mit Migrationshinweis).
 */
function issue_csrf(\PDO $pdo, string $sessionCookie): string {
  if ($sessionCookie === '') return '';
  $table = sessions_table_from_config();
  $key   = session_key_col($pdo, $table);

  try {
    $st = $pdo->prepare(""SELECT `csrf_token` FROM `{$table}` WHERE `{$key}` = ? LIMIT 1"");
    $st->execute([$sessionCookie]);
    $row = $st->fetch(\PDO::FETCH_ASSOC);
  } catch (\PDOException $e) {
    if ($e->getCode() === '42S22') {
      throw new \RuntimeException(
        ""CSRF: Spalte `csrf_token` fehlt in Tabelle `{$table}`. Migration:\n"".
        ""ALTER TABLE `{$table}` ADD COLUMN `csrf_token` VARCHAR(64) NULL, ADD INDEX(`csrf_token`);""
      );
    }
    throw $e;
  }

  if ($row && !empty($row['csrf_token'])) {
    return (string)$row['csrf_token'];
  }

  $token = random_hex(32);
  $up = $pdo->prepare(""UPDATE `{$table}` SET `csrf_token` = ? WHERE `{$key}` = ? LIMIT 1"");
  $up->execute([$token, $sessionCookie]);
  return $token;
}

/** Pr√ºft √ºbermitteltes CSRF-Token gegen die Session in der DB. */
function check_csrf(\PDO $pdo, string $sessionCookie, ?string $token): bool {
  if ($sessionCookie === '' || !$token) return false;
  $table = sessions_table_from_config();
  $key   = session_key_col($pdo, $table);

  try {
    $st = $pdo->prepare(""SELECT `csrf_token` FROM `{$table}` WHERE `{$key}` = ? LIMIT 1"");
    $st->execute([$sessionCookie]);
    $row = $st->fetch(\PDO::FETCH_ASSOC);
  } catch (\PDOException $e) {
    if ($e->getCode() === '42S22') {
      return false;
    }
    throw $e;
  }

  return $row && is_string($row['csrf_token']) && hash_equals((string)$row['csrf_token'], (string)$token);
}

/* ------------------------- Neue, bequeme Helper --------------------------- */

/**
 * Liefert das aktuelle CSRF-Token der eingeloggten Session (und erzeugt es, falls fehlt).
 * Nutzt automatisch db() aus /auth/db.php.
 */
function csrf_token(): string {
  // Hole Session-Cookie
  $cookieName = session_cookie_name_from_config();
  $sess = (string)($_COOKIE[$cookieName] ?? '');

  // Ohne Session-Cookie kein Token
  if ($sess === '') return '';

  // DB holen
  if (!function_exists('db')) {
    require_once __DIR__ . '/db.php';
  }
  $pdo = db();

  try {
    return issue_csrf($pdo, $sess);
  } catch (\Throwable $e) {
    // Wenn Spalte fehlt o.√§., liefere leer -> Callsite kann damit umgehen
    return '';
  }
}

/**
 * Pr√ºft $_POST/$_GET-√§hnliche Daten auf g√ºltiges CSRF-Feld.
 * Akzeptierte Felder: 'csrf' oder 'csrf_token'
 */
function check_csrf_request(array $data): bool {
  $token = null;
  if (isset($data['csrf']) && is_string($data['csrf'])) {
    $token = $data['csrf'];
  } elseif (isset($data['csrf_token']) && is_string($data['csrf_token'])) {
    $token = $data['csrf_token'];
  }

  $cookieName = session_cookie_name_from_config();
  $sess = (string)($_COOKIE[$cookieName] ?? '');
  if ($sess === '' || $token === null) return false;

  if (!function_exists('db')) {
    require_once __DIR__ . '/db.php';
  }
  $pdo = db();

  try {
    return check_csrf($pdo, $sess, $token);
  } catch (\Throwable $e) {
    return false;
  }
}

/** Komfort-Helfer: fertiges"
auth/csrf.php,164,text,,csrf_fur_den_cdc740ec,"f√ºr den"
auth/csrf.php,164,text,,csrf_function_csrf_meta_tag_string_t_htmlspecialchar_54595a99,"*/
function csrf_meta_tag(): string {
  $t = htmlspecialchars(csrf_token(), ENT_QUOTES);
  return '"
privacy.php,6,text,,privacy_datenschutzerklarung_hunthub_6bcc1cd0,"Datenschutzerkl√§rung ‚Äì Hunthub"
privacy.php,7,text,,privacy_i18n_mask_style_1_1ce825da,%%I18N_MASK_STYLE_1%%
privacy.php,12,text,,privacy_datenschutzerklarung_29829403,Datenschutzerkl√§rung
privacy.php,13,text,,privacy_zuletzt_aktualisiert_26_august_2025_fdde75cc,"zuletzt aktualisiert: 26. August 2025"
privacy.php,18,text,,privacy_verantwortlicher_e2a4aff2,Verantwortlicher
privacy.php,19,text,,privacy_hunthub_christian_muller_394a86ff,"Hunthub (Christian M√ºller)"
privacy.php,19,text,,privacy_nelseestrasse_15_63739_aschaffenburg_4a4c9815,"Nelseestra√üe 15, 63739 Aschaffenburg"
privacy.php,20,text,,privacy_e_mail_ed272be6,E-Mail:
privacy.php,21,text,,privacy_support_hunthub_online_230ebd59,support@hunthub.online
privacy.php,21,text,,privacy_website_6e4a6453,Website:
privacy.php,22,text,,privacy_hunthub_online_98aa0dea,hunthub.online
privacy.php,26,text,,privacy_1_allgemeines_69364a87,"1. Allgemeines"
privacy.php,27,text,,privacy_wir_verarbeiten_personenbezogene_daten_gemass_der_datenschutz_42c94c04,"Wir verarbeiten personenbezogene Daten gem√§√ü der Datenschutz-Grundverordnung (DSGVO) nur im erforderlichen Umfang, um die Funktionen unserer Community-Plattform (Profile, Beitr√§ge, Chats, Freundesystem, Dateiuploads) bereitzustellen."
privacy.php,29,text,,privacy_2_welche_daten_verarbeiten_wir_6c48739d,"2. Welche Daten verarbeiten wir?"
privacy.php,31,text,,privacy_registrierungsdaten_c8ec4271,Registrierungsdaten:
privacy.php,31,text,,privacy_e_mail_adresse_passwort_stark_gehasht_anzeigename_slug_1773ece8,"E-Mail-Adresse, Passwort (stark gehasht), Anzeigename/Slug, Rolle."
privacy.php,32,text,,privacy_profildaten_433e545b,Profildaten:
privacy.php,32,text,,privacy_avatar_lokal_gespeicherte_datei_optionale_angaben_384d0afd,"Avatar (lokal gespeicherte Datei), optionale Angaben."
privacy.php,33,text,,privacy_inhalts_und_nutzungsdaten_0018288c,"Inhalts- und Nutzungsdaten:"
privacy.php,33,text,,privacy_beitrage_kommentare_likes_freundschaften_nachrichten_up_c6aa123f,"Beitr√§ge, Kommentare, Likes, Freundschaften, Nachrichten, Uploads."
privacy.php,34,text,,privacy_protokolldaten_cb41b056,Protokolldaten:
privacy.php,34,text,,privacy_ip_adresse_zeitstempel_user_agent_server_logs_session_t_edaa2ef4,"IP-Adresse, Zeitstempel, User-Agent (Server-Logs), Session-Token, CSRF-Token."
privacy.php,35,text,,privacy_social_login_daten_a668c750,Social-Login-Daten:
privacy.php,35,text,,privacy_von_dir_freigegebene_basisdaten_der_anbieter_siehe_abschnit_236de86c,"Von dir freigegebene Basisdaten der Anbieter (siehe Abschnitt 5), inkl. Anbieter-ID, Name, E-Mail (falls √ºbermittelt) und Profilbild-URL. Profilbilder werden zur Anzeige lokal gespeichert."
privacy.php,38,text,,privacy_3_zwecke_und_rechtsgrundlagen_2db65a4b,"3. Zwecke und Rechtsgrundlagen"
privacy.php,40,text,,privacy_bereitstellung_der_plattform_61f2e261,"Bereitstellung der Plattform"
privacy.php,40,text,,privacy_login_profile_interaktionen_art_6_abs_1_lit_b_dsgvo_c8b908de,"(Login, Profile, Interaktionen) ‚Äì Art. 6 Abs. 1 lit. b DSGVO."
privacy.php,41,text,,privacy_einwilligungen_1a56df63,Einwilligungen
privacy.php,41,text,,privacy_z_b_social_login_optionale_profildaten_art_6_abs_1_b4394b66,"(z. B. Social-Login, optionale Profildaten) ‚Äì Art. 6 Abs. 1 lit. a DSGVO."
privacy.php,42,text,,privacy_sicherheit_und_missbrauchsvermeidung_1d7454fc,"Sicherheit und Missbrauchsvermeidung"
privacy.php,42,text,,privacy_sessions_logfiles_art_6_abs_1_lit_f_dsgvo_8951bfb9,"(Sessions, Logfiles) ‚Äì Art. 6 Abs. 1 lit. f DSGVO."
privacy.php,43,text,,privacy_gesetzliche_pflichten_598a2736,"Gesetzliche Pflichten"
privacy.php,43,text,,privacy_art_6_abs_1_lit_c_dsgvo_622e2e2e,"‚Äì Art. 6 Abs. 1 lit. c DSGVO."
privacy.php,46,text,,privacy_4_cookies_f19cb30e,"4. Cookies"
privacy.php,47,text,,privacy_wir_verwenden_essenzielle_cookies_fur_sitzungen_z_b_0aaf1403,"Wir verwenden essenzielle Cookies f√ºr Sitzungen (z.¬†B."
privacy.php,47,text,,privacy_sess_id_eaddea72,sess_id
privacy.php,47,text,,privacy_und_csrf_schutz_es_findet_kein_werbe_oder_reichweiten_tr_4efa5029,") und CSRF-Schutz. Es findet kein Werbe- oder Reichweiten-Tracking durch Dritte statt."
privacy.php,49,text,,privacy_5_social_logins_google_facebook_twitch_steam_79d5cb17,"5. Social Logins (Google, Facebook, Twitch, Steam)"
privacy.php,50,text,,privacy_du_kannst_dich_optional_uber_drittanbieter_anmelden_dabei_w_12ef84b0,"Du kannst dich optional √ºber Drittanbieter anmelden. Dabei werden ausschlie√ülich die von dir freigegebenen Basisdaten genutzt; wir speichern die Anbieter-ID, um dein Konto wiederzuerkennen. Profilbilder werden lokal in"
privacy.php,50,text,,privacy_uploads_avatars_6ae18a68,/uploads/avatars
privacy.php,50,text,,privacy_gespeichert_0d6fe175,gespeichert.
privacy.php,52,text,,privacy_google_ddd1a444,Google
privacy.php,52,text,,privacy_google_ireland_limited_daten_name_e_mail_profilbild_ce407b96,"(Google Ireland Limited) ‚Äì Daten: Name, E-Mail, Profilbild, ‚Äûsub‚Äú (ID). Infos:"
privacy.php,52,text,,privacy_google_datenschutz_9f4e0b2b,Google-Datenschutz
privacy.php,53,text,,privacy_facebook_3d41cd36,Facebook
privacy.php,53,text,,privacy_meta_platforms_ireland_daten_name_e_mail_falls_vorhan_1b96b09f,"(Meta Platforms Ireland) ‚Äì Daten: Name, E-Mail (falls vorhanden), Profilbild, ID. Infos:"
privacy.php,53,text,,privacy_meta_datenschutz_3e47ad9a,Meta-Datenschutz
privacy.php,54,text,,privacy_twitch_5ca0b363,Twitch
privacy.php,54,text,,privacy_twitch_interactive_inc_daten_display_name_e_mail_fa_0f764e1c,"(Twitch Interactive, Inc.) ‚Äì Daten: Display-Name, E-Mail (falls vorhanden), Profilbild, ID. Infos:"
privacy.php,54,text,,privacy_twitch_datenschutz_e01ebb73,Twitch-Datenschutz
privacy.php,55,text,,privacy_steam_openid_6de381b3,"Steam (OpenID)"
privacy.php,55,text,,privacy_valve_corporation_daten_steamid_offentl_profilname_a_e3dd5557,"(Valve Corporation) ‚Äì Daten: SteamID, √∂ffentl. Profilname, Avatar. Infos:"
privacy.php,55,text,,privacy_steam_datenschutz_2e0485c9,Steam-Datenschutz
privacy.php,57,text,,privacy_rechtsgrundlage_art_6_abs_1_lit_a_dsgvo_einwilligung_9dc915f3,"Rechtsgrundlage: Art. 6 Abs. 1 lit. a DSGVO (Einwilligung). Du kannst Social-Logins jederzeit nicht mehr nutzen, indem du sie in deinem Profil entfernst oder dein Konto l√∂schst."
privacy.php,59,text,,privacy_6_empfanger_hosting_075b9369,"6. Empf√§nger & Hosting"
privacy.php,60,text,,privacy_die_plattform_wird_in_der_eu_gehostet_provider_strato_ei_163d1d0b,"Die Plattform wird in der EU gehostet (Provider: Strato). Eine Weitergabe an Dritte erfolgt nur, soweit dies f√ºr Login/Hosting erforderlich ist oder wir rechtlich verpflichtet sind. Es erfolgt kein Verkauf deiner Daten."
privacy.php,62,text,,privacy_7_speicherdauer_809a17eb,"7. Speicherdauer"
privacy.php,64,text,,privacy_profildaten_und_inhalte_bis_zur_kontoloschung_oder_eigensta_d4814a92,"Profildaten und Inhalte: bis zur Kontol√∂schung oder eigenst√§ndigen Entfernung."
privacy.php,65,text,,privacy_protokolldaten_i_d_r_30_tage_a2e387c1,"Protokolldaten: i. d. R. 30 Tage."
privacy.php,66,text,,privacy_nach_kontoloschung_loschung_personenbezogener_daten_i_d_r_c2a13c16,"Nach Kontol√∂schung: L√∂schung personenbezogener Daten i. d. R. innerhalb von 30 Tagen, sofern keine gesetzlichen Pflichten entgegenstehen."
privacy.php,69,text,,privacy_8_deine_rechte_442307ea,"8. Deine Rechte"
privacy.php,70,text,,privacy_du_hast_das_recht_auf_auskunft_art_15_berichtigung_art_6fd2de7f,"Du hast das Recht auf Auskunft (Art. 15), Berichtigung (Art. 16), L√∂schung (Art. 17), Einschr√§nkung (Art. 18), Daten√ºbertragbarkeit (Art. 20) und Widerspruch (Art. 21 DSGVO). Du hast au√üerdem das Recht, eine erteilte Einwilligung jederzeit mit Wirkung f√ºr die Zukunft zu widerrufen."
privacy.php,71,text,,privacy_beschwerden_kannst_du_an_eine_datenschutzaufsichtsbehorde_ri_32f44ce5,"Beschwerden kannst du an eine Datenschutzaufsichtsbeh√∂rde richten; zust√§ndig ist z. B. der Bayerische Landesbeauftragte f√ºr den Datenschutz."
privacy.php,73,text,,privacy_9_kontoloschung_913f6a73,"9. Kontol√∂schung"
privacy.php,74,text,,privacy_informationen_zur_kontoloschung_findest_du_unter_4ed7c364,"Informationen zur Kontol√∂schung findest du unter"
privacy.php,75,text,,privacy_https_hunthub_online_account_deletion_3f795092,https://hunthub.online/account-deletion
privacy.php,75,text,,privacy_auf_wunsch_loschen_wir_dein_konto_auch_per_e_mail_an_43442822,".
      Auf Wunsch l√∂schen wir dein Konto auch per E-Mail an"
privacy.php,77,text,,privacy_support_hunthub_online_230ebd59,support@hunthub.online
privacy.php,80,text,,privacy_10_datensicherheit_a1b9a4be,"10. Datensicherheit"
privacy.php,81,text,,privacy_passworter_werden_mit_modernen_starken_hashverfahren_gespei_a8324c21,"Passw√∂rter werden mit modernen, starken Hashverfahren gespeichert (z. B. Argon2id). Der Zugriff erfolgt ausschlie√ülich verschl√ºsselt (HTTPS). Zugriffe werden protokolliert, um Missbrauch zu verhindern."
privacy.php,83,text,,privacy_11_anderungen_b76bbc3f,"11. √Ñnderungen"
privacy.php,84,text,,privacy_wir_passen_diese_erklarung_an_wenn_unsere_dienste_oder_die_e4d70840,"Wir passen diese Erkl√§rung an, wenn unsere Dienste oder die Rechtslage sich √§ndern. Die jeweils aktuelle Fassung ist jederzeit unter dieser URL abrufbar."
privacy.php,88,text,,privacy_hunthub_alle_rechte_vorbehalten_0428e542,"Hunthub ‚Äì Alle Rechte vorbehalten."
privacy.php,89,text,,privacy_i18n_mask_script_0_c86ac704,%%I18N_MASK_SCRIPT_0%%
test_xp.php,10,text,,test_xp_xp_test_wird_ausgefuhrt_a7b8ab5d,"XP-Test wird ausgef√ºhrt..."
test_xp.php,10,text,,test_xp_bitte_anpassen_testuserid_1_c86730f4,""";

// --- BITTE ANPASSEN ---
$testUserID = 1; //"
test_xp.php,18,text,,test_xp_wir_rufen_die_funktion_direkt_auf_erfolg_awardxp_0fa61433,""";

// Wir rufen die Funktion direkt auf
$erfolg = awardXP($pdo, $testUserID, 'new_post');

echo """
test_xp.php,23,text,,test_xp_ergebnis_des_aufrufs_6fb0bf8e,"Ergebnis des Aufrufs:"
test_xp.php,23,text,,test_xp_var_dump_erfolg_if_erfolg_echo_4db9ea13,""";
var_dump($erfolg);

if ($erfolg) {
    echo """
test_xp.php,27,text,,test_xp_die_funktion_wurde_erfolgreich_ausgefuhrt_bitte_prufe_die_d_c69f3528,"Die Funktion wurde erfolgreich ausgef√ºhrt! Bitte pr√ºfe die Datenbank."
test_xp.php,27,text,,test_xp_else_echo_f8fafe43,""";
} else {
    echo """
test_xp.php,29,text,,test_xp_die_funktion_ist_fehlgeschlagen_wahrscheinliche_ursachen_7b1254eb,"Die Funktion ist fehlgeschlagen. Wahrscheinliche Ursachen:"
test_xp.php,29,text,,test_xp_die_datei_lib_xp_config_php_existiert_nicht_oder_hat_die_9d601fef,"- Die Datei 'lib/xp_config.php' existiert nicht oder hat die falschen Berechtigungen (muss 644 sein)."
test_xp.php,30,text,,test_xp_der_schlussel_new_post_fehlt_in_der_xp_config_php_5c08584f,"- Der Schl√ºssel 'new_post' fehlt in der 'xp_config.php'."
test_xp.php,31,text,,test_xp_die_spalte_xp_oder_points_existiert_in_der_users_tab_4b383f3a,"- Die Spalte 'xp' oder 'points' existiert in der 'users'-Tabelle nicht."
sitemap.php,50,text,,sitemap_query_select_count_from_boards_fetchcolumn_677cebbd,"query(""SELECT COUNT(*) FROM boards"")->fetchColumn();
    } catch (Throwable) {}

    // Z√§hle Threads
    $threadCount = 0;
    try {
        $threadCount = (int)$pdo->query(""SELECT COUNT(*) FROM threads"")->fetchColumn();
    } catch (Throwable) {}

    $threadPages = max(1, (int)ceil($threadCount / THREADS_PER_PAGE));
    $base = abs_base();

    echo '"
sitemap.php,62,text,,sitemap_n_echo_2b2190da,"' . ""\n"";
    echo '"
sitemap.php,63,text,,sitemap_n_static_echo_5ca0a8ae,"' . ""\n"";

    // Static
    echo '"
sitemap.php,66,text,,sitemap_n_echo_2b2190da,"' . ""\n"";
    echo '"
sitemap.php,67,text,,sitemap_esc_base_sitemap_static_xml_57499d2f,"' . esc($base . '/sitemap-static.xml') . '"
sitemap.php,67,text,,sitemap_n_echo_2b2190da,"' . ""\n"";
    echo '"
sitemap.php,68,text,,sitemap_esc_gmdate_c_8e7ec28a,"' . esc(gmdate('c')) . '"
sitemap.php,68,text,,sitemap_n_echo_2b2190da,"' . ""\n"";
    echo '"
sitemap.php,69,text,,sitemap_n_boards_if_boardcount_0_144f6bb1,"' . ""\n"";

    // Boards
    if ($boardCount > 0) {
        echo '"
sitemap.php,73,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,74,text,,sitemap_esc_base_sitemap_boards_1_xml_00993904,"' . esc($base . '/sitemap-boards-1.xml') . '"
sitemap.php,74,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,75,text,,sitemap_esc_gmdate_c_8e7ec28a,"' . esc(gmdate('c')) . '"
sitemap.php,75,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,76,text,,sitemap_n_threads_paginiert_for_i_8d8de65e,"' . ""\n"";
    }

    // Threads (paginiert)
    for ($i = 1; $i"
sitemap.php,81,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,82,text,,sitemap_esc_base_sitemap_threads_i_xml_800d7aa9,"' . esc($base . '/sitemap-threads-' . $i . '.xml') . '"
sitemap.php,82,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,83,text,,sitemap_esc_gmdate_c_8e7ec28a,"' . esc(gmdate('c')) . '"
sitemap.php,83,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,84,text,,sitemap_n_echo_628886ab,"' . ""\n"";
    }

    echo '"
sitemap.php,87,text,,sitemap_exit_8b5d093c,"';
    exit;
}

// -------------------------------------------------------------
// 1) Static ‚Äî ein paar wichtige, relativ ‚Äûstabile‚Äú Seiten
// -------------------------------------------------------------
if ($t === 'static') {
    $base = abs_base();

    // Passe diese Liste an deine Site an.
    // (Du kannst jederzeit mehr hinzuf√ºgen.)
    $static = [
        [ $base . '/',                         'daily',  '1.0', gmdate('c') ],
        [ $base . '/forum/boards.php',         'hourly', '0.9', gmdate('c') ],
        [ $base . '/tournaments/index.php',    'daily',  '0.7', gmdate('c') ],
        [ $base . '/privacy.php',              'yearly', '0.3', gmdate('c') ],
        [ $base . '/legal/rechtlich.php',      'yearly', '0.3', gmdate('c') ],
        [ $base . '/register.php',             'monthly','0.5', gmdate('c') ],
        [ $base . '/profile.php',              'monthly','0.4', gmdate('c') ],
    ];

    echo '"
sitemap.php,109,text,,sitemap_n_echo_2b2190da,"' . ""\n"";
    echo '"
sitemap.php,110,text,,sitemap_n_foreach_static_as_loc_freq_prio_las_0ef53a6d,"' . ""\n"";
    foreach ($static as [$loc, $freq, $prio, $last]) {
        echo """
sitemap.php,112,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,113,text,,sitemap_esc_loc_0ba531f1,"' . esc($loc) . """
sitemap.php,113,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,114,text,,sitemap_esc_last_2882c998,"' . esc($last) . """
sitemap.php,114,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,115,text,,sitemap_esc_freq_5d2f931e,"' . esc($freq) . """
sitemap.php,115,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,116,text,,sitemap_esc_prio_81576b3a,"' . esc($prio) . """
sitemap.php,116,text,,sitemap_n_echo_fcac21ea,"\n"";
        echo """
sitemap.php,117,text,,sitemap_n_echo_e429e0cb,"\n"";
    }
    echo '"
sitemap.php,119,text,,sitemap_exit_e19dae82,"';
    exit;
}

// -------------------------------------------------------------
// 2) Boards ‚Äî alle Foren (mit lastmod ~ letzte Aktivit√§t)
// -------------------------------------------------------------
if ($t === 'boards') {
    $base = abs_base();

    // Wir versuchen, pro Board eine ‚Äûletzte Aktivit√§t‚Äú zu ermitteln:
    // - Entweder boards.updated_at (falls vorhanden),
    // - oder letzte Aktivit√§t aus zugeh√∂rigen Threads/Posts.
    // Fallback: NOW().
    $sql = ""
        SELECT
            b.id,
            COALESCE(
                b.updated_at,
                (SELECT MAX(COALESCE(t.updated_at, t.created_at))
                   FROM threads t WHERE t.board_id = b.id),
                NOW()
            ) AS lastmod
        FROM boards b
        ORDER BY b.id ASC
    "";
    try {
        $rows = $pdo->query($sql)->fetchAll(PDO::FETCH_ASSOC);
    } catch (Throwable) {
        $rows = [];
    }

    echo '"
sitemap.php,151,text,,sitemap_n_echo_2b2190da,"' . ""\n"";
    echo '"
sitemap.php,152,text,,sitemap_n_foreach_rows_as_r_loc_ba_495aefc0,"' . ""\n"";

    foreach ($rows as $r) {
        $loc = $base . '/forum/board.php?id=' . (int)$r['id'];
        $last = w3c_date($r['lastmod']);
        echo """
sitemap.php,157,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,158,text,,sitemap_esc_loc_0ba531f1,"' . esc($loc) . """
sitemap.php,158,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,159,text,,sitemap_esc_last_2882c998,"' . esc($last) . """
sitemap.php,159,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,160,text,,sitemap_hourly_7d2919c9,hourly
sitemap.php,160,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,161,text,,sitemap_0_8_395eff9b,0.8
sitemap.php,161,text,,sitemap_n_echo_951c2668,"' . ""\n"";
        echo """
sitemap.php,162,text,,sitemap_n_echo_91c8301c,"\n"";
    }

    echo '"
sitemap.php,165,text,,sitemap_exit_963d2482,"';
    exit;
}

// -------------------------------------------------------------
// 3) Threads ‚Äî paginiert, lastmod = max(thread.updated_at, posts.updated_at)
// -------------------------------------------------------------
if ($t === 'threads') {
    $base = abs_base();

    $limit  = THREADS_PER_PAGE;
    $offset = ($p - 1) * $limit;

    // Ermittele pro Thread die letzte Aktivit√§t:
    // - GREATEST(thread.updated_at/created_at, max(posts.updated_at/created_at))
    $sql = ""
        SELECT
            t.id,
            GREATEST(
              COALESCE(t.updated_at, t.created_at, NOW()),
              COALESCE((
                SELECT MAX(COALESCE(p.updated_at, p.created_at))
                FROM posts p
                WHERE p.thread_id = t.id
              ), '1970-01-01')
            ) AS lastmod
        FROM threads t
        ORDER BY lastmod DESC
        LIMIT :limit OFFSET :offset
    "";
    try {
        $st = $pdo->prepare($sql);
        $st->bindValue(':limit', $limit, PDO::PARAM_INT);
        $st->bindValue(':offset', $offset, PDO::PARAM_INT);
        $st->execute();
        $rows = $st->fetchAll(PDO::FETCH_ASSOC);
    } catch (Throwable) {
        $rows = [];
    }

    echo '"
sitemap.php,205,text,,sitemap_n_echo_2b2190da,"' . ""\n"";
    echo '"
sitemap.php,206,text,,sitemap_n_foreach_rows_as_r_loc_b_31e65dd6,"' . ""\n"";

    foreach ($rows as $r) {
        $loc  = $base . '/forum/thread.php?id=' . (int)$r['id'];
        $last = w3c_date($r['lastmod']);
        echo """
sitemap.php,211,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,212,text,,sitemap_esc_loc_0ba531f1,"' . esc($loc) . """
sitemap.php,212,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,213,text,,sitemap_esc_last_2882c998,"' . esc($last) . """
sitemap.php,213,text,,sitemap_n_echo_57982b36,"\n"";
        echo '"
sitemap.php,214,text,,sitemap_hourly_7d2919c9,hourly
sitemap.php,214,text,,sitemap_n_echo_c5a8f808,"' . ""\n"";
        echo '"
sitemap.php,215,text,,sitemap_0_6_fe717b44,0.6
sitemap.php,215,text,,sitemap_n_echo_951c2668,"' . ""\n"";
        echo """
sitemap.php,216,text,,sitemap_n_echo_91c8301c,"\n"";
    }

    echo '"
profile.php,46,text,,profile_alt_cover_class_absolute_9cc4c21c,"""
               alt=""cover""
               class=""absolute top-0 left-0 will-change-transform select-none pointer-events-none""
               style=""transform-origin: 0 0;"">"
profile.php,66,text,,profile_alt_avatar_09aab2ad,""" alt=""avatar"">"
profile.php,89,text,,profile_required_class_box_input_3_123fb590,""" required class=""box-input-3"" />"
profile.php,94,text,,profile_class_box_input_3_b56be925,""" class=""box-input-3"" />"
profile.php,97,text,,profile_i18n_mask_textarea_5_f3f3863b,%%I18N_MASK_TEXTAREA_5%%
profile.php,106,text,,profile_class_box_input_3_disabled_06f1599a,""" class=""box-input-3"" disabled />"
profile.php,127,text,,profile_twitch_7d1f0617,Twitch
profile.php,132,text,,profile_tiktok_a99cc4a9,TikTok
profile.php,137,text,,profile_youtube_37c14d24,YouTube
profile.php,142,text,,profile_instagram_f08a9637,Instagram
profile.php,147,text,,profile_twitter_x_0b2ccdec,"Twitter (X)"
profile.php,152,text,,profile_facebook_4520593c,Facebook
profile.php,170,text,,profile_api_privacy_export_php_method_post_756403fb,"/api/privacy/export.php"" method=""post"">"
profile.php,171,text,,profile_meine_daten_herunterladen_72d47707,"Meine Daten herunterladen"
profile.php,178,text,,profile_i18n_mask_style_3_9c35acd6,%%I18N_MASK_STYLE_3%%
profile.php,183,text,,profile_gefahrenzone_788ab02c,Gefahrenzone
profile.php,184,text,,profile_das_loschen_deines_kontos_ist_c9e2c13a,"Das L√∂schen deines Kontos ist"
profile.php,184,text,,profile_endgultig_c5a7ad97,endg√ºltig
profile.php,184,text,,profile_offentliche_beitrage_bleiben_erhalten_erscheinen_jedoch_u_980e7a2b,". √ñffentliche Beitr√§ge bleiben erhalten, erscheinen jedoch unter dem Platzhalter"
profile.php,184,text,,profile_geloschter_benutzer_a2852b98,"‚ÄûGel√∂schter Benutzer‚Äú"
profile.php,185,text,,profile_konto_endgultig_loschen_bf53a3b2,"Konto endg√ºltig l√∂schen"
profile.php,192,text,,profile_konto_wirklich_loschen_ce8e3137,"Konto wirklich l√∂schen?"
profile.php,196,text,,profile_dieser_vorgang_kann_nicht_ruckgangig_gemacht_werden_zur_bes_4c418c91,"Dieser Vorgang kann nicht r√ºckg√§ngig gemacht werden. Zur Best√§tigung tippe bitte"
profile.php,196,text,,profile_delete_2493cc40,DELETE
profile.php,196,text,,profile_ein_4f597e75,ein.
profile.php,198,text,,profile_bestatigung_1f5b685d,Best√§tigung
profile.php,200,text,,profile_grossschreibung_erforderlich_73ca778b,"Gro√üschreibung erforderlich."
profile.php,205,text,,profile_abbrechen_667d0a7b,Abbrechen
profile.php,206,text,,profile_ja_konto_loschen_948eb4f9,"Ja, Konto l√∂schen"
profile.php,209,text,,profile_i18n_mask_script_0_c37d0874,%%I18N_MASK_SCRIPT_0%%
profile.php,221,text,,profile_i18n_mask_style_4_3898f25f,%%I18N_MASK_STYLE_4%%
profile.php,227,text,,profile_cover_positionieren_38fb42ee,"Cover positionieren"
profile.php,228,text,,profile_abbrechen_667d0a7b,Abbrechen
profile.php,235,text,,profile_zoom_0cb1b846,Zoom
profile.php,237,text,,profile_zentrieren_f3f62254,Zentrieren
profile.php,238,text,,profile_speichern_be78607a,Speichern
profile.php,243,text,,profile_i18n_mask_script_1_i18n_mask_script_2_1f8d3248,"%%I18N_MASK_SCRIPT_1%%

%%I18N_MASK_SCRIPT_2%%"
profile.php,128,attr,placeholder,profile_placeholder_deinname_oder_url_eec403d7,"@deinname / oder URL"
profile.php,133,attr,placeholder,profile_placeholder_deinname_oder_url_eec403d7,"@deinname / oder URL"
profile.php,138,attr,placeholder,profile_placeholder_handle_c_name_channel_uc_url_e728da29,"@handle | c/Name | channel/UC... | URL"
profile.php,143,attr,placeholder,profile_placeholder_deinname_oder_url_eec403d7,"@deinname / oder URL"
profile.php,148,attr,placeholder,profile_placeholder_deinname_oder_url_eec403d7,"@deinname / oder URL"
profile.php,153,attr,placeholder,profile_placeholder_seitenname_profil_url_27a9c048,"Seitenname / Profil-URL"
profile.php,199,attr,placeholder,profile_placeholder_delete_f1f6edfb,DELETE
profile.php,47,attr,alt,profile_alt_cover_4e46516b,cover
profile.php,66,attr,alt,profile_alt_avatar_271bb289,avatar
profile.php,193,attr,aria-label,profile_aria-label_schliessen_a27cc139,Schlie√üen
profile.php,84,attr,value,profile_value_htmlspecialchars_csrf_1a29a9fd,"<?= htmlspecialchars($csrf) ?>"
profile.php,89,attr,value,profile_value_htmlspecialchars_me_display_name_fccb9802,"<?= htmlspecialchars($me['display_name']) ?>"
profile.php,94,attr,value,profile_value_htmlspecialchars_me_email_fabfa64f,"<?= htmlspecialchars($me['email']) ?>"
profile.php,106,attr,value,profile_value_https_htda_de_u_htmlspecialchars_me_slug_8a899147,"https://htda.de/u/<?= htmlspecialchars($me['slug']) ?>"
profile.php,129,attr,value,profile_value_htmlspecialchars_string_me_social_twitch_e_f0f7374d,"<?= htmlspecialchars((string)($me['social_twitch'] ?? ''), ENT_QUOTES) ?>"
profile.php,134,attr,value,profile_value_htmlspecialchars_string_me_social_tiktok_e_10d41c28,"<?= htmlspecialchars((string)($me['social_tiktok'] ?? ''), ENT_QUOTES) ?>"
profile.php,139,attr,value,profile_value_htmlspecialchars_string_me_social_youtube_94633822,"<?= htmlspecialchars((string)($me['social_youtube'] ?? ''), ENT_QUOTES) ?>"
profile.php,144,attr,value,profile_value_htmlspecialchars_string_me_social_instagram_8255aa11,"<?= htmlspecialchars((string)($me['social_instagram'] ?? ''), ENT_QUOTES) ?>"
profile.php,149,attr,value,profile_value_htmlspecialchars_string_me_social_twitter_521eeb3e,"<?= htmlspecialchars((string)($me['social_twitter'] ?? ''), ENT_QUOTES) ?>"
profile.php,154,attr,value,profile_value_htmlspecialchars_string_me_social_facebook_94b21646,"<?= htmlspecialchars((string)($me['social_facebook'] ?? ''), ENT_QUOTES) ?>"
profile.php,236,attr,value,profile_value_1_152afbd8,1
forum/search.php,77,text,,search_suche_dc20867f,Suche
forum/search.php,81,text,,search_home_fffd607e,Home
forum/search.php,83,text,,search_forum_37290885,Forum
forum/search.php,85,text,,search_suchergebnisse_30814f90,Suchergebnisse
forum/search.php,99,text,,search_ergebnisse_fur_2f3693ee,"Ergebnisse f√ºr """
forum/search.php,100,text,,search_keine_ergebnisse_fur_c2ec027e,"Keine Ergebnisse f√ºr """
forum/search.php,112,text,,search_class_avatar_size_48p_alt_8e14a778,""" class=""avatar size-48p"" alt="""
forum/search.php,114,text,,search_class_text_lg_font_semibold_text_w_neutral_1_link_1_da38fb27,""" class=""text-lg font-semibold text-w-neutral-1 link-1"">"
forum/search.php,115,text,,search_von_5147ee6b,von
forum/search.php,116,text,,search_in_609f4275,in
forum/search.php,116,text,,search_class_link_1_28273f89,""" class=""link-1"">"
forum/search.php,118,text,,search_beitrage_f3092870,Beitr√§ge
forum/search.php,121,text,,search_letzte_aktivitat_eb56d211,"Letzte Aktivit√§t:"
forum/search.php,133,text,,search_page_6b432e2e,&page=
forum/search.php,133,text,,search_class_btn_btn_sm_btn_outline_secondary_zuruck_eedac251,""" class=""btn btn-sm btn-outline-secondary"">¬´ Zur√ºck"
forum/search.php,136,text,,search_seite_21ba0d87,Seite
forum/search.php,136,text,,search_von_5147ee6b,von
forum/search.php,139,text,,search_page_6b432e2e,&page=
forum/search.php,139,text,,search_class_btn_btn_sm_btn_outline_secondary_weiter_127b324a,""" class=""btn btn-sm btn-outline-secondary"">Weiter ¬ª"
forum/search.php,112,attr,alt,search_alt_htmlspecialchars_t_author_name_bd6af093,"<?= htmlspecialchars($t['author_name']) ?>"
forum/boards.php,87,text,,boards_class_breadcrumb_link_8c18a072,""" class=""breadcrumb-link"">"
forum/boards.php,135,text,,boards_alt_c3b5fc25,""" alt="""
forum/boards.php,135,text,,boards_onerror_this_onerror_null_this_src_def31919,"""
                     onerror=""this.onerror=null;this.src='"
forum/boards.php,136,text,,boards_assets_images_forum_default_webp_57ffac61,"/assets/images/forum/default.webp';"" />"
forum/boards.php,139,text,,boards_class_heading_3_text_w_neutral_1_link_53e7f3fb,"""
                   class=""heading-3 text-w-neutral-1 link-1 line-clamp-1 mb-16p text-split-bottom"">"
forum/boards.php,178,text,,boards_class_btn_btn_sm_flex_btn_neutral_2_group_hover_btn_prima_768dc505,""" class=""btn btn-sm flex btn-neutral-2 group-hover:btn-primary"">"
forum/boards.php,191,text,,boards_i18n_mask_script_0_89d1730a,%%I18N_MASK_SCRIPT_0%%
forum/boards.php,135,attr,alt,boards_alt_htmlspecialchars_name_ec495d11,"<?= htmlspecialchars($name) ?>"
forum/comment_update.php,18,text,,comment_update_false_error_unauthorized_exit_input_ac48bbba,"false, 'error'=>'unauthorized']);
    exit;
  }

  // Input
  $commentId = isset($_POST['comment_id']) ? (int)$_POST['comment_id'] : 0;
  $content   = trim((string)($_POST['content'] ?? ''));

  if ($commentId"
forum/thread.php,63,text,,thread_cookie_uberall_gultig_httponly_true_13cd7446,"'/',      // Cookie √ºberall g√ºltig
  'httponly' => true,
  'samesite' => 'Lax',
  'secure'   => !empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off',
]);

$pdo = db();
$me  = function_exists('optional_auth') ? optional_auth() : null;

$cfg       = require __DIR__ . '/../auth/config.php';
$APP_BASE  = rtrim($cfg['app_base'] ?? '', '/');

// Avatar‚ÄëFallback (entscheidend, damit Bilder nicht hart brechen)
$avatarFallback = ($APP_BASE ?: '') . '/assets/images/avatars/placeholder.png';

$csrf = issue_csrf($pdo, $_COOKIE[$cfg['cookies']['session_name']] ?? '');

$threadId = isset($_GET['t']) ? (int)$_GET['t'] : 0;
$cursorId = isset($_GET['after']) ? (int)$_GET['after'] : 0;
$limit    = 30;

$uid = (int)($me['id'] ?? 0);

/** ---- Helper: Top-Liker (max $limit) holen ---- */
function fetchTopLikers(PDO $pdo, string $type, int $id, int $limit = 5): array {
  if ($type === 'thread') {
    $sql = ""SELECT u.id,
                   COALESCE(u.display_name,'Gel√∂schter Benutzer') AS display_name,
                   u.avatar_path
            FROM thread_likes tl
            LEFT JOIN users u ON u.id = tl.user_id
            WHERE tl.thread_id = ?
            ORDER BY tl.created_at DESC
            LIMIT {$limit}"";
  } else {
    $sql = ""SELECT u.id,
                   COALESCE(u.display_name,'Gel√∂schter Benutzer') AS display_name,
                   u.avatar_path
            FROM post_likes pl
            LEFT JOIN users u ON u.id = pl.user_id
            WHERE pl.post_id = ?
            ORDER BY pl.created_at DESC
            LIMIT {$limit}"";
  }
  $st = $pdo->prepare($sql);
  $st->execute([$id]);
  return $st->fetchAll(PDO::FETCH_ASSOC) ?: [];
}

/* ---------- Thread inkl. like-Infos laden ---------- */
$st = $pdo->prepare(""
SELECT
  t.id,
  t.title,
  t.slug,
  t.is_locked,
  t.is_pinned,  
  t.is_locked,
  t.posts_count,
  t.likes_count,
  t.board_id AS thread_board_id,   --"
forum/thread.php,205,text,,thread_https_s_c3b9d539,"])(https?://[^\s"
forum/thread.php,208,text,,thread_u_cfd86085,'.$u.'
forum/thread.php,229,text,,thread_gepinnt_47b0dc95,Gepinnt
forum/thread.php,232,text,,thread_geschlossen_054c70c1,Geschlossen
forum/thread.php,238,text,,thread_home_f00bbba1,Home
forum/thread.php,248,text,,thread_forum_36129479,Forum
forum/thread.php,258,text,,thread_class_breadcrumb_link_5f422572,""" class=""breadcrumb-link"">"
forum/thread.php,297,text,,thread_alt_user_a7409ad1,""" alt=""user"" />"
forum/thread.php,299,text,,thread_user_php_id_65a6b6a8,/user.php?id=
forum/thread.php,299,text,,thread_class_text_xl_medium_text_w_neutral_1_link_1_b8bfb98e,"""
             class=""text-xl-medium text-w-neutral-1 link-1 line-clamp-1 mb-1"">"
forum/thread.php,321,text,,thread_report_c8861e2d,Report
forum/thread.php,332,text,,thread_target_blank_rel_noopener_9c54fcae,""" target=""_blank"" rel=""noopener"">"
forum/thread.php,348,text,,thread_i18n_mask_script_0_8736c8a9,%%I18N_MASK_SCRIPT_0%%
forum/thread.php,355,text,,thread_data_type_post_data_id_3b2dffd5,"""
                data-type=""post"" data-id="""
forum/thread.php,356,text,,thread_aria_pressed_ac5a082c,""" aria-pressed="""
forum/thread.php,376,text,,thread_alt_ece8c934,""" alt="""
forum/thread.php,376,text,,thread_class_likes_open_data_type_post_data_id_078b9550,"""
               class=""likes-open"" data-type=""post"" data-id="""
forum/thread.php,384,text,,thread_und_720a38c7,und
forum/thread.php,384,text,,thread_anderen_e03b167c,anderen
forum/thread.php,399,text,,thread_alt_user_a7409ad1,""" alt=""user"" />"
forum/thread.php,403,text,,thread_user_php_id_65a6b6a8,/user.php?id=
forum/thread.php,403,text,,thread_class_text_m_medium_text_w_neutral_1_link_1_line_cla_5edc9560,"""
     class=""text-m-medium text-w-neutral-1 link-1 line-clamp-1 mb-2"">"
forum/thread.php,413,text,,thread_target_blank_rel_noopener_9c54fcae,""" target=""_blank"" rel=""noopener"">"
forum/thread.php,426,text,,thread_i18n_mask_script_1_33fb77d9,%%I18N_MASK_SCRIPT_1%%
forum/thread.php,433,text,,thread_data_type_post_data_id_05933115,"""
                      data-type=""post"" data-id="""
forum/thread.php,434,text,,thread_aria_pressed_ac5a082c,""" aria-pressed="""
forum/thread.php,443,text,,thread_data_user_name_f298e30e,"""
        data-user-name="""
forum/thread.php,453,text,,thread_title_kommentar_loschen_ba27e243,""" title=""Kommentar l√∂schen"">"
forum/thread.php,471,text,,thread_alt_user_a7409ad1,""" alt=""user"" />"
forum/thread.php,475,text,,thread_user_php_id_65a6b6a8,/user.php?id=
forum/thread.php,475,text,,thread_class_text_m_medium_text_w_neutral_1_link_1_line_cla_5edc9560,"""
     class=""text-m-medium text-w-neutral-1 link-1 line-clamp-1 mb-2"">"
forum/thread.php,485,text,,thread_target_blank_rel_noopener_9c54fcae,""" target=""_blank"" rel=""noopener"">"
forum/thread.php,497,text,,thread_i18n_mask_script_2_4338b920,%%I18N_MASK_SCRIPT_2%%
forum/thread.php,504,text,,thread_data_type_post_data_id_05933115,"""
                      data-type=""post"" data-id="""
forum/thread.php,505,text,,thread_aria_pressed_ac5a082c,""" aria-pressed="""
forum/thread.php,514,text,,thread_data_user_name_f298e30e,"""
        data-user-name="""
forum/thread.php,524,text,,thread_title_kommentar_loschen_ba27e243,""" title=""Kommentar l√∂schen"">"
forum/thread.php,549,text,,thread_api_forum_create_post_php_method_post_enctype_mul_8fa9adfd,"/api/forum/create_post.php""
      method=""post"" enctype=""multipart/form-data""
      class=""flex items-center justify-between gap-24p bg-b-neutral-2 rounded-full py-16p px-32p"">"
forum/thread.php,561,text,,thread_autocomplete_off_required_abae97f4,""" autocomplete=""off"" required>"
forum/thread.php,573,text,,thread_emojis_ba88c0c7,Emojis
forum/thread.php,637,text,,thread_i18n_mask_script_3_i18n_mask_script_4_e933dc71,"%%I18N_MASK_SCRIPT_3%%

%%I18N_MASK_SCRIPT_4%%"
forum/thread.php,676,text,,thread_00_00_ac391563,00:00
forum/thread.php,677,text,,thread_00_00_ac391563,00:00
forum/thread.php,679,text,,thread_0_00_0eeb2bab,0:00
forum/thread.php,681,text,,thread_0_00_07a09233,": 0:00"
forum/thread.php,695,text,,thread_i18n_mask_script_5_i18n_mask_script_6_6e735978,"%%I18N_MASK_SCRIPT_5%%

%%I18N_MASK_SCRIPT_6%%

              %%I18N_MASK_SCRIPT_7%%

              %%I18N_MASK_SCRIPT_8%%"
forum/thread.php,704,text,,thread_thread_ist_gesperrt_7efcf756,"Thread ist gesperrt."
forum/thread.php,722,text,,thread_likes_9ca75e4f,Likes
forum/thread.php,747,text,,thread_i18n_mask_textarea_13_2771d0dc,%%I18N_MASK_TEXTAREA_13%%
forum/thread.php,755,text,,thread_i18n_mask_script_9_i18n_mask_script_10_i18n_mask_s_9f079e6c,"%%I18N_MASK_SCRIPT_9%%
%%I18N_MASK_SCRIPT_10%%
%%I18N_MASK_SCRIPT_11%%"
forum/thread.php,442,attr,title,thread_title_autor_erwahnen_21bf8237,"Autor erw√§hnen"
forum/thread.php,453,attr,title,thread_title_kommentar_loschen_22ae038b,"Kommentar l√∂schen"
forum/thread.php,513,attr,title,thread_title_autor_erwahnen_21bf8237,"Autor erw√§hnen"
forum/thread.php,524,attr,title,thread_title_kommentar_loschen_22ae038b,"Kommentar l√∂schen"
forum/thread.php,626,attr,title,thread_title_bild_anhangen_59feea7a,"Bild anh√§ngen"
forum/thread.php,561,attr,placeholder,thread_placeholder_htmlspecialchars_comment_write_ent_quotes_utf_8_e436cdc5,"<?= htmlspecialchars($__comment_write, ENT_QUOTES, 'UTF-8') ?>"
forum/thread.php,297,attr,alt,thread_alt_user_7e73c768,user
forum/thread.php,376,attr,alt,thread_alt_htmlspecialchars_u_display_name_78f69dcc,"<?= htmlspecialchars($u['display_name']) ?>"
forum/thread.php,399,attr,alt,thread_alt_user_7e73c768,user
forum/thread.php,471,attr,alt,thread_alt_user_7e73c768,user
forum/thread.php,309,attr,aria-label,thread_aria-label_menu_2240cbc9,Menu
forum/thread.php,565,attr,aria-label,thread_aria-label_emoji_1f5d491c,Emoji
forum/thread.php,570,attr,aria-label,thread_aria-label_emojis_c104f8d2,Emojis
forum/thread.php,574,attr,aria-label,thread_aria-label_schliessen_a958409d,Schlie√üen
forum/thread.php,576,attr,aria-label,thread_aria-label_emoji_liste_6644bfc6,Emoji-Liste
forum/thread.php,633,attr,aria-label,thread_aria-label_senden_45b8430f,Senden
forum/thread.php,723,attr,aria-label,thread_aria-label_schliessen_a958409d,Schlie√üen
forum/thread.php,215,attr,value,thread_value_boardid_497abbe0,"<?= $boardId ?>"
forum/thread.php,553,attr,value,thread_value_htmlspecialchars_csrf_6ccbc89e,"<?= htmlspecialchars($csrf) ?>"
forum/thread.php,554,attr,value,thread_value_int_thread_id_f856827e,"<?= (int)$thread['id'] ?>"
forum/thread.php,672,attr,value,thread_value_0_b67b4c0b,0
forum/thread.php,673,attr,value,thread_value_0_b67b4c0b,0
forum/board.php,30,text,,board_avatarfallback_app_base_assets_images_avat_53b8e172,")
$avatarFallback = ($APP_BASE ?: '') . '/assets/images/avatars/placeholder.png';

$boardId = isset($_GET['b']) ? (int)$_GET['b'] : 0;
$cursor  = isset($_GET['cursor']) ? (string)$_GET['cursor'] : null;

$limit = 20;
$limitPlusOne = $limit + 1;

/* ---------- Board ---------- */
$bst = $pdo->prepare(""SELECT id, name, slug, description FROM boards WHERE id = ?"");
$bst->execute([$boardId]);
$board = $bst->fetch(PDO::FETCH_ASSOC);
if (!$board) {
  http_response_code(404);
  echo ""Board nicht gefunden"";
  exit;
}

/* ---------- Cursor‚ÄëBedingung ---------- */
$cond   = '';
$params = [$boardId];
if ($cursor) {
  $parts = explode('|', $cursor, 2);
  if (count($parts) === 2) {
    $cond     = ""AND (t.last_post_at"
forum/board.php,129,text,,board_home_ffa75bf5,Home
forum/board.php,139,text,,board_forum_992188fa,Forum
forum/board.php,184,text,,board_i18n_mask_style_1_7649402d,%%I18N_MASK_STYLE_1%%
forum/board.php,195,text,,board_api_forum_create_thread_php_method_post_f856e8ef,"/api/forum/create_thread.php"" method=""post"">"
forum/board.php,201,text,,board_required_maxlength_200_e8c2af17,""" required maxlength=""200"">"
forum/board.php,203,text,,board_i18n_mask_textarea_2_ebc390c9,%%I18N_MASK_TEXTAREA_2%%
forum/board.php,216,text,,board_i18n_mask_script_0_599be331,%%I18N_MASK_SCRIPT_0%%
forum/board.php,245,text,,board_onerror_this_onerror_null_this_src_d4c6e010,""" onerror=""this.onerror=null;this.src='"
forum/board.php,245,text,,board_alt_c48232f2,"'"" alt="""
forum/board.php,247,text,,board_class_text_xl_217077b4,"""
                                            class=""text-xl-medium text-w-neutral-1 link-1"">"
forum/board.php,271,text,,board_alt_user_onerror_this_onerror_null_this_src_4520035e,""" alt=""user"" onerror=""this.onerror=null;this.src='"
forum/board.php,276,text,,board_class_btn_px_16p_py_2_751ac093,"""
                                    class=""btn px-16p py-2 btn-outline-secondary group-hover:bg-secondary group-hover:text-b-neutral-4"">"
forum/board.php,288,text,,board_cursor_fb7fb848,&cursor=
forum/board.php,170,attr,placeholder,board_placeholder_search_24942959,Search...
forum/board.php,201,attr,placeholder,board_placeholder_esc_t_title_2238e749,"<?= esc(t('title')) ?>"
forum/board.php,245,attr,alt,board_alt_esc_t_author_name_geloschter_benutzer_280d16d4,"<?= esc($t['author_name'] ?? 'Gel√∂schter Benutzer') ?>"
forum/board.php,271,attr,alt,board_alt_user_678c2893,user
forum/board.php,196,attr,value,board_value_esc_csrf_e5eb3abf,"<?= esc($csrf) ?>"
forum/board.php,197,attr,value,board_value_int_board_id_ab84bec8,"<?= (int)$board['id'] ?>"
forum/lib_link_preview.php,13,text,,lib_link_preview_loadhtml_1b17bfac,loadHTML('
forum/lib_link_preview.php,13,text,,lib_link_preview_html_libxml_nowarning_libxml_noerror_as_dom_54386050,"'.$html, LIBXML_NOWARNING|LIBXML_NOERROR)) {
    $as = $dom->getElementsByTagName('a');
    foreach ($as as $a) {
      $href = trim((string)$a->getAttribute('href'));
      if ($href !== '' && preg_match('~^https?://~i', $href)) $urls[] = $href;
    }
  }
  libxml_clear_errors();

  // nackte URLs (einfacher Fallback)
  if (preg_match_all('~\bhttps?://[^\s"
forum/lib_link_preview.php,23,text,,lib_link_preview_i_html_m_urls_array_merge_urls_m_0_41dc30bb,"""\']+~i', $html, $m)) {
    $urls = array_merge($urls, $m[0]);
  }

  // deduplizieren + auf max. 3 begrenzen
  $urls = array_values(array_unique($urls));
  return array_slice($urls, 0, 3);
}

/**
 * Holt OG/Twitter/HTML-Meta. L√§dt nur bis ~300kB.
 */
function lp_fetch_meta(string $url, int $timeoutSec = 4): array {
  $ua = 'LinkPreviewBot/1.0 (+https://example.com)';
  $ch = curl_init($url);
  curl_setopt_array($ch, [
    CURLOPT_RETURNTRANSFER => true,
    CURLOPT_FOLLOWLOCATION => true,
    CURLOPT_MAXREDIRS      => 5,
    CURLOPT_CONNECTTIMEOUT => $timeoutSec,
    CURLOPT_TIMEOUT        => $timeoutSec,
    CURLOPT_USERAGENT      => $ua,
    CURLOPT_SSL_VERIFYPEER => true,
    CURLOPT_SSL_VERIFYHOST => 2,
    // wir stoppen nach 300kB
    CURLOPT_WRITEFUNCTION  => function($ch, $data) use (&$buf) {
      static $len = 0;
      $buf .= $data;
      $len += strlen($data);
      return ($len > 300*1024) ? 0 : strlen($data); // abbrechen
    },
  ]);
  $buf = '';
  $ok  = curl_exec($ch);
  curl_close($ch);
  if ($ok === false || $buf === '') return [];

  $site = null; $title=null; $desc=null; $img=null;

  // sehr einfache OG-Extraktion
  $getMeta = function($prop, $name=null) use ($buf) {
    $p = preg_quote($prop, '~');
    if (preg_match('~"
forum/lib_link_preview.php,65,text,,lib_link_preview_property_p_content_79df6d9f,"]+property=[""\']'.$p.'[""\'][^>]*content=[""\']([^""\']+)[""\']~i', $buf, $m)) return html_entity_decode($m[1], ENT_QUOTES|ENT_HTML5);
    if ($name && preg_match('~"
forum/lib_link_preview.php,66,text,,lib_link_preview_name_preg_quote_name_content_ccac226f,"]+name=[""\']'.preg_quote($name,'~').'[""\'][^>]*content=[""\']([^""\']+)[""\']~i', $buf, $m)) return html_entity_decode($m[1], ENT_QUOTES|ENT_HTML5);
    return null;
  };

  $site  = $getMeta('og:site_name');
  $title = $getMeta('og:title')       ?: $getMeta('twitter:title') ?: null;
  $desc  = $getMeta('og:description') ?: $getMeta('twitter:description') ?: null;
  $img   = $getMeta('og:image')       ?: $getMeta('twitter:image') ?: null;

  if (!$title && preg_match('~"
forum/lib_link_preview.php,75,text,,lib_link_preview_is_buf_m_title_trim_html_entity_decode_stri_5ec9f391,"~is', $buf, $m)) {
    $title = trim(html_entity_decode(strip_tags($m[1]), ENT_QUOTES|ENT_HTML5));
  }
  if (!$desc && preg_match('~"
forum/lib_forum_text.php,12,text,,lib_forum_text_erlauben_allowed_b23b3807,"erlauben!) ---
    $allowed = '"
forum/lib_forum_text.php,15,text,,lib_forum_text_1_grob_unerlaubte_tags_weg_clean_strip_t_840b0adf,"';

    // 1) Grob: unerlaubte Tags weg
    $clean = strip_tags($html, $allowed);

    // 2) Offensichtliche Eventhandler / javascript:-URLs entfernen
    $clean = preg_replace('/\s+on[a-z-]+\s*=\s*""[^""]*""/i', '', $clean);
    $clean = preg_replace(""/\s+on[a-z-]+\s*=\s*'[^']*'/i"", '', $clean);
    $clean = preg_replace('/(href|src)\s*=\s*""(javascript:[^""]*)""/i', '$1=""#""', $clean);
    $clean = preg_replace(""/(href|src)\s*=\s*'(javascript:[^']*)'/i"", '$1=\"#\"', $clean);

    // 3) TinyMCE-Vorschau-H√ºllen entfernen (mce-preview-object / mce-object-video / mce-shim)
    // 3.1 data-mce-* Attribute global l√∂schen
    $clean = preg_replace('/\sdata-mce-[a-z0-9_-]+=""[^""]*""/i', '', $clean);
    $clean = preg_replace(""/\sdata-mce-[a-z0-9_-]+='[^']*'/i"", '', $clean);
    // 3.2 mce-shim ganz entfernen
    $clean = preg_replace('~"
forum/lib_forum_text.php,31,text,,lib_forum_text_class_mce_shim_s_16853dc4,"]*class=""[^""]*mce-shim[^""]*""[^>]*>\s*"
forum/lib_forum_text.php,31,text,,lib_forum_text_i_clean_3_3_wrapper_entpacken_behalte_den_2414a517,"~i', '', $clean);
    // 3.3 Wrapper entpacken: behalte den Inhalt (inkl."
forum/lib_forum_text.php,32,text,,lib_forum_text_und_wirf_den_482c3079,") und wirf den"
forum/lib_forum_text.php,32,text,,lib_forum_text_weg_clean_preg_replace_4e3bff3c,"weg
    $clean = preg_replace('~"
forum/lib_forum_text.php,33,text,,lib_forum_text_class_mce_preview_object_mce_object_video_6459d52f,"]*class=""[^""]*(?:mce-preview-object|mce-object-video)[^""]*""[^>]*>(.*?)"
forum/lib_forum_text.php,33,text,,lib_forum_text_is_1_clean_4_minimal_harten_ad1ee0af,"~is', '$1', $clean);

    // 4) Minimal h√§rten:"
forum/lib_forum_text.php,35,text,,lib_forum_text_immer_mit_controls_preload_436d367c,"immer mit controls/preload,"
forum/lib_forum_text.php,35,text,,lib_forum_text_mit_type_nur_wenn_das_element_existiert_reine_ff56e308,"mit type
    //    (nur, wenn das Element existiert ‚Äì reine String-Variante, bewusst simpel)
    $clean = preg_replace('~"
forum/lib_forum_text.php,37,text,,lib_forum_text_bcontrols_b_i_ae578127,"]*\bcontrols\b)~i', '"
forum/lib_forum_text.php,38,text,,lib_forum_text_bcontrols_b_bpreload_b_i_7cff0992,"]*)\bcontrols\b(?![^>]*\bpreload\b)~i', '"
forum/lib_forum_text.php,39,text,,lib_forum_text_btype_i_3c853408,"]*)\btype=~i', '"
forum/lib_forum_text.php,40,text,,lib_forum_text_is_3947d177,"~is', '"
forum/lib_forum_text.php,40,text,,lib_forum_text_clean_return_clean_hauptfunktion_die_45f9011d,"', $clean);

    return $clean;
}

/**
 * Hauptfunktion, die im Template verwendet wird.
 * - Erkennt automatisch HTML/entitiertes HTML und rendert es (-> forum_render_html)
 * - Andernfalls: Plaintext sicher escapen + Zeilenumbr√ºche beibehalten
 */
function forum_render_text(?string $text): string {
    $text = (string)$text;
    if ($text === '') return '';

    // HTML vorhanden? (echte Tags oder <‚Ä¶>)
    $looksLikeHtml = (strpos($text, '"
forum/lib_forum_text.php,55,text,,lib_forum_text_i_text_strpos_text_f_3b5708b5,"]/i', $text))
                  || (strpos($text, '<') !== false && strpos($text, '>') !== false);

    if ($looksLikeHtml) {
        return forum_render_html($text);
    }

    // sonst: Plaintext -> HTML mit"
gamercard/card.php,26,text,,card_prepare_select_id_display_name_slug_avatar_path_created_a122a485,"prepare(""SELECT id, display_name, slug, avatar_path, created_at FROM users WHERE slug=? LIMIT 1"");
  $st->execute([$slug]);
} else {
  $st = $pdo->prepare(""SELECT id, display_name, slug, avatar_path, created_at FROM users WHERE id=? LIMIT 1"");
  $st->execute([$uid]);
}
$user = $st->fetch(PDO::FETCH_ASSOC);
if (!$user) fail('user not found', 404, $debug);
$uid = (int)$user['id'];

/* ---- Stats ---- */
$threadsCount = (int)$pdo->prepare(""SELECT COUNT(*) FROM threads WHERE author_id=?"")
  ->execute([$uid]) ?: 0;
$threadsCount = (int)$pdo->query(""SELECT COUNT(*) FROM threads WHERE author_id={$uid}"")->fetchColumn();

$postsCount   = (int)$pdo->query(""SELECT COUNT(*) FROM posts   WHERE author_id={$uid}"")->fetchColumn();
$likesThreads = (int)$pdo->query(""SELECT COALESCE(SUM(likes_count),0) FROM threads WHERE author_id={$uid}"")->fetchColumn();
$likesPosts   = (int)$pdo->query(""SELECT COALESCE(SUM(likes_count),0) FROM posts   WHERE author_id={$uid}"")->fetchColumn();
$likesTotal   = $likesThreads + $likesPosts;

/* ---- Canvas ---- */
$W=1200; $H=360;            // wie zuvor
$PAD=32;

$im = imagecreatetruecolor($W,$H);
imagesavealpha($im,true);
imagealphablending($im,true);
$clear = imagecolorallocatealpha($im,0,0,0,127);
imagefill($im,0,0,$clear);

/* ---- Colors ---- */
$white    = imagecolorallocate($im,238,238,238);
$muted    = imagecolorallocate($im,156,163,175);
$accent   = imagecolorallocate($im,242,150,32);

/* ---- Assets (dist-Style) ---- */
$APP = dirname(__DIR__); // eine Ebene √ºber /gamercard
$BG_FILE   = $APP . '/assets/gamercard/bg.png';
$OVL_FILE  = $APP . '/assets/gamercard/overlay.png';
$FRAME_FILE= $APP . '/assets/gamercard/frame.png';

/* ---- Helper ---- */
function loadImageFlexible(string $pathOrAbs){
  if (!$pathOrAbs) return null;
  // Remote?
  if (preg_match('~^https?://~i',$pathOrAbs)) {
    $data=@file_get_contents($pathOrAbs);
    return ($data===false) ? null : @imagecreatefromstring($data);
  }
  // Bereits absoluter Pfad?
  $abs = $pathOrAbs;
  if (!is_file($abs)) {
    $abs = $_SERVER['DOCUMENT_ROOT'].'/'.ltrim($pathOrAbs,'/');
  }
  if (!is_file($abs)) return null;
  $ext=strtolower(pathinfo($abs,PATHINFO_EXTENSION));
  return match($ext){
    'jpg','jpeg' => @imagecreatefromjpeg($abs),
    'png'        => @imagecreatefrompng($abs),
    'gif'        => @imagecreatefromgif($abs),
    default      => @imagecreatefromstring(@file_get_contents($abs)),
  };
}
function drawCover(&$dst, $src){
  $W = imagesx($dst); $H = imagesy($dst);
  $sw = imagesx($src); $sh = imagesy($src);
  if ($sw"
gamercard/card.php,101,text,,card_rechts_h_imagesy_img_w_min_width_imagesx_img_7c00d9d6,"rechts
  $H = imagesy($img);
  $W = min($width, imagesx($img));
  for ($x=0; $x"
gamercard/card.php,105,text,,card_1_x_w_1_1_0_a_int_round_rgbafrom_3_1_ad99d7cb,"1 ? ($x/($W-1)) : 1.0;
    $a = (int)round($rgbaFrom[3]*(1-$t) + $rgbaTo[3]*$t);
    $r = (int)round($rgbaFrom[0]*(1-$t) + $rgbaTo[0]*$t);
    $g = (int)round($rgbaFrom[1]*(1-$t) + $rgbaTo[1]*$t);
    $b = (int)round($rgbaFrom[2]*(1-$t) + $rgbaTo[2]*$t);
    $col = imagecolorallocatealpha($img,$r,$g,$b,$a);
    imageline($img,$x,0,$x,$H,$col);
  }
}
function circleThumbGD($src,int $size,int $ring=0,$ringCol=null){
  $dst=imagecreatetruecolor($size,$size);
  imagesavealpha($dst,true);
  $t=imagecolorallocatealpha($dst,0,0,0,127);
  imagefill($dst,0,0,$t);
  $w=imagesx($src); $h=imagesy($src); $side=min($w,$h);
  $sx=(int)(($w-$side)/2); $sy=(int)(($h-$side)/2);
  imagecopyresampled($dst,$src,0,0,$sx,$sy,$size,$size,$side,$side);
  // kreisf√∂rmige Maske
  $mask=imagecreatetruecolor($size,$size);
  imagesavealpha($mask,true);
  $clear=imagecolorallocatealpha($mask,0,0,0,127);
  $solid=imagecolorallocatealpha($mask,0,0,0,0);
  imagefill($mask,0,0,$clear);
  imagefilledellipse($mask,$size/2,$size/2,$size,$size,$solid);
  for($x=0;$x"
gamercard/card.php,131,text,,card_24_rgba_imagecolorat_dst_x_y_a2_rgba_ab627502,">24;
      $rgba=imagecolorat($dst,$x,$y);
      $a2=($rgba&0x7F000000)>>24;
      $newA=max($a,$a2);
      imagesetpixel($dst,$x,$y,($rgba&0x00FFFFFF)|($newA"
gamercard/card.php,139,text,,card_0_ringcol_null_imagesetthickness_dst_max_1_ri_2182b8d2,"0 && $ringCol!==null){
    imagesetthickness($dst, max(1,$ring));
    imagearc($dst,$size/2,$size/2,$size-$ring,$size-$ring,0,360,$ringCol);
    imagesetthickness($dst,1);
  }
  return $dst;
}

/* ---- 1) Background (Cover) ---- */
$bg = is_file($BG_FILE) ? loadImageFlexible($BG_FILE) : null;
if ($bg) {
  drawCover($im, $bg);
  imagedestroy($bg);
} else {
  // Fallback: dunkler Verlauf
  $bgCol = imagecolorallocate($im,18,18,18);
  imagefilledrectangle($im,0,0,$W,$H,$bgCol);
}

/* ---- 2) Linke Vignette/Gradient f√ºr Textlesbarkeit ---- */
drawGradientLeft($im, 520, [0,0,0,75], [0,0,0,112]); // leicht ‚Üí dunkler

/* ---- 3) Overlay/Frame (optional) ---- */
$ovl = is_file($OVL_FILE) ? loadImageFlexible($OVL_FILE) : null;
if ($ovl){
  imagesavealpha($ovl,true);
  imagecopyresampled($im,$ovl,0,0,0,0,$W,$H,imagesx($ovl),imagesy($ovl));
  imagedestroy($ovl);
}
$frame = is_file($FRAME_FILE) ? loadImageFlexible($FRAME_FILE) : null;
if ($frame){
  imagesavealpha($frame,true);
  imagecopyresampled($im,$frame,0,0,0,0,$W,$H,imagesx($frame),imagesy($frame));
  imagedestroy($frame);
}

/* ---- Avatar ---- */
$AV_SIZE = 140;
$av = loadImageFlexible((string)$user['avatar_path']);
if ($av){
  $ringCol = imagecolorallocate($im,242,150,32); // accent
  $circ = circleThumbGD($av,$AV_SIZE,4,$ringCol);
  imagecopy($im,$circ,$PAD,($H-$AV_SIZE)/2,0,0,$AV_SIZE,$AV_SIZE);
  imagedestroy($circ);
  imagedestroy($av);
} else {
  $ph=imagecolorallocatealpha($im,255,255,255,90);
  imagefilledellipse($im,$PAD+$AV_SIZE/2,$H/2,$AV_SIZE,$AV_SIZE,$ph);
}

/* ---- Fonts ---- */
$FONT_SEMI = $APP . '/assets/fonts/Inter-SemiBold.ttf';
$FONT_REG  = $APP . '/assets/fonts/Inter-Regular.ttf';
if (!is_file($FONT_SEMI) || !is_file($FONT_REG)) {
  $fallback = '/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf';
  if (is_file($fallback)) $FONT_SEMI = $FONT_REG = $fallback;
  else { $FONT_SEMI = $FONT_REG = null; }
}
$drawText = function($img,$size,$x,$y,$color,$font,$text){
  if ($font && function_exists('imagettftext')) {
    imagettftext($img,$size,0,$x,$y,$color,$font,$text);
  } else {
    imagestring($img, 5, $x, $y-14, $text, $color);
  }
};

/* ---- Texte (dist-Look: Name gr√∂√üer, zweite Zeile schmaler) ---- */
$name  = (string)$user['display_name'];
$since = 'Mitglied seit '.date('d.m.Y', strtotime((string)$user['created_at']));
$line2 = ""Threads: {$threadsCount}   ¬∑   Beitr√§ge: {$postsCount}   ¬∑   Likes: {$likesTotal}"";

$tx = $PAD + $AV_SIZE + 24;
$drawText($im, 36, $tx, 132, $white, $FONT_SEMI, $name);
$drawText($im, 20, $tx, 174, $muted, $FONT_REG,  $line2);
$drawText($im, 18, $tx, 206, $muted, $FONT_REG,  $since);

/* ---- Badge rechts oben (‚ÄûHuntHub GamerCard‚Äú) ---- */
$badgeW=280; $badgeH=58; $bx=$W-$badgeW-$PAD; $by=$PAD+8;
$badgeBg=imagecolorallocatealpha($im,12,12,12,70);
imagefilledroundedrectangle:
if (!function_exists('imagefilledroundedrectangle')) {
  // mini helper:
  $rr = function($img,$x1,$y1,$x2,$y2,$r,$col){
    imagefilledrectangle($img,$x1+$r,$y1,$x2-$r,$y2,$col);
    imagefilledrectangle($img,$x1,$y1+$r,$x2,$y2-$r,$col);
    imagefilledellipse($img,$x1+$r,$y1+$r,2*$r,2*$r,$col);
    imagefilledellipse($img,$x2-$r,$y1+$r,2*$r,2*$r,$col);
    imagefilledellipse($img,$x1+$r,$y2-$r,2*$r,2*$r,$col);
    imagefilledellipse($img,$x2-$r,$y2-$r,2*$r,2*$r,$col);
  };
  $rr($im,$bx,$by,$bx+$badgeW,$by+$badgeH,24,$badgeBg);
}
$drawText($im, 20, $bx+20, $by+36, $accent, $FONT_SEMI, 'HuntHub GamerCard');

/* ---- Optionales Downscale (wie gehabt) ---- */
$out=$im;
if ($w>0 && $w"
public1/user.php,37,text,,user_profil_b10fb5e5,"‚Äì Profil"
public1/user.php,37,text,,user_i18n_mask_style_0_128390bd,%%I18N_MASK_STYLE_0%%
public1/user.php,42,text,,user_zuruck_851ae0cd,"‚Üê Zur√ºck"
public1/user.php,46,text,,user_alt_avatar_von_27daaca4,""" alt=""Avatar von"
public1/user.php,49,text,,user_mitglied_seit_a58b7cfd,"Mitglied seit"
public1/user.php,54,text,,user_keine_bio_vorhanden_8e4499f9,"Keine Bio vorhanden."
public1/user.php,59,text,,user_eigenes_profil_bearbeiten_ff8e981b,"Eigenes Profil bearbeiten"
public1/user.php,46,attr,alt,user_alt_avatar_von_e_user_display_name_8428cb69,"Avatar von <?= e($user['display_name']) ?>"
public1/admin.php,10,text,,admin_admin_c15dfcc6,Admin
public1/admin.php,12,text,,admin_zuruck_a0c6abd1,"‚Üê Zur√ºck"
public1/admin.php,13,text,,admin_adminbereich_62dc7bb1,Adminbereich
public1/admin.php,14,text,,admin_nur_administratoren_durfen_das_sehen_eingeloggt_als_ebf99c56,"Nur Administratoren d√ºrfen das sehen. Eingeloggt als"
public1/index.php,12,text,,index_willkommen_f8cf0dcd,"Willkommen,"
public1/index.php,15,text,,index_rolle_329c1780,Rolle:
public1/index.php,16,text,,index_profil_bearbeiten_a632cf5f,"Profil bearbeiten"
public1/index.php,17,text,,index_class_btn_offentliches_profil_8041a3af,""" class=""btn"">√ñffentliches Profil"
public1/index.php,18,text,,index_logout_562ebe96,Logout
public1/index.php,25,text,,index_anmelden_414b1541,Anmelden
public1/index.php,28,text,,index_login_447596da,Login
public1/index.php,33,text,,index_registrieren_3ad5c5ac,Registrieren
public1/index.php,37,text,,index_registrieren_3ad5c5ac,Registrieren
public1/index.php,26,attr,placeholder,index_placeholder_e_mail_328003b1,E-Mail
public1/index.php,27,attr,placeholder,index_placeholder_passwort_456da275,Passwort
public1/index.php,34,attr,placeholder,index_placeholder_anzeigename_a40901f9,Anzeigename
public1/index.php,35,attr,placeholder,index_placeholder_e_mail_328003b1,E-Mail
public1/index.php,36,attr,placeholder,index_placeholder_passwort_456da275,Passwort
public1/profile.php,17,text,,profile_alt_avatar_a08a0ec7,""" alt=""Avatar"">"
public1/profile.php,18,text,,profile_eingeloggt_als_07fa2642,"Eingeloggt als"
public1/profile.php,19,text,,profile_offentliches_profil_f8e837a6,""">√ñffentliches Profil"
public1/profile.php,24,text,,profile_profil_bearbeiten_a782380a,"Profil bearbeiten"
public1/profile.php,27,text,,profile_anzeigename_4640cf79,Anzeigename
public1/profile.php,28,text,,profile_required_5d934598,""" required>"
public1/profile.php,30,text,,profile_bio_6ecd71e9,Bio
public1/profile.php,30,text,,profile_i18n_mask_textarea_1_c5989531,%%I18N_MASK_TEXTAREA_1%%
public1/profile.php,33,text,,profile_avatar_png_jpg_webp_385eb2b7,"Avatar (PNG/JPG/WebP)"
public1/profile.php,37,text,,profile_speichern_1efa0632,Speichern
public1/profile.php,81,text,,profile_alt_profile_82a261bc,""" alt=""profile"" />"
public1/profile.php,96,text,,profile_general_information_96d6e4b4,"General Information"
public1/profile.php,102,text,,profile_first_name_5340c59c,"First Name"
public1/profile.php,103,text,,profile_required_class_box_input_3_815a313a,""" required class=""box-input-3"" />"
public1/profile.php,106,text,,profile_last_name_9412b812,"Last Name"
public1/profile.php,110,text,,profile_email_0bc24c76,Email
public1/profile.php,114,text,,profile_about_me_4b0581d2,"About me"
public1/profile.php,114,text,,profile_i18n_mask_textarea_2_6bd35fa1,%%I18N_MASK_TEXTAREA_2%%
public1/profile.php,119,text,,profile_location_08f0bc25,Location
public1/profile.php,123,text,,profile_working_at_da786ae2,"Working at"
public1/profile.php,127,text,,profile_relationship_67673cb8,Relationship
public1/profile.php,133,text,,profile_saved_change_ae2e1c6a,"Saved Change"
public1/profile.php,150,text,,profile_i18n_mask_script_0_baee30f4,%%I18N_MASK_SCRIPT_0%%
public1/profile.php,17,attr,alt,profile_alt_avatar_97f826d8,Avatar
public1/profile.php,60,attr,alt,profile_alt_image_55e90cef,image
public1/profile.php,64,attr,alt,profile_alt_image_55e90cef,image
public1/profile.php,81,attr,alt,profile_alt_profile_284f127d,profile
public1/profile.php,25,attr,value,profile_value_htmlspecialchars_csrf_65c1f49d,"<?= htmlspecialchars($csrf) ?>"
public1/profile.php,28,attr,value,profile_value_htmlspecialchars_me_display_name_810568e1,"<?= htmlspecialchars($me['display_name']) ?>"
public1/profile.php,103,attr,value,profile_value_htmlspecialchars_me_display_name_810568e1,"<?= htmlspecialchars($me['display_name']) ?>"
test.html,6,text,,test_i18n_mask_style_1_c3b2b7d2,%%I18N_MASK_STYLE_1%%
test.html,21,text,,test_i18n_mask_script_0_b4ca5b34,%%I18N_MASK_SCRIPT_0%%
test.html,14,attr,placeholder,test_placeholder_t_test_placeholder_z_b_xdamonx83_tech_1a5b82fa_49364bcb,"<?= t('test_placeholder_z_b_xdamonx83_tech_1a5b82fa') ?>"
test.html,15,attr,placeholder,test_placeholder_t_test_placeholder_z_b_hunthub_c28f012a_efe9a1d0,"<?= t('test_placeholder_z_b_hunthub_c28f012a') ?>"
theme/partials/header_user_mobile.php,14,text,,header_user_mobile_alt_a53f00fa,""" alt="""">"
theme/partials/header_user_mobile.php,17,text,,header_user_mobile_profil_ansehen_358a545c,""">Profil ansehen"
theme/partials/header_user_mobile.php,22,text,,header_user_mobile_profil_b1b48682,Profil
theme/partials/header_user_mobile.php,23,text,,header_user_mobile_user_settings_php_5189dff9,"/user-settings.php"">"
theme/partials/header_user_mobile.php,23,text,,header_user_mobile_profil_bearbeiten_c7222625,"Profil bearbeiten"
theme/partials/header_user_mobile.php,24,text,,header_user_mobile_logout_185336fb,Logout
theme/partials/header_user_mobile.php,30,text,,header_user_mobile_login_4cfa5a60,Login
theme/partials/header_user_mobile.php,31,text,,header_user_mobile_registrieren_797e14fe,Registrieren
theme/partials/header_user_mobile.php,38,text,,header_user_mobile_e_mail_0e92884f,E-Mail
theme/partials/header_user_mobile.php,42,text,,header_user_mobile_passwort_b09c4d95,Passwort
theme/partials/header_user_mobile.php,46,text,,header_user_mobile_einloggen_14df0ec3,Einloggen
theme/partials/header_user_mobile.php,52,text,,header_user_mobile_anzeigename_f4abdbfd,Anzeigename
theme/partials/header_user_mobile.php,56,text,,header_user_mobile_e_mail_0e92884f,E-Mail
theme/partials/header_user_mobile.php,60,text,,header_user_mobile_passwort_b09c4d95,Passwort
theme/partials/header_user_mobile.php,64,text,,header_user_mobile_konto_erstellen_92889997,"Konto erstellen"
theme/partials/header_user_mobile.php,29,attr,aria-label,header_user_mobile_aria-label_anmeldung_0a47a50c,Anmeldung
theme/partials/header_search.php,21,text,,header_search_mitglieder_5224f49d,Mitglieder
theme/partials/header_search.php,11,attr,placeholder,header_search_placeholder_mitglieder_foren_suchen_2079b171,"Mitglieder/Foren suchen‚Ä¶"
theme/partials/bottom_bar.php,36,text,,bottom_bar_einfugen_fur_live_kannst_du_die_desktop_sichtbarkeit_via_247e4fed,"einf√ºgen. F√ºr Live kannst du die Desktop-Sichtbarkeit
  via @media unten wieder abschalten.
-->

%%I18N_MASK_SCRIPT_0%%

%%I18N_MASK_STYLE_6%%"
theme/partials/bottom_bar.php,51,text,,bottom_bar_lade_anfragen_6cfd6312,"Lade Anfragen‚Ä¶"
theme/partials/bottom_bar.php,53,text,,bottom_bar_i18n_mask_script_1_7b35fe39,%%I18N_MASK_SCRIPT_1%%
theme/partials/bottom_bar.php,58,text,,bottom_bar_lade_chats_c1289db6,"Lade Chats‚Ä¶"
theme/partials/bottom_bar.php,67,text,,bottom_bar_alt_852551d2,""" alt="""">"
theme/partials/bottom_bar.php,70,text,,bottom_bar_profil_ansehen_665b80fc,""">Profil ansehen"
theme/partials/bottom_bar.php,75,text,,bottom_bar_profil_e0d17729,Profil
theme/partials/bottom_bar.php,76,text,,bottom_bar_profil_bearbeiten_60820ee4,"Profil bearbeiten"
theme/partials/bottom_bar.php,77,text,,bottom_bar_logout_96589d80,Logout
theme/partials/bottom_bar.php,83,text,,bottom_bar_login_b6682f81,Login
theme/partials/bottom_bar.php,84,text,,bottom_bar_registrieren_15ff3449,Registrieren
theme/partials/bottom_bar.php,91,text,,bottom_bar_e_mail_6929fef4,E-Mail
theme/partials/bottom_bar.php,95,text,,bottom_bar_passwort_9a7de0ea,Passwort
theme/partials/bottom_bar.php,99,text,,bottom_bar_einloggen_57dd97ce,Einloggen
theme/partials/bottom_bar.php,103,text,,bottom_bar_oder_e06a22b3,oder
theme/partials/bottom_bar.php,107,text,,bottom_bar_api_auth_oauth_start_php_provider_google_data_i18n_56b3adc4,"/api/auth/oauth_start.php?provider=google""
       data-i18n=""lgoogle"">"
theme/partials/bottom_bar.php,109,text,,bottom_bar_google_fd06fd7b,Google
theme/partials/bottom_bar.php,113,text,,bottom_bar_api_auth_oauth_start_php_provider_facebook_data_i18_e1e721a2,"/api/auth/oauth_start.php?provider=facebook""
       data-i18n=""lfacebook"">"
theme/partials/bottom_bar.php,115,text,,bottom_bar_facebook_96b6efc7,Facebook
theme/partials/bottom_bar.php,119,text,,bottom_bar_api_auth_oauth_start_php_provider_twitch_data_i18n_d2bf9be6,"/api/auth/oauth_start.php?provider=twitch""
       data-i18n=""ltwitch"">"
theme/partials/bottom_bar.php,121,text,,bottom_bar_twitch_67f67147,Twitch
theme/partials/bottom_bar.php,128,text,,bottom_bar_anzeigename_00607681,Anzeigename
theme/partials/bottom_bar.php,132,text,,bottom_bar_e_mail_6929fef4,E-Mail
theme/partials/bottom_bar.php,136,text,,bottom_bar_passwort_9a7de0ea,Passwort
theme/partials/bottom_bar.php,142,text,,bottom_bar_ich_habe_die_7f182e59,"Ich habe die"
theme/partials/bottom_bar.php,144,text,,bottom_bar_datenschutzerklarung_e7124083,Datenschutzerkl√§rung
theme/partials/bottom_bar.php,144,text,,bottom_bar_gelesen_und_stimme_der_verarbeitung_meiner_daten_zum_zweck_d_3aa8d2dc,"gelesen und stimme der Verarbeitung meiner Daten zum Zweck der Registrierung zu."
theme/partials/bottom_bar.php,152,text,,bottom_bar_konto_erstellen_12605443,"Konto erstellen"
theme/partials/bottom_bar.php,164,text,,bottom_bar_anfragen_2db221a3,Anfragen
theme/partials/bottom_bar.php,164,text,,bottom_bar_0_53f6ec67,0
theme/partials/bottom_bar.php,169,text,,bottom_bar_chat_0afa614c,Chat
theme/partials/bottom_bar.php,171,text,,bottom_bar_nachrichten_03130c03,Nachrichten
theme/partials/bottom_bar.php,171,text,,bottom_bar_0_53f6ec67,0
theme/partials/bottom_bar.php,173,text,,bottom_bar_profil_e0d17729,Profil
theme/partials/bottom_bar.php,175,text,,bottom_bar_login_b6682f81,Login
theme/partials/bottom_bar.php,82,attr,aria-label,bottom_bar_aria-label_anmeldung_0fd96e1b,Anmeldung
theme/partials/bottom_bar.php,162,attr,aria-label,bottom_bar_aria-label_mobile_bottom_bar_550f57df,"Mobile bottom bar"
theme/partials/bottom_bar.php,149,attr,value,bottom_bar_value_2025_08_29_8d3d6a60,2025-08-29
theme/partials/header_user_dropdown.php,11,text,,header_user_dropdown_i18n_mask_script_0_cf84a0e0,%%I18N_MASK_SCRIPT_0%%
theme/partials/header_user_dropdown.php,15,text,,header_user_dropdown_i18n_mask_style_8_c9ac010d,""">
%%I18N_MASK_STYLE_8%%"
theme/partials/header_user_dropdown.php,33,text,,header_user_dropdown_0_120bac2e,0
theme/partials/header_user_dropdown.php,41,text,,header_user_dropdown_i18n_mask_script_1_a423a95f,%%I18N_MASK_SCRIPT_1%%
theme/partials/header_user_dropdown.php,53,text,,header_user_dropdown_0_120bac2e,0
theme/partials/header_user_dropdown.php,79,text,,header_user_dropdown_alt_profile_7f2bf084,""" alt=""profile"" />"
theme/partials/header_user_dropdown.php,110,text,,header_user_dropdown_class_dropdown_item_data_i18n_profile_d52907b7,""" class=""dropdown-item"" data-i18n=""profile"">"
theme/partials/header_user_dropdown.php,114,text,,header_user_dropdown_1111_96982c03,1111
theme/partials/header_user_dropdown.php,118,text,,header_user_dropdown_admin_php_class_dropdown_item_admin_76820b97,"/admin.php"" class=""dropdown-item"">Admin"
theme/partials/header_user_dropdown.php,120,text,,header_user_dropdown_i18n_mask_style_9_f87b0dfb,%%I18N_MASK_STYLE_9%%
theme/partials/header_user_dropdown.php,199,text,,header_user_dropdown_i18n_mask_script_2_30201ba9,%%I18N_MASK_SCRIPT_2%%
theme/partials/header_user_dropdown.php,262,text,,header_user_dropdown_tournaments_0e2893e2,Tournaments
theme/partials/header_user_dropdown.php,270,text,,header_user_dropdown_chat_ed27535e,"- Chat"
theme/partials/header_user_dropdown.php,276,text,,header_user_dropdown_tournament_overview_5f7989fc,"- Tournament Overview"
theme/partials/header_user_dropdown.php,282,text,,header_user_dropdown_tournament_prizes_605dc4ac,"- Tournament Prizes"
theme/partials/header_user_dropdown.php,288,text,,header_user_dropdown_tournament_participants_157784a9,"- Tournament Participants"
theme/partials/header_user_dropdown.php,294,text,,header_user_dropdown_tournament_matches_d88127d2,"- Tournament Matches"
theme/partials/header_user_dropdown.php,300,text,,header_user_dropdown_tournament_brackets_a482e8e2,"- Tournament Brackets"
theme/partials/header_user_dropdown.php,346,text,,header_user_dropdown_data_lang_de_451d08db,"""
       data-lang=""de"">"
theme/partials/header_user_dropdown.php,348,text,,header_user_dropdown_deutsch_35f974a0,Deutsch
theme/partials/header_user_dropdown.php,349,text,,header_user_dropdown_de_17834260,DE
theme/partials/header_user_dropdown.php,355,text,,header_user_dropdown_data_lang_en_d2644bfb,"""
       data-lang=""en"">"
theme/partials/header_user_dropdown.php,357,text,,header_user_dropdown_english_c9125d16,English
theme/partials/header_user_dropdown.php,358,text,,header_user_dropdown_en_1e59b8cb,EN
theme/partials/header_user_dropdown.php,362,text,,header_user_dropdown_i18n_mask_script_3_16465e56,%%I18N_MASK_SCRIPT_3%%
theme/partials/header_user_dropdown.php,422,text,,header_user_dropdown_i18n_mask_script_4_655971f6,%%I18N_MASK_SCRIPT_4%%
theme/partials/header_user_dropdown.php,519,text,,header_user_dropdown_i18n_mask_script_5_65e76d96,%%I18N_MASK_SCRIPT_5%%
theme/partials/header_user_dropdown.php,522,text,,header_user_dropdown_i18n_mask_script_6_63ef2ea4,%%I18N_MASK_SCRIPT_6%%
theme/partials/header_user_dropdown.php,525,text,,header_user_dropdown_i18n_mask_script_7_566f5e90,%%I18N_MASK_SCRIPT_7%%
theme/partials/header_user_dropdown.php,51,attr,title,header_user_dropdown_title_benachrichtigungen_853d9109,Benachrichtigungen
theme/partials/header_user_dropdown.php,125,attr,placeholder,header_user_dropdown_placeholder_e_mail_0074b800,E-Mail
theme/partials/header_user_dropdown.php,126,attr,placeholder,header_user_dropdown_placeholder_passwort_66dd2e4d,Passwort
theme/partials/header_user_dropdown.php,159,attr,placeholder,header_user_dropdown_placeholder_z_b_huntfan83_0871a0b4,"z. B. HuntFan83"
theme/partials/header_user_dropdown.php,166,attr,placeholder,header_user_dropdown_placeholder_du_example_com_ad5e1fd3,du@example.com
theme/partials/header_user_dropdown.php,173,attr,placeholder,header_user_dropdown_placeholder_mind_8_zeichen_a3d232e4,"Mind. 8 Zeichen"
theme/partials/header_user_dropdown.php,324,attr,placeholder,header_user_dropdown_placeholder_search_media_6fd0ee87,"Search Media"
theme/partials/header_user_dropdown.php,508,attr,placeholder,header_user_dropdown_placeholder_suchen_94513e8e,"Suchen ‚Ä¶"
theme/partials/header_user_dropdown.php,79,attr,alt,header_user_dropdown_alt_profile_16c5f5f2,profile
theme/partials/header_user_dropdown.php,229,attr,alt,header_user_dropdown_alt_hunthub_caddfed0,HuntHub
theme/partials/header_user_dropdown.php,330,attr,alt,header_user_dropdown_alt_logo_49f41f97,logo
theme/partials/header_user_dropdown.php,30,attr,aria-label,header_user_dropdown_aria-label_freundschaftsanfragen_e887a7c8,Freundschaftsanfragen
theme/partials/header_user_dropdown.php,56,attr,aria-label,header_user_dropdown_aria-label_benachrichtigungen_ad344ba6,Benachrichtigungen
theme/partials/header_user_dropdown.php,147,attr,aria-label,header_user_dropdown_aria-label_schliessen_ac0f9d9d,Schlie√üen
theme/partials/header_user_dropdown.php,269,attr,aria-label,header_user_dropdown_aria-label_item_a31a319a,item
theme/partials/header_user_dropdown.php,275,attr,aria-label,header_user_dropdown_aria-label_item_a31a319a,item
theme/partials/header_user_dropdown.php,281,attr,aria-label,header_user_dropdown_aria-label_item_a31a319a,item
theme/partials/header_user_dropdown.php,287,attr,aria-label,header_user_dropdown_aria-label_item_a31a319a,item
theme/partials/header_user_dropdown.php,293,attr,aria-label,header_user_dropdown_aria-label_item_a31a319a,item
theme/partials/header_user_dropdown.php,299,attr,aria-label,header_user_dropdown_aria-label_item_a31a319a,item
theme/header.php,16,text,,header_assets_images_icons_favicon_ico_type_image_x_icon_2ff2f850,"/assets/images/icons/favicon.ico"" type=""image/x-icon"" />"
theme/header.php,17,text,,header_hunthub_27ac3721,HuntHub
theme/header.php,17,text,,header_i18n_mask_script_0_7a754aaa,%%I18N_MASK_SCRIPT_0%%
theme/header.php,18,text,,header_assets_styles_app_css_rel_stylesheet_bd778bf8,"/assets/styles/app.css"" rel=""stylesheet"">"
theme/header.php,42,text,,header_assets_images_icons_logo_png_alt_brand_0a3e3499,"/assets/images/icons/logo.png"" alt=""brand"" />"
theme/header.php,66,text,,header_news_for_you_2b66c5ef,"News For You"
theme/header.php,87,text,,header_assets_images_users_user1_png_alt_profile_c0770757,"/assets/images/users/user1.png"" alt=""profile"" />"
theme/header.php,89,text,,header_david_malan_ca5f9083,"David Malan"
theme/header.php,92,text,,header_270_followars_0a64284f,"270 Followars"
theme/header.php,109,text,,header_profile_87fac094,Profile
theme/header.php,110,text,,header_settings_27dd1414,Settings
theme/header.php,111,text,,header_logout_daf73d21,Logout
theme/header.php,112,text,,header_help_a1180c8d,Help
theme/header.php,132,text,,header_assets_images_icons_logo_png_alt_gameco_f4227f01,"/assets/images/icons/logo.png"" alt=""GameCo"" />"
theme/header.php,145,text,,header_home_2dad31c9,Home
theme/header.php,152,text,,header_home_one_83295dd4,"- Home One"
theme/header.php,157,text,,header_home_two_bc563276,"- Home Two"
theme/header.php,163,text,,header_home_three_1c772865,"- Home Three"
theme/header.php,169,text,,header_home_four_4d60260a,"- Home Four"
theme/header.php,176,text,,header_trending_e87dc663,Trending
theme/header.php,179,text,,header_community_cfce8802,Community
theme/header.php,182,text,,header_saved_5373ea9c,Saved
theme/header.php,185,text,,header_live_stream_1d4d7e77,"Live Stream"
theme/header.php,189,text,,header_library_3e369479,Library
theme/header.php,196,text,,header_library_6db154fe,"- Library"
theme/header.php,202,text,,header_library_details_7957fd6b,"- Library Details"
theme/header.php,210,text,,header_games_8f879690,Games
theme/header.php,217,text,,header_games_fddd7370,"- Games"
theme/header.php,223,text,,header_game_details_one_8eca6832,"- Game Details One"
theme/header.php,229,text,,header_game_details_two_77720c54,"- Game Details Two"
theme/header.php,237,text,,header_groups_92ab6f13,Groups
theme/header.php,245,text,,header_groups_one_6420b291,"- Groups One"
theme/header.php,251,text,,header_group_two_95e5938f,"- Group Two"
theme/header.php,257,text,,header_group_home_156910dc,"- Group Home"
theme/header.php,263,text,,header_related_groups_1f885882,"- Related Groups"
theme/header.php,269,text,,header_group_forum_ce2e3354,"- Group Forum"
theme/header.php,275,text,,header_group_members_13f73b67,"- Group Members"
theme/header.php,281,text,,header_group_media_c7806c2a,"- Group Media"
theme/header.php,289,text,,header_teams_22ff8831,Teams
theme/header.php,296,text,,header_teams_754167b1,"- Teams"
theme/header.php,302,text,,header_team_members_cc2b1133,"- Team Members"
theme/header.php,308,text,,header_team_games_c8fe1b40,"- Team Games"
theme/header.php,314,text,,header_team_ranks_90bdd49f,"- Team Ranks"
theme/header.php,320,text,,header_team_tournament_11696336,"- Team Tournament"
theme/header.php,328,text,,header_tournaments_3d7b4a8c,Tournaments
theme/header.php,336,text,,header_tournaments_bfa35828,"- Tournaments"
theme/header.php,342,text,,header_tournament_overview_00e7e27f,"- Tournament Overview"
theme/header.php,348,text,,header_tournament_prizes_5e2b980e,"- Tournament Prizes"
theme/header.php,354,text,,header_tournament_participants_4593219b,"- Tournament Participants"
theme/header.php,360,text,,header_tournament_matches_8175c76a,"- Tournament Matches"
theme/header.php,366,text,,header_tournament_brackets_2561e927,"- Tournament Brackets"
theme/header.php,373,text,,header_leaderboard_835e0a54,Leaderboard
theme/header.php,377,text,,header_marketplace_e80c65ff,Marketplace
theme/header.php,385,text,,header_marketplace_one_8dd698ff,"- Marketplace One"
theme/header.php,391,text,,header_marketplace_two_3fbfee24,"- Marketplace Two"
theme/header.php,397,text,,header_marketplace_details_c9d6c9c7,"- Marketplace Details"
theme/header.php,405,text,,header_profile_87fac094,Profile
theme/header.php,412,text,,header_post_item_5c7a9829,"- Post Item"
theme/header.php,418,text,,header_game_stats_5bc06bcb,"- Game Stats"
theme/header.php,424,text,,header_about_e7055e7f,"- About"
theme/header.php,430,text,,header_my_team_dc9d1cde,"- My Team"
theme/header.php,436,text,,header_my_group_552282e4,"- My Group"
theme/header.php,442,text,,header_forums_19abce6b,"- Forums"
theme/header.php,448,text,,header_videos_0025b786,"- Videos"
theme/header.php,454,text,,header_achievements_a8c1eaa5,"- Achievements"
theme/header.php,459,text,,header_chat_66c866b4,"- Chat"
theme/header.php,465,text,,header_settings_ed4d07c1,"- Settings"
theme/header.php,473,text,,header_shop_dfbd7943,Shop
theme/header.php,480,text,,header_shop_cce2f7e6,"- Shop"
theme/header.php,486,text,,header_shop_details_8f959142,"- Shop Details"
theme/header.php,492,text,,header_shopping_cart_888b7a66,"- Shopping Cart"
theme/header.php,497,text,,header_shipping_c91433e2,"- Shipping"
theme/header.php,502,text,,header_checkout_29c8c298,"- checkout"
theme/header.php,510,text,,header_blogs_b7c56158,Blogs
theme/header.php,517,text,,header_blogs_ee208d38,"- Blogs"
theme/header.php,523,text,,header_blog_details_525f97cf,"- Blog Details"
theme/header.php,531,text,,header_pages_ccb3308f,Pages
theme/header.php,539,text,,header_pricing_plan_af37e418,"- Pricing Plan"
theme/header.php,545,text,,header_terms_conditions_cd2ad4e0,"- Terms Conditions"
theme/header.php,550,text,,header_faq_s_4cd4dc8d,"- Faq's"
theme/header.php,556,text,,header_not_found_e2800dfb,"- Not Found"
theme/header.php,561,text,,header_login_20025e22,"- Login"
theme/header.php,566,text,,header_sign_up_3a41c118,"- Sign Up"
theme/header.php,573,text,,header_contact_us_796107e5,"Contact Us"
theme/header.php,589,text,,header_assets_images_icons_logo_png_alt_logo_8710966f,"/assets/images/icons/logo.png"" alt=""logo"" />"
theme/header.php,590,text,,header_become_visionary_behind_a_sprawling_metropolis_in_metropolis_ca282ea7,"Become visionary behind a sprawling metropolis in Metropolis Tycoon Plan
                        empire
                        progress."
theme/header.php,50,attr,placeholder,header_placeholder_search_cc2b773f,Search...
theme/header.php,583,attr,placeholder,header_placeholder_search_media_5623a3b2,"Search Media"
theme/header.php,42,attr,alt,header_alt_brand_72f45eb5,brand
theme/header.php,87,attr,alt,header_alt_profile_0ec6d53c,profile
theme/header.php,132,attr,alt,header_alt_gameco_56abf0e4,GameCo
theme/header.php,589,attr,alt,header_alt_logo_4a7e1ac6,logo
theme/header.php,152,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,157,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,162,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,168,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,196,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,201,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,217,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,222,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,228,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,244,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,250,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,256,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,262,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,268,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,274,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,280,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,296,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,301,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,307,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,313,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,319,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,335,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,341,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,347,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,353,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,359,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,365,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,384,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,390,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,396,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,412,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,417,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,423,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,429,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,435,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,441,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,447,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,453,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,459,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,464,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,480,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,485,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,491,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,497,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,502,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,517,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,522,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,538,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,544,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,550,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,555,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,561,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/header.php,566,attr,aria-label,header_aria-label_item_655a1f4f,item
theme/page-template.php,45,text,,page-template_fur_caches_wir_variieren_auf_ua_und_ch_header_vary_us_e3c4c136,"F√ºr Caches: wir variieren auf UA und CH
    header('Vary: User-Agent, Sec-CH-UA-Platform, Sec-CH-UA-Mobile', false);

    // 1) Client Hints (nur √ºber HTTPS und wenn Browser sie sendet)
    $chMobile   = $_SERVER['HTTP_SEC_CH_UA_MOBILE']   ?? '';
    $chPlatform = $_SERVER['HTTP_SEC_CH_UA_PLATFORM'] ?? '';

    // Sec-CH-UA-Mobile kommt typischerweise als ""?1"" f√ºr mobile
    if ($chMobile !== '') {
        if (strpos($chMobile, '?1') !== false || $chMobile === '1') {
            return true;
        }
        // iPad/Tablet kann ""?0"" sein; unten f√§llt der UA-Regex zur√ºck
    }

    // 2) User-Agent Fallback (breiter Satz inkl. Tablets + iPadOS 13+)
    $ua = $_SERVER['HTTP_USER_AGENT'] ?? '';

    // Klassische Mobiles/Tablets
    $mobileRegex = '/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Windows Phone|Opera Mini|Opera Mobi|Mobi/i';
    $tabletRegex = '/iPad|Tablet|Nexus 7|Nexus 9|Nexus 10|SM-T|Kindle|Silk|PlayBook/i';

    if (preg_match($mobileRegex, $ua) || preg_match($tabletRegex, $ua)) {
        return true;
    }

    // iPadOS 13+: meldet sich als ""Macintosh"" + ""Mobile/"
theme/page-template.php,107,text,,page-template_i18n_mask_script_0_0ae62e1d,""">

%%I18N_MASK_SCRIPT_0%%"
theme/page-template.php,113,text,,page-template_i18n_mask_script_1_3d4cd848,""">
%%I18N_MASK_SCRIPT_1%%"
theme/page-template.php,152,text,,page-template_assets_images_icons_favicon_ico_f2b53079,"/assets/images/icons/favicon.ico"">"
theme/page-template.php,155,text,,page-template_assets_styles_app_css_rel_stylesheet_ccacce28,"/assets/styles/app.css"" rel=""stylesheet"">"
theme/page-template.php,156,text,,page-template_theme_css_style_css_rel_stylesheet_8b152c32,"/theme/css/style.css"" rel=""stylesheet"">"
theme/page-template.php,157,text,,page-template_assets_css_header_search_css_rel_stylesheet_dc90e801,"/assets/css/header-search.css"" rel=""stylesheet"">"
theme/page-template.php,161,text,,page-template_i18n_mask_script_2_i18n_mask_script_3_i18n_mas_13d54400,"%%I18N_MASK_SCRIPT_2%%
  %%I18N_MASK_SCRIPT_3%%
  %%I18N_MASK_SCRIPT_4%%
  %%I18N_MASK_SCRIPT_5%%
  %%I18N_MASK_SCRIPT_6%%
  %%I18N_MASK_SCRIPT_7%%
  %%I18N_MASK_SCRIPT_8%%
  %%I18N_MASK_SCRIPT_9%%"
theme/page-template.php,171,text,,page-template_i18n_mask_script_10_d2a9d963,%%I18N_MASK_SCRIPT_10%%
theme/page-template.php,173,text,,page-template_i18n_mask_script_11_2533dadb,%%I18N_MASK_SCRIPT_11%%
theme/page-template.php,195,text,,page-template_lade_92a5b281,LADE...
theme/page-template.php,196,text,,page-template_i18n_mask_script_12_65bd8c16,%%I18N_MASK_SCRIPT_12%%
theme/page-template.php,228,text,,page-template_i18n_mask_script_13_fc2c3d42,%%I18N_MASK_SCRIPT_13%%
theme/page-template.php,247,text,,page-template_i18n_mask_script_14_0749103f,%%I18N_MASK_SCRIPT_14%%
theme/page-template.php,267,text,,page-template_i18n_mask_script_15_81939559,%%I18N_MASK_SCRIPT_15%%
theme/page-template.php,309,text,,page-template_i18n_mask_script_16_db726adc,%%I18N_MASK_SCRIPT_16%%
theme/page-template.php,319,text,,page-template_legal_rechtlich_php_doc_impressum_data_legal_impressum_c_b26c12b7,"/legal/rechtlich.php?doc=impressum"" data-legal=""impressum"" class=""open-impressum"">Impressum"
theme/page-template.php,322,text,,page-template_legal_rechtlich_php_doc_privacy_data_legal_privacy_class_ab428900,"/legal/rechtlich.php?doc=privacy"" data-legal=""privacy"" class=""open-privacy"">Datenschutz"
theme/page-template.php,325,text,,page-template_legal_rechtlich_php_doc_netiquette_data_legal_netiquette_4d30b67e,"/legal/rechtlich.php?doc=netiquette"" data-legal=""netiquette"" class=""open-netiquette"">Netiquette"
theme/page-template.php,329,text,,page-template_legal_rechtlich_php_doc_terms_data_legal_terms_class_op_12bc0cf4,"/legal/rechtlich.php?doc=terms"" data-legal=""terms"" class=""open-terms"">Nutzungsbedingungen"
theme/page-template.php,341,text,,page-template_huntmaps_online_2f99a358,HuntMaps.online
theme/page-template.php,346,text,,page-template_info_htda_de_d3751148,info@htda.de
theme/page-template.php,353,text,,page-template_titel_2a04097b,Titel
theme/page-template.php,414,text,,page-template_konto_eb91eea0,Konto
theme/page-template.php,427,text,,page-template_i18n_mask_script_17_i18n_mask_script_18_i18n_mask_fcf231e5,"%%I18N_MASK_SCRIPT_17%%
%%I18N_MASK_SCRIPT_18%%
%%I18N_MASK_SCRIPT_19%%
%%I18N_MASK_SCRIPT_20%%
%%I18N_MASK_SCRIPT_21%%
%%I18N_MASK_SCRIPT_22%%

%%I18N_MASK_SCRIPT_23%%
%%I18N_MASK_SCRIPT_24%%

%%I18N_MASK_SCRIPT_25%%

%%I18N_MASK_SCRIPT_26%%
%%I18N_MASK_SCRIPT_27%%"
theme/page-template.php,371,attr,title,page-template_title_nachrichten_0c1e9a42,Nachrichten
theme/page-template.php,220,attr,alt,page-template_alt_hunthub_5f402c1a,Hunthub
theme/page-template.php,304,attr,alt,page-template_alt_logo_dba16f3a,logo
theme/page-template.php,352,attr,aria-label,page-template_aria-label_schliessen_865d707f,Schlie√üen
theme/page-template.php,415,attr,aria-label,page-template_aria-label_schliessen_865d707f,Schlie√üen
theme/footer.php,14,text,,footer_contact_us_5f694fbd,"Contact Us"
theme/footer.php,19,text,,footer_home_76318272,Home
theme/footer.php,29,text,,footer_contact_us_5f694fbd,"Contact Us"
theme/footer.php,46,text,,footer_let_s_get_in_touch_cbb05db4,"Let‚Äôs Get In Touch"
theme/footer.php,56,text,,footer_location_2711af14,Location
theme/footer.php,59,text,,footer_view_on_google_maps_d99e7765,"View on Google Maps"
theme/footer.php,68,text,,footer_email_address_75f5ee38,"Email Address"
theme/footer.php,71,text,,footer_support_example_com_db3f63d5,support@example.com
theme/footer.php,80,text,,footer_contact_us_5f694fbd,"Contact Us"
theme/footer.php,83,text,,footer_239_555_0108_59e7f1ba,"(239) 555-0108"
theme/footer.php,93,text,,footer_your_name_3f540577,"Your Name*"
theme/footer.php,101,text,,footer_email_address_78a9dd90,"Email Address*"
theme/footer.php,108,text,,footer_phone_number_a692a1ca,"Phone Number*"
theme/footer.php,115,text,,footer_subject_5e4cae41,Subject*
theme/footer.php,122,text,,footer_describe_your_message_76e333a9,"Describe your message*"
theme/footer.php,124,text,,footer_i18n_mask_textarea_0_5b6dbd2a,%%I18N_MASK_TEXTAREA_0%%
theme/footer.php,128,text,,footer_submit_now_fcb6c9a4,"Submit Now"
theme/footer.php,148,text,,footer_subscribe_to_our_1f2e6861,"Subscribe to our"
theme/footer.php,149,text,,footer_newsletter_944f9b98,Newsletter
theme/footer.php,156,text,,footer_subscribe_49950faf,Subscribe
theme/footer.php,165,text,,footer_become_visionary_behind_a_sprawling_metropolis_in_metropolis_bd55bc25,"Become visionary behind a sprawling metropolis in Metropolis Tycoon Plan empire progress."
theme/footer.php,188,text,,footer_main_pages_cc1f8651,"Main pages"
theme/footer.php,198,text,,footer_my_library_1eecb925,"My Library"
theme/footer.php,206,text,,footer_trending_160740f2,Trending
theme/footer.php,214,text,,footer_leaderboard_7c8655fa,Leaderboard
theme/footer.php,222,text,,footer_chat_6eb8df44,Chat
theme/footer.php,230,text,,footer_marketplace_7deec4ee,Marketplace
theme/footer.php,238,text,,footer_shop_01afb864,Shop
theme/footer.php,246,text,,footer_support_e514a95b,Support
theme/footer.php,254,text,,footer_blogs_6d15b6c8,Blogs
theme/footer.php,262,text,,footer_utility_pages_c860abde,"Utility pages"
theme/footer.php,272,text,,footer_tournaments_4fe64779,Tournaments
theme/footer.php,280,text,,footer_games_9eb480fb,Games
theme/footer.php,288,text,,footer_community_01b80a31,Community
theme/footer.php,296,text,,footer_pricing_69d198f4,Pricing
theme/footer.php,304,text,,footer_notifications_b204d361,Notifications
theme/footer.php,312,text,,footer_not_found_a89948e0,"Not found"
theme/footer.php,320,text,,footer_contact_c8c6d583,Contact
theme/footer.php,327,text,,footer_email_us_f8066c5c,"Email Us"
theme/footer.php,330,text,,footer_debra_holt_example_com_e5aec6e7,debra.holt@example.com
theme/footer.php,333,text,,footer_contact_us_5f694fbd,"Contact Us"
theme/footer.php,336,text,,footer_207_555_0119_20ab723e,"(207) 555-0119"
theme/footer.php,343,text,,footer_copyright_58a6bf06,"Copyright ¬©"
theme/footer.php,348,text,,footer_designed_by_03285f03,"Designed By"
theme/footer.php,350,text,,footer_uiaxis_8ec65a6d,UIAXIS
theme/footer.php,354,text,,footer_privacy_2ad2e4da,Privacy
theme/footer.php,357,text,,footer_terms_conditions_72a1e22f,"Terms & Conditions"
theme/footer.php,97,attr,placeholder,footer_placeholder_name_3fffd172,Name
theme/footer.php,105,attr,placeholder,footer_placeholder_email_99eee3ff,Email
theme/footer.php,119,attr,placeholder,footer_placeholder_name_3fffd172,Name
theme/footer.php,154,attr,placeholder,footer_placeholder_enter_your_email_address_16630627,"Enter your email address"
theme/footer.php,164,attr,alt,footer_alt_logo_e2747fa9,logo
theme/footer.php,365,attr,alt,footer_alt_footer_e5fbd120,footer
theme/login.php,32,text,,login_class_input_5afa959e,""" class=""input"">"
theme/login.php,33,text,,login_class_input_5afa959e,""" class=""input"">"
theme/login.php,40,text,,login_class_input_5afa959e,""" class=""input"">"
theme/login.php,41,text,,login_class_input_5afa959e,""" class=""input"">"
theme/login.php,42,text,,login_class_input_5afa959e,""" class=""input"">"
theme/login.php,32,attr,placeholder,login_placeholder_t_login_placeholder_e_mail_d6e354ec_c4281285,"<?= t('login_placeholder_e_mail_d6e354ec') ?>"
theme/login.php,33,attr,placeholder,login_placeholder_t_login_placeholder_passwort_0f699346_1ac64cda,"<?= t('login_placeholder_passwort_0f699346') ?>"
theme/login.php,40,attr,placeholder,login_placeholder_t_login_placeholder_anzeigename_425dac60_5f39a595,"<?= t('login_placeholder_anzeigename_425dac60') ?>"
theme/login.php,41,attr,placeholder,login_placeholder_t_login_placeholder_e_mail_d6e354ec_c4281285,"<?= t('login_placeholder_e_mail_d6e354ec') ?>"
theme/login.php,42,attr,placeholder,login_placeholder_t_login_placeholder_passwort_0f699346_1ac64cda,"<?= t('login_placeholder_passwort_0f699346') ?>"
login.php,46,text,,login_login_4a6f49f2,Login
login.php,51,text,,login_home_7f506e17,Home
login.php,61,text,,login_login_4a6f49f2,Login
login.php,78,text,,login_login_4a6f49f2,Login
login.php,81,text,,login_don_t_have_an_account_73c427e7,"Don‚Äôt have an account?"
login.php,82,text,,login_sign_up_00fdf55f,"Sign Up"
login.php,86,text,,login_log_in_with_google_8d1aa3d0,"Log In With Google"
login.php,90,text,,login_log_in_with_twitch_70294af5,"Log In with Twitch"
login.php,94,text,,login_log_in_with_facebook_8efb3c0c,"Log In With Facebook"
login.php,101,text,,login_or_690856af,Or
login.php,113,text,,login_email_76772fb1,Email
login.php,120,text,,login_password_0d693f30,Password
login.php,133,text,,login_remember_me_b8ae502b,"Remember me"
login.php,138,text,,login_log_in_de2c8967,"Log In"
login.php,141,text,,login_forgot_your_password_7c029dbe,"Forgot your password?"
login.php,151,text,,login_i18n_mask_script_0_i18n_mask_script_1_f597010d,"%%I18N_MASK_SCRIPT_0%%
%%I18N_MASK_SCRIPT_1%%"
login.php,117,attr,placeholder,login_placeholder_email_a9ae9664,Email
login.php,124,attr,placeholder,login_placeholder_password_7bb5c7c6,Password
login.php,109,attr,value,login_value_htmlspecialchars_next_ent_quotes_utf_8_a6f83d53,"<?= htmlspecialchars($next, ENT_QUOTES, 'UTF-8') ?>"
